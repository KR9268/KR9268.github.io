<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kibok Park">
<meta name="dcterms.date" content="2024-08-23">

<title>[DE스터디/2주차과제1] 다양한 데이터처리 플랫폼을 사용한 데이터 수집~모니터링 – Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-71390cc8b9bae10139428574d3aab2c6.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f3c2ea88cadbcfb37ba28ffa2c97cfc1.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-ae2d0dcda2edce4ab590422bb373b64f.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-contrib/watermark-1.0.11/watermark.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LPL499WQBH"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LPL499WQBH', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index_dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index_miniprojects.html"> 
<span class="menu-text">Mini Projects</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/KR9268"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/%EA%B8%B0%EB%B3%B5-%EB%B0%95-573a68268/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">[DE스터디/2주차과제1] 다양한 데이터처리 플랫폼을 사용한 데이터 수집~모니터링</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Spark</div>
                <div class="quarto-category">PySpark</div>
                <div class="quarto-category">202408Study_DataEngineering</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kibok Park </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 23, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#개요" id="toc-개요" class="nav-link active" data-scroll-target="#개요">개요</a></li>
  <li><a href="#과제---2주차" id="toc-과제---2주차" class="nav-link" data-scroll-target="#과제---2주차">과제 - 2주차</a>
  <ul class="collapse">
  <li><a href="#dataframe-rdd-api사용해보기" id="toc-dataframe-rdd-api사용해보기" class="nav-link" data-scroll-target="#dataframe-rdd-api사용해보기">1. Dataframe, RDD API사용해보기</a>
  <ul class="collapse">
  <li><a href="#rdd" id="toc-rdd" class="nav-link" data-scroll-target="#rdd">(1) RDD</a></li>
  <li><a href="#rdd-transformation" id="toc-rdd-transformation" class="nav-link" data-scroll-target="#rdd-transformation">(2) RDD Transformation</a></li>
  <li><a href="#rdd-with-key-value-pairs" id="toc-rdd-with-key-value-pairs" class="nav-link" data-scroll-target="#rdd-with-key-value-pairs">(3) RDD with key-value pairs</a></li>
  <li><a href="#dataframe" id="toc-dataframe" class="nav-link" data-scroll-target="#dataframe">(4) DataFrame</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>데이터 엔지니어링 스터디 내용정리 - Spark (Dataframe/RDD API 실습)</p>
<section id="개요" class="level1">
<h1>개요</h1>
<ul>
<li>참여중인 데이터 엔지니어링 스터디에서 배우는 내용 정리
<ul>
<li>데이터 수집, 정제 : pyspark, airflow</li>
<li>저장 : elasticsearch</li>
<li>시각화 : kibana</li>
</ul></li>
<li>2주차 과제1 : Dataframe/RDD API 실습 (현재 글)</li>
<li>2주차 과제2 : 데이터셋 확인하고 스키마 고민하기 (다른 글)
<ul>
<li>printSchema()로 인식된 스키마 확인</li>
<li>날짜데이터지만 string인 필드를 timestamp로 변경하고 json으로 스키마 저장</li>
<li>저장해둔 json스키마로 데이터 읽은 후 데이터 확인</li>
</ul></li>
<li>2주차 과제3 : 데이터모델 결정하기 (다른 글)
<ul>
<li>수업에서 제시한 기본 3가지 모델 사용 : github의 Top10 repo/User, Daily statistics</li>
<li>간단히 만들어 볼 모델 1가지 : pytorch repo에서 가장 issue를 활발히 진행한 Top10 User
<ul>
<li>위 모델에 대한 예상 스키마 작성해보기</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="과제---2주차" class="level1">
<h1>과제 - 2주차</h1>
<section id="dataframe-rdd-api사용해보기" class="level2">
<h2 class="anchored" data-anchor-id="dataframe-rdd-api사용해보기">1. Dataframe, RDD API사용해보기</h2>
<section id="rdd" class="level3">
<h3 class="anchored" data-anchor-id="rdd">(1) RDD</h3>
<section id="sparksession" class="level4">
<h4 class="anchored" data-anchor-id="sparksession">SparkSession</h4>
<div id="3366148c" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkSession</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> (</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    SparkSession.builder</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        .appName(<span class="st">"rdd-dataframe"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        .master(<span class="st">"local"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        .getOrCreate()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkContext를 SparkSession에서 빼두기</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> spark.sparkContext</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 하단 메시지는 Jupyter 공식이미지에서 나오는 메시지로, 무시하기</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.apache.spark.unsafe.Platform (file:/usr/local/spark-3.1.2-bin-hadoop3.2/jars/spark-unsafe_2.12-3.1.2.jar) to constructor java.nio.DirectByteBuffer(long,int)
WARNING: Please consider reporting this to the maintainers of org.apache.spark.unsafe.Platform
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
24/08/28 14:33:16 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Using Spark's default log4j profile: org/apache/spark/log4j-defaults.properties
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
24/08/28 14:33:17 WARN Utils: Service 'SparkUI' could not bind on port 4040. Attempting port 4041.</code></pre>
</div>
</div>
<div id="be61689c" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkContext 멈추기</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sc.stop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="range010-collect" class="level4">
<h4 class="anchored" data-anchor-id="range010-collect">Range(0,10) &amp; Collect()</h4>
<div id="257a76d1" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collect()를 통해 파이썬 데이터셋으로 변경해야 사용할 수 있음</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>rdd2 <span class="op">=</span> sc.<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PythonRDD[15] at RDD at PythonRDD.scala:53</code></pre>
</div>
</div>
<div id="f84e5ac9" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd2.collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
</div>
</div>
</section>
<section id="parallelize로-변환python-list-rdd-take-head와-동일" class="level4">
<h4 class="anchored" data-anchor-id="parallelize로-변환python-list-rdd-take-head와-동일">parallelize로 변환[Python list → RDD] &amp; take() [head()와 동일]</h4>
<div id="05399fdc" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parallelize로 RDD로 만든 후 take로 위에서부터 3개 가져옴 (head/top/first와 같음)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>rdd3 <span class="op">=</span> sc.parallelize(data)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>rdd3.take(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['one', 'two', 'three']</code></pre>
</div>
</div>
</section>
<section id="textfile" class="level4">
<h4 class="anchored" data-anchor-id="textfile">textFile()</h4>
<ul>
<li>sc.textFile(“../data/movie.csv”)만 단독 실행시 완료로 떠서 작업이 된 줄 알았는데, 다른 블럭에서 .count()를 실행하니 그제서야 그런 파일은 없다고 뜸. <code>action이 있어야 데이터 처리가 이루어지는 Spark의 lazy한 특성을 확인함</code></li>
</ul>
<div id="1d9c3357" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rdd1 <span class="op">=</span> sc.textFile(<span class="st">"../data/movies.csv"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>cnt <span class="op">=</span> rdd1.count()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cnt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>9743</code></pre>
</div>
</div>
<div id="1ac0bf57" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 첫번째 데이터는 컬럼명</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>arr2 <span class="op">=</span> rdd1.take(<span class="dv">10</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(arr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['movieId,title,genres', '1,Toy Story (1995),Adventure|Animation|Children|Comedy|Fantasy', '2,Jumanji (1995),Adventure|Children|Fantasy', '3,Grumpier Old Men (1995),Comedy|Romance', '4,Waiting to Exhale (1995),Comedy|Drama|Romance', '5,Father of the Bride Part II (1995),Comedy', '6,Heat (1995),Action|Crime|Thriller', '7,Sabrina (1995),Comedy|Romance', '8,Tom and Huck (1995),Adventure|Children', '9,Sudden Death (1995),Action']</code></pre>
</div>
</div>
</section>
<section id="takeordered5" class="level4">
<h4 class="anchored" data-anchor-id="takeordered5">takeOrdered(5)</h4>
<ul>
<li>Sorting을 해서 가져오므로, 데이터가 큰 경우에는 사용X</li>
<li>RDD는 컬럼이 없으므로 컬럼기준으로 Sorting은 불가함</li>
</ul>
<div id="d0c8fce2" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>arr3 <span class="op">=</span> rdd1.takeOrdered(<span class="dv">5</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(arr3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['1,Toy Story (1995),Adventure|Animation|Children|Comedy|Fantasy', '10,GoldenEye (1995),Action|Adventure|Thriller', '100,City Hall (1996),Drama|Thriller', '100044,Human Planet (2011),Documentary', '100068,Comme un chef (2012),Comedy']</code></pre>
</div>
</div>
</section>
<section id="aggregate" class="level4">
<h4 class="anchored" data-anchor-id="aggregate">aggregate</h4>
<ul>
<li>공식문서 코드로 이해하기
<ul>
<li>문서링크 : https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.RDD.aggregate.html</li>
</ul></li>
<li>샘플코드</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>seqOp <span class="op">=</span> (<span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>] <span class="op">+</span> y, x[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>combOp <span class="op">=</span> (<span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>] <span class="op">+</span> y[<span class="dv">0</span>], x[<span class="dv">1</span>] <span class="op">+</span> y[<span class="dv">1</span>]))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>sc.parallelize([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]).aggregate((<span class="dv">0</span>, <span class="dv">0</span>), seqOp, combOp)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (<span class="dv">10</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>seqOp로 각 파티션 계산 [주어진 항등원 (0,0)부터 시작]
<ul>
<li>(0, 0) → (1, 1) → (3, 2)</li>
<li>(0, 0) → (3, 1) → (7, 2)</li>
</ul></li>
<li>combOp로 각 파티션 결과 취합
<ul>
<li>(3, 2) + (7, 2) = (10, 4)</li>
</ul></li>
</ul>
<div id="58abc176" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rdd2 <span class="op">=</span> sc.<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>seqOp <span class="op">=</span> <span class="kw">lambda</span> v1, v2: v1 <span class="op">+</span> v2</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>combOp <span class="op">=</span> <span class="kw">lambda</span> v1, v2: v1 <span class="op">+</span> v2</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>rdd2.aggregate(<span class="dv">0</span>, seqOp, combOp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>499500</code></pre>
</div>
</div>
<ul>
<li>항등원을 바꿔보니 항등원*11로 보여서 파티션의 수를 확인해보니 10개인 것을 확인함</li>
<li>파티션의 갯수는 공식문서를 확인해보니 range에서 지정한 부분이었음
<ul>
<li>문서링크 : https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.SparkContext.range.html</li>
<li><code>sc.range(start, end, step, number of partition)</code></li>
</ul></li>
</ul>
<div id="0b1d5e1c" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>rdd2.aggregate(<span class="dv">9</span>, seqOp, combOp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>499599</code></pre>
</div>
</div>
<div id="c020e8f0" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rdd2.aggregate(<span class="dv">50</span>, seqOp, combOp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>500050</code></pre>
</div>
</div>
<div id="f1529c04" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd2.getNumPartitions())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10</code></pre>
</div>
</div>
<ul>
<li>reduce, fold</li>
</ul>
<div id="9c2259de" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rdd2.<span class="bu">reduce</span>(<span class="kw">lambda</span> v1, v2: v1 <span class="op">+</span> v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>499500</code></pre>
</div>
</div>
<div id="2b6d2cef" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>rdd2.fold(<span class="dv">0</span>, <span class="kw">lambda</span> v1, v2: v1 <span class="op">+</span> v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>499500</code></pre>
</div>
</div>
</section>
<section id="foreach" class="level4">
<h4 class="anchored" data-anchor-id="foreach">foreach</h4>
<div id="8daf1feb" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>rdd3 <span class="op">=</span> sc.parallelize(data)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>rdd3.foreach(<span class="kw">lambda</span> v: <span class="bu">print</span>(v))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>one
two
three</code></pre>
</div>
</div>
</section>
<section id="repartition" class="level4">
<h4 class="anchored" data-anchor-id="repartition">repartition</h4>
<ul>
<li>실습환경은 로컬이므로 파티션 1개인 상태여서 중요하지 않았음</li>
<li>업무환경에서는 많이 쓰이는 함수임</li>
</ul>
<div id="5a2f9520" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파티션 2개로 나눔</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>rdd1 <span class="op">=</span> sc.textFile(<span class="st">"../data/movies.csv"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>rdd4 <span class="op">=</span> rdd1.repartition(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="foreachpartition" class="level4">
<h4 class="anchored" data-anchor-id="foreachpartition">foreachPartition</h4>
<ul>
<li>return value는 파티션별 이터레이터</li>
<li>파티션 별로 다른 함수를 호출해야하는 경우나, progress체크 등에 사용</li>
</ul>
<div id="e8e3dc79" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>rdd4.foreachPartition(<span class="kw">lambda</span> it: <span class="bu">print</span>(it))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;itertools.chain object at 0x7f789b7bb100&gt;                          (0 + 1) / 1]
&lt;itertools.chain object at 0x7f789b7bb9a0&gt;
                                                                                </code></pre>
</div>
</div>
<div id="eb424b27" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 파티션 항목 확인</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 전체 확인 코드</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#rdd4.foreachPartition(lambda it: [print(x) for x in it])</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 상위 5개만 확인</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>rdd4.foreachPartition(<span class="kw">lambda</span> it: [<span class="bu">print</span>(x) <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(it) <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>movieId,title,genres
1,Toy Story (1995),Adventure|Animation|Children|Comedy|Fantasy
2,Jumanji (1995),Adventure|Children|Fantasy
3,Grumpier Old Men (1995),Comedy|Romance
4,Waiting to Exhale (1995),Comedy|Drama|Romance
10,GoldenEye (1995),Action|Adventure|Thriller
11,"American President, The (1995)",Comedy|Drama|Romance
12,Dracula: Dead and Loving It (1995),Comedy|Horror
13,Balto (1995),Adventure|Animation|Children
14,Nixon (1995),Drama</code></pre>
</div>
</div>
<div id="a35ea3db" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 어떤 파티션의 데이터인지까지 같이 출력 by ChatGPT</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>rdd4.mapPartitionsWithIndex(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> partition_index, it: [(partition_index, x) <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(it) <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span>]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>).foreach(<span class="kw">lambda</span> x: <span class="bu">print</span>(<span class="ss">f"Partition: </span><span class="sc">{</span>x[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Value: </span><span class="sc">{</span>x[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Partition: 0, Value: movieId,title,genres
Partition: 0, Value: 1,Toy Story (1995),Adventure|Animation|Children|Comedy|Fantasy
Partition: 0, Value: 2,Jumanji (1995),Adventure|Children|Fantasy
Partition: 0, Value: 3,Grumpier Old Men (1995),Comedy|Romance
Partition: 0, Value: 4,Waiting to Exhale (1995),Comedy|Drama|Romance
Partition: 1, Value: 10,GoldenEye (1995),Action|Adventure|Thriller
Partition: 1, Value: 11,"American President, The (1995)",Comedy|Drama|Romance
Partition: 1, Value: 12,Dracula: Dead and Loving It (1995),Comedy|Horror
Partition: 1, Value: 13,Balto (1995),Adventure|Animation|Children
Partition: 1, Value: 14,Nixon (1995),Drama</code></pre>
</div>
</div>
</section>
<section id="countbyvalue" class="level4">
<h4 class="anchored" data-anchor-id="countbyvalue">countByValue()</h4>
<ul>
<li>값의 갯수를 계산</li>
</ul>
<div id="3c2f0271" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rdd1.countByValue()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>defaultdict(int,
            {'movieId,title,genres': 1,
             '1,Toy Story (1995),Adventure|Animation|Children|Comedy|Fantasy': 1,
             '2,Jumanji (1995),Adventure|Children|Fantasy': 1,
             '3,Grumpier Old Men (1995),Comedy|Romance': 1,
             '4,Waiting to Exhale (1995),Comedy|Drama|Romance': 1,
             '5,Father of the Bride Part II (1995),Comedy': 1,
             '6,Heat (1995),Action|Crime|Thriller': 1,
             '7,Sabrina (1995),Comedy|Romance': 1,
             '8,Tom and Huck (1995),Adventure|Children': 1,
             '9,Sudden Death (1995),Action': 1,
             '10,GoldenEye (1995),Action|Adventure|Thriller': 1,
             '11,"American President, The (1995)",Comedy|Drama|Romance': 1,
             '12,Dracula: Dead and Loving It (1995),Comedy|Horror': 1,
             '13,Balto (1995),Adventure|Animation|Children': 1,
             '14,Nixon (1995),Drama': 1,
             '15,Cutthroat Island (1995),Action|Adventure|Romance': 1,
             '16,Casino (1995),Crime|Drama': 1,
             '17,Sense and Sensibility (1995),Drama|Romance': 1,
             '18,Four Rooms (1995),Comedy': 1,
             '19,Ace Ventura: When Nature Calls (1995),Comedy': 1,
             '20,Money Train (1995),Action|Comedy|Crime|Drama|Thriller': 1,
             '21,Get Shorty (1995),Comedy|Crime|Thriller': 1,
             '22,Copycat (1995),Crime|Drama|Horror|Mystery|Thriller': 1,
             '23,Assassins (1995),Action|Crime|Thriller': 1,
             '24,Powder (1995),Drama|Sci-Fi': 1,
             '25,Leaving Las Vegas (1995),Drama|Romance': 1,
             '26,Othello (1995),Drama': 1,
             '27,Now and Then (1995),Children|Drama': 1,
             '28,Persuasion (1995),Drama|Romance': 1,
             '29,"City of Lost Children, The (Cité des enfants perdus, La) (1995)",Adventure|Drama|Fantasy|Mystery|Sci-Fi': 1,
             '30,Shanghai Triad (Yao a yao yao dao waipo qiao) (1995),Crime|Drama': 1,
             '31,Dangerous Minds (1995),Drama': 1,
             '32,Twelve Monkeys (a.k.a. 12 Monkeys) (1995),Mystery|Sci-Fi|Thriller': 1,
             '34,Babe (1995),Children|Drama': 1,
             '36,Dead Man Walking (1995),Crime|Drama': 1,
             '38,It Takes Two (1995),Children|Comedy': 1,
             '39,Clueless (1995),Comedy|Romance': 1,
             '40,"Cry, the Beloved Country (1995)",Drama': 1,
             '41,Richard III (1995),Drama|War': 1,
             '42,Dead Presidents (1995),Action|Crime|Drama': 1,
             '43,Restoration (1995),Drama': 1,
             '44,Mortal Kombat (1995),Action|Adventure|Fantasy': 1,
             '45,To Die For (1995),Comedy|Drama|Thriller': 1,
             '46,How to Make an American Quilt (1995),Drama|Romance': 1,
             '47,Seven (a.k.a. Se7en) (1995),Mystery|Thriller': 1,
             '48,Pocahontas (1995),Animation|Children|Drama|Musical|Romance': 1,
             '49,When Night Is Falling (1995),Drama|Romance': 1,
             '50,"Usual Suspects, The (1995)",Crime|Mystery|Thriller': 1,
             '52,Mighty Aphrodite (1995),Comedy|Drama|Romance': 1,
             '53,Lamerica (1994),Adventure|Drama': 1,
             '54,"Big Green, The (1995)",Children|Comedy': 1,
             '55,Georgia (1995),Drama': 1,
             '57,Home for the Holidays (1995),Drama': 1,
             '58,"Postman, The (Postino, Il) (1994)",Comedy|Drama|Romance': 1,
             '60,"Indian in the Cupboard, The (1995)",Adventure|Children|Fantasy': 1,
             '61,Eye for an Eye (1996),Drama|Thriller': 1,
             "62,Mr. Holland's Opus (1995),Drama": 1,
             "63,Don't Be a Menace to South Central While Drinking Your Juice in the Hood (1996),Comedy|Crime": 1,
             '64,Two if by Sea (1996),Comedy|Romance': 1,
             '65,Bio-Dome (1996),Comedy': 1,
             '66,Lawnmower Man 2: Beyond Cyberspace (1996),Action|Sci-Fi|Thriller': 1,
             '68,French Twist (Gazon maudit) (1995),Comedy|Romance': 1,
             '69,Friday (1995),Comedy': 1,
             '70,From Dusk Till Dawn (1996),Action|Comedy|Horror|Thriller': 1,
             '71,Fair Game (1995),Action': 1,
             '72,Kicking and Screaming (1995),Comedy|Drama': 1,
             '73,"Misérables, Les (1995)",Drama|War': 1,
             '74,Bed of Roses (1996),Drama|Romance': 1,
             '75,Big Bully (1996),Comedy|Drama': 1,
             '76,Screamers (1995),Action|Sci-Fi|Thriller': 1,
             '77,Nico Icon (1995),Documentary': 1,
             '78,"Crossing Guard, The (1995)",Action|Crime|Drama|Thriller': 1,
             '79,"Juror, The (1996)",Drama|Thriller': 1,
             '80,"White Balloon, The (Badkonake sefid) (1995)",Children|Drama': 1,
             "81,Things to Do in Denver When You're Dead (1995),Crime|Drama|Romance": 1,
             "82,Antonia's Line (Antonia) (1995),Comedy|Drama": 1,
             '83,Once Upon a Time... When We Were Colored (1995),Drama|Romance': 1,
             '85,Angels and Insects (1995),Drama|Romance': 1,
             '86,White Squall (1996),Action|Adventure|Drama': 1,
             '87,Dunston Checks In (1996),Children|Comedy': 1,
             '88,Black Sheep (1996),Comedy': 1,
             '89,Nick of Time (1995),Action|Thriller': 1,
             '92,Mary Reilly (1996),Drama|Horror|Thriller': 1,
             '93,Vampire in Brooklyn (1995),Comedy|Horror|Romance': 1,
             '94,Beautiful Girls (1996),Comedy|Drama|Romance': 1,
             '95,Broken Arrow (1996),Action|Adventure|Thriller': 1,
             '96,In the Bleak Midwinter (1995),Comedy|Drama': 1,
             '97,"Hate (Haine, La) (1995)",Crime|Drama': 1,
             '99,Heidi Fleiss: Hollywood Madam (1995),Documentary': 1,
             '100,City Hall (1996),Drama|Thriller': 1,
             '101,Bottle Rocket (1996),Adventure|Comedy|Crime|Romance': 1,
             '102,Mr. Wrong (1996),Comedy': 1,
             '103,Unforgettable (1996),Mystery|Sci-Fi|Thriller': 1,
             '104,Happy Gilmore (1996),Comedy': 1,
             '105,"Bridges of Madison County, The (1995)",Drama|Romance': 1,
             '106,Nobody Loves Me (Keiner liebt mich) (1994),Comedy|Drama': 1,
             '107,Muppet Treasure Island (1996),Adventure|Children|Comedy|Musical': 1,
             '108,Catwalk (1996),Documentary': 1,
             '110,Braveheart (1995),Action|Drama|War': 1,
             '111,Taxi Driver (1976),Crime|Drama|Thriller': 1,
             '112,Rumble in the Bronx (Hont faan kui) (1995),Action|Adventure|Comedy|Crime': 1,
             '113,Before and After (1996),Drama|Mystery': 1,
             '116,Anne Frank Remembered (1995),Documentary': 1,
             '117,"Young Poisoner\'s Handbook, The (1995)",Crime|Drama': 1,
             '118,If Lucy Fell (1996),Comedy|Romance': 1,
             '119,"Steal Big, Steal Little (1995)",Comedy': 1,
             '121,"Boys of St. Vincent, The (1992)",Drama': 1,
             '122,Boomerang (1992),Comedy|Romance': 1,
             '123,Chungking Express (Chung Hing sam lam) (1994),Drama|Mystery|Romance': 1,
             '125,Flirting With Disaster (1996),Comedy': 1,
             '126,"NeverEnding Story III, The (1994)",Adventure|Children|Fantasy': 1,
             "128,Jupiter's Wife (1994),Documentary": 1,
             '129,Pie in the Sky (1996),Comedy|Romance': 1,
             '132,Jade (1995),Thriller': 1,
             '135,Down Periscope (1996),Comedy': 1,
             '137,Man of the Year (1995),Documentary': 1,
             '140,Up Close and Personal (1996),Drama|Romance': 1,
             '141,"Birdcage, The (1996)",Comedy': 1,
             '144,"Brothers McMullen, The (1995)",Comedy': 1,
             '145,Bad Boys (1995),Action|Comedy|Crime|Drama|Thriller': 1,
             '146,"Amazing Panda Adventure, The (1995)",Adventure|Children': 1,
             '147,"Basketball Diaries, The (1995)",Drama': 1,
             '148,"Awfully Big Adventure, An (1995)",Drama': 1,
             '149,Amateur (1994),Crime|Drama|Thriller': 1,
             '150,Apollo 13 (1995),Adventure|Drama|IMAX': 1,
             '151,Rob Roy (1995),Action|Drama|Romance|War': 1,
             '152,"Addiction, The (1995)",Drama|Horror': 1,
             '153,Batman Forever (1995),Action|Adventure|Comedy|Crime': 1,
             '154,Beauty of the Day (Belle de jour) (1967),Drama': 1,
             '155,Beyond Rangoon (1995),Adventure|Drama|War': 1,
             '156,Blue in the Face (1995),Comedy|Drama': 1,
             '157,Canadian Bacon (1995),Comedy|War': 1,
             '158,Casper (1995),Adventure|Children': 1,
             '159,Clockers (1995),Crime|Drama|Mystery': 1,
             '160,Congo (1995),Action|Adventure|Mystery|Sci-Fi': 1,
             '161,Crimson Tide (1995),Drama|Thriller|War': 1,
             '162,Crumb (1994),Documentary': 1,
             '163,Desperado (1995),Action|Romance|Western': 1,
             '164,Devil in a Blue Dress (1995),Crime|Film-Noir|Mystery|Thriller': 1,
             '165,Die Hard: With a Vengeance (1995),Action|Crime|Thriller': 1,
             '166,"Doom Generation, The (1995)",Comedy|Crime|Drama': 1,
             '168,First Knight (1995),Action|Drama|Romance': 1,
             '169,Free Willy 2: The Adventure Home (1995),Adventure|Children|Drama': 1,
             '170,Hackers (1995),Action|Adventure|Crime|Thriller': 1,
             '171,Jeffrey (1995),Comedy|Drama': 1,
             '172,Johnny Mnemonic (1995),Action|Sci-Fi|Thriller': 1,
             '173,Judge Dredd (1995),Action|Crime|Sci-Fi': 1,
             '174,Jury Duty (1995),Comedy': 1,
             '175,Kids (1995),Drama': 1,
             '176,Living in Oblivion (1995),Comedy': 1,
             '177,Lord of Illusions (1995),Horror': 1,
             '178,Love &amp; Human Remains (1993),Comedy|Drama': 1,
             '179,Mad Love (1995),Drama|Romance': 1,
             '180,Mallrats (1995),Comedy|Romance': 1,
             '181,Mighty Morphin Power Rangers: The Movie (1995),Action|Children': 1,
             '183,Mute Witness (1994),Comedy|Horror|Thriller': 1,
             '184,Nadja (1994),Drama': 1,
             '185,"Net, The (1995)",Action|Crime|Thriller': 1,
             '186,Nine Months (1995),Comedy|Romance': 1,
             '187,Party Girl (1995),Comedy': 1,
             '188,"Prophecy, The (1995)",Fantasy|Horror|Mystery': 1,
             '189,Reckless (1995),Comedy|Fantasy': 1,
             '190,Safe (1995),Thriller': 1,
             '191,"Scarlet Letter, The (1995)",Drama|Romance': 1,
             '193,Showgirls (1995),Drama': 1,
             '194,Smoke (1995),Comedy|Drama': 1,
             '195,Something to Talk About (1995),Comedy|Drama|Romance': 1,
             '196,Species (1995),Horror|Sci-Fi': 1,
             '198,Strange Days (1995),Action|Crime|Drama|Mystery|Sci-Fi|Thriller': 1,
             '199,"Umbrellas of Cherbourg, The (Parapluies de Cherbourg, Les) (1964)",Drama|Musical|Romance': 1,
             '201,Three Wishes (1995),Drama|Fantasy': 1,
             '202,Total Eclipse (1995),Drama|Romance': 1,
             '203,"To Wong Foo, Thanks for Everything! Julie Newmar (1995)",Comedy': 1,
             '204,Under Siege 2: Dark Territory (1995),Action': 1,
             '205,Unstrung Heroes (1995),Comedy|Drama': 1,
             '206,Unzipped (1995),Documentary': 1,
             '207,"Walk in the Clouds, A (1995)",Drama|Romance': 1,
             '208,Waterworld (1995),Action|Adventure|Sci-Fi': 1,
             "209,White Man's Burden (1995),Drama": 1,
             '210,Wild Bill (1995),Western': 1,
             '211,"Browning Version, The (1994)",Drama': 1,
             '212,Bushwhacked (1995),Adventure|Comedy|Crime|Mystery': 1,
             '213,Burnt by the Sun (Utomlyonnye solntsem) (1994),Drama': 1,
             '214,Before the Rain (Pred dozhdot) (1994),Drama|War': 1,
             '215,Before Sunrise (1995),Drama|Romance': 1,
             '216,Billy Madison (1995),Comedy': 1,
             '217,"Babysitter, The (1995)",Drama|Thriller': 1,
             '218,Boys on the Side (1995),Comedy|Drama': 1,
             '219,"Cure, The (1995)",Drama': 1,
             '220,Castle Freak (1995),Horror': 1,
             '222,Circle of Friends (1995),Drama|Romance': 1,
             '223,Clerks (1994),Comedy': 1,
             '224,Don Juan DeMarco (1995),Comedy|Drama|Romance': 1,
             '225,Disclosure (1994),Drama|Thriller': 1,
             '227,Drop Zone (1994),Action|Thriller': 1,
             '228,Destiny Turns on the Radio (1995),Comedy': 1,
             '229,Death and the Maiden (1994),Drama|Thriller': 1,
             '230,Dolores Claiborne (1995),Drama|Thriller': 1,
             '231,Dumb &amp; Dumber (Dumb and Dumber) (1994),Adventure|Comedy': 1,
             '232,Eat Drink Man Woman (Yin shi nan nu) (1994),Comedy|Drama|Romance': 1,
             '233,Exotica (1994),Drama': 1,
             '234,Exit to Eden (1994),Comedy': 1,
             '235,Ed Wood (1994),Comedy|Drama': 1,
             '236,French Kiss (1995),Action|Comedy|Romance': 1,
             '237,Forget Paris (1995),Comedy|Romance': 1,
             '238,Far From Home: The Adventures of Yellow Dog (1995),Adventure|Children': 1,
             '239,"Goofy Movie, A (1995)",Animation|Children|Comedy|Romance': 1,
             '240,Hideaway (1995),Thriller': 1,
             '241,Fluke (1995),Children|Drama': 1,
             '242,Farinelli: il castrato (1994),Drama|Musical': 1,
             '243,Gordy (1995),Children|Comedy|Fantasy': 1,
             '246,Hoop Dreams (1994),Documentary': 1,
             '247,Heavenly Creatures (1994),Crime|Drama': 1,
             '248,Houseguest (1994),Comedy': 1,
             '249,Immortal Beloved (1994),Drama|Romance': 1,
             '250,Heavyweights (Heavy Weights) (1995),Children|Comedy': 1,
             '251,"Hunted, The (1995)",Action': 1,
             '252,I.Q. (1994),Comedy|Romance': 1,
             '253,Interview with the Vampire: The Vampire Chronicles (1994),Drama|Horror': 1,
             '254,Jefferson in Paris (1995),Drama': 1,
             '255,"Jerky Boys, The (1995)",Comedy': 1,
             '256,Junior (1994),Comedy|Sci-Fi': 1,
             '257,Just Cause (1995),Mystery|Thriller': 1,
             '258,"Kid in King Arthur\'s Court, A (1995)",Adventure|Children|Comedy|Fantasy|Romance': 1,
             '259,Kiss of Death (1995),Crime|Drama|Thriller': 1,
             '260,Star Wars: Episode IV - A New Hope (1977),Action|Adventure|Sci-Fi': 1,
             '261,Little Women (1994),Drama': 1,
             '262,"Little Princess, A (1995)",Children|Drama': 1,
             '263,Ladybird Ladybird (1994),Drama': 1,
             '265,Like Water for Chocolate (Como agua para chocolate) (1992),Drama|Fantasy|Romance': 1,
             '266,Legends of the Fall (1994),Drama|Romance|War|Western': 1,
             '267,Major Payne (1995),Comedy': 1,
             '269,My Crazy Life (Mi vida loca) (1993),Drama': 1,
             '270,Love Affair (1994),Drama|Romance': 1,
             '271,Losing Isaiah (1995),Drama': 1,
             '272,"Madness of King George, The (1994)",Comedy|Drama': 1,
             "273,Mary Shelley's Frankenstein (Frankenstein) (1994),Drama|Horror|Sci-Fi": 1,
             '274,Man of the House (1995),Comedy': 1,
             '275,Mixed Nuts (1994),Comedy': 1,
             '276,Milk Money (1994),Comedy|Romance': 1,
             '277,Miracle on 34th Street (1994),Drama': 1,
             '278,Miami Rhapsody (1995),Comedy': 1,
             '279,My Family (1995),Drama': 1,
             '280,Murder in the First (1995),Drama|Thriller': 1,
             "281,Nobody's Fool (1994),Comedy|Drama|Romance": 1,
             '282,Nell (1994),Drama': 1,
             '283,New Jersey Drive (1995),Crime|Drama': 1,
             '284,New York Cop (Nyû Yôku no koppu) (1993),Action|Crime': 1,
             '285,Beyond Bedlam (1993),Drama|Horror': 1,
             '287,Nina Takes a Lover (1994),Comedy|Romance': 1,
             '288,Natural Born Killers (1994),Action|Crime|Thriller': 1,
             '289,Only You (1994),Comedy|Romance': 1,
             '290,Once Were Warriors (1994),Crime|Drama': 1,
             '291,Poison Ivy II (1996),Drama|Thriller': 1,
             '292,Outbreak (1995),Action|Drama|Sci-Fi|Thriller': 1,
             '293,Léon: The Professional (a.k.a. The Professional) (Léon) (1994),Action|Crime|Drama|Thriller': 1,
             '294,"Perez Family, The (1995)",Comedy|Romance': 1,
             '295,"Pyromaniac\'s Love Story, A (1995)",Comedy|Romance': 1,
             '296,Pulp Fiction (1994),Comedy|Crime|Drama|Thriller': 1,
             '298,Pushing Hands (Tui shou) (1992),Drama': 1,
             '299,Priest (1994),Drama': 1,
             '300,Quiz Show (1994),Drama': 1,
             '301,Picture Bride (Bijo photo) (1994),Drama|Romance': 1,
             '302,"Queen Margot (Reine Margot, La) (1994)",Drama|Romance': 1,
             '303,"Quick and the Dead, The (1995)",Action|Thriller|Western': 1,
             '304,Roommates (1995),Comedy|Drama': 1,
             '305,Ready to Wear (Pret-A-Porter) (1994),Comedy': 1,
             '306,Three Colors: Red (Trois couleurs: Rouge) (1994),Drama': 1,
             '307,Three Colors: Blue (Trois couleurs: Bleu) (1993),Drama': 1,
             '308,Three Colors: White (Trzy kolory: Bialy) (1994),Comedy|Drama': 1,
             '310,Rent-a-Kid (1995),Comedy': 1,
             '311,Relative Fear (1994),Horror|Thriller': 1,
             '312,Stuart Saves His Family (1995),Comedy': 1,
             '313,"Swan Princess, The (1994)",Animation|Children': 1,
             '314,"Secret of Roan Inish, The (1994)",Children|Drama|Fantasy|Mystery': 1,
             '315,"Specialist, The (1994)",Action|Drama|Thriller': 1,
             '316,Stargate (1994),Action|Adventure|Sci-Fi': 1,
             '317,"Santa Clause, The (1994)",Comedy|Drama|Fantasy': 1,
             '318,"Shawshank Redemption, The (1994)",Crime|Drama': 1,
             '319,Shallow Grave (1994),Comedy|Drama|Thriller': 1,
             '320,Suture (1993),Film-Noir|Thriller': 1,
             '321,Strawberry and Chocolate (Fresa y chocolate) (1993),Drama': 1,
             '322,Swimming with Sharks (1995),Comedy|Drama': 1,
             '324,"Sum of Us, The (1994)",Comedy|Drama': 1,
             "325,National Lampoon's Senior Trip (1995),Comedy": 1,
             '326,To Live (Huozhe) (1994),Drama': 1,
             '327,Tank Girl (1995),Action|Comedy|Sci-Fi': 1,
             '328,Tales from the Crypt Presents: Demon Knight (1995),Horror|Thriller': 1,
             '329,Star Trek: Generations (1994),Adventure|Drama|Sci-Fi': 1,
             '330,Tales from the Hood (1995),Action|Crime|Horror': 1,
             '331,Tom &amp; Viv (1994),Drama': 1,
             '332,Village of the Damned (1995),Horror|Sci-Fi': 1,
             '333,Tommy Boy (1995),Comedy': 1,
             '334,Vanya on 42nd Street (1994),Drama': 1,
             '335,Underneath (1995),Mystery|Thriller': 1,
             '336,"Walking Dead, The (1995)",Drama|War': 1,
             "337,What's Eating Gilbert Grape (1993),Drama": 1,
             '338,Virtuosity (1995),Action|Sci-Fi|Thriller': 1,
             '339,While You Were Sleeping (1995),Comedy|Romance': 1,
             '340,"War, The (1994)",Adventure|Drama|War': 1,
             '341,Double Happiness (1994),Drama': 1,
             "342,Muriel's Wedding (1994),Comedy": 1,
             '343,"Baby-Sitters Club, The (1995)",Children': 1,
             '344,Ace Ventura: Pet Detective (1994),Comedy': 1,
             '345,"Adventures of Priscilla, Queen of the Desert, The (1994)",Comedy|Drama': 1,
             '346,Backbeat (1993),Drama|Musical': 1,
             '347,Bitter Moon (1992),Drama|Film-Noir|Romance': 1,
             '348,Bullets Over Broadway (1994),Comedy': 1,
             '349,Clear and Present Danger (1994),Action|Crime|Drama|Thriller': 1,
             '350,"Client, The (1994)",Drama|Mystery|Thriller': 1,
             '351,"Corrina, Corrina (1994)",Comedy|Drama|Romance': 1,
             '352,Crooklyn (1994),Comedy|Drama': 1,
             '353,"Crow, The (1994)",Action|Crime|Fantasy|Thriller': 1,
             '354,Cobb (1994),Drama': 1,
             '355,"Flintstones, The (1994)",Children|Comedy|Fantasy': 1,
             '356,Forrest Gump (1994),Comedy|Drama|Romance|War': 1,
             '357,Four Weddings and a Funeral (1994),Comedy|Romance': 1,
             '358,Higher Learning (1995),Drama': 1,
             '359,I Like It Like That (1994),Comedy|Drama|Romance': 1,
             '360,I Love Trouble (1994),Action|Comedy': 1,
             '361,It Could Happen to You (1994),Comedy|Drama|Romance': 1,
             '362,"Jungle Book, The (1994)",Adventure|Children|Romance': 1,
             '363,"Wonderful, Horrible Life of Leni Riefenstahl, The (Macht der Bilder: Leni Riefenstahl, Die) (1993)",Documentary': 1,
             '364,"Lion King, The (1994)",Adventure|Animation|Children|Drama|Musical|IMAX': 1,
             '365,Little Buddha (1993),Drama': 1,
             '366,"Wes Craven\'s New Nightmare (Nightmare on Elm Street Part 7: Freddy\'s Finale, A) (1994)",Drama|Horror|Mystery|Thriller': 1,
             '367,"Mask, The (1994)",Action|Comedy|Crime|Fantasy': 1,
             '368,Maverick (1994),Adventure|Comedy|Western': 1,
             '369,Mrs. Parker and the Vicious Circle (1994),Drama': 1,
             '370,Naked Gun 33 1/3: The Final Insult (1994),Action|Comedy': 1,
             '371,"Paper, The (1994)",Comedy|Drama': 1,
             '372,Reality Bites (1994),Comedy|Drama|Romance': 1,
             '373,Red Rock West (1992),Thriller': 1,
             '374,Richie Rich (1994),Children|Comedy': 1,
             '376,"River Wild, The (1994)",Action|Thriller': 1,
             '377,Speed (1994),Action|Romance|Thriller': 1,
             '378,Speechless (1994),Comedy|Romance': 1,
             '379,Timecop (1994),Action|Sci-Fi|Thriller': 1,
             '380,True Lies (1994),Action|Adventure|Comedy|Romance|Thriller': 1,
             '381,When a Man Loves a Woman (1994),Drama|Romance': 1,
             '382,Wolf (1994),Drama|Horror|Romance|Thriller': 1,
             '383,Wyatt Earp (1994),Western': 1,
             '384,Bad Company (1995),Action|Crime|Drama': 1,
             '385,"Man of No Importance, A (1994)",Drama': 1,
             '386,S.F.W. (1994),Drama': 1,
             '387,"Low Down Dirty Shame, A (1994)",Action|Comedy': 1,
             '388,Boys Life (1995),Drama': 1,
             '389,"Colonel Chabert, Le (1994)",Drama|Romance|War': 1,
             '390,Faster Pussycat! Kill! Kill! (1965),Action|Crime|Drama': 1,
             "391,Jason's Lyric (1994),Crime|Drama": 1,
             '393,Street Fighter (1994),Action|Adventure|Fantasy': 1,
             '405,Highlander III: The Sorcerer (a.k.a. Highlander: The Final Dimension) (1994),Action|Fantasy': 1,
             '406,Federal Hill (1994),Drama': 1,
             '407,In the Mouth of Madness (1995),Horror|Thriller': 1,
             '408,8 Seconds (1994),Drama': 1,
             '409,Above the Rim (1994),Crime|Drama': 1,
             '410,Addams Family Values (1993),Children|Comedy|Fantasy': 1,
             '412,"Age of Innocence, The (1993)",Drama': 1,
             '413,Airheads (1994),Comedy': 1,
             '414,"Air Up There, The (1994)",Comedy': 1,
             '415,Another Stakeout (1993),Comedy|Thriller': 1,
             '416,Bad Girls (1994),Western': 1,
             '417,Barcelona (1994),Comedy|Romance': 1,
             '418,Being Human (1993),Drama': 1,
             '419,"Beverly Hillbillies, The (1993)",Comedy': 1,
             '420,Beverly Hills Cop III (1994),Action|Comedy|Crime|Thriller': 1,
             '421,Black Beauty (1994),Adventure|Children|Drama': 1,
             '422,Blink (1994),Thriller': 1,
             '423,Blown Away (1994),Action|Thriller': 1,
             '424,Blue Chips (1994),Drama': 1,
             '425,Blue Sky (1994),Drama|Romance': 1,
             '426,Body Snatchers (1993),Horror|Sci-Fi|Thriller': 1,
             '427,Boxing Helena (1993),Drama|Mystery|Romance|Thriller': 1,
             '428,"Bronx Tale, A (1993)",Drama': 1,
             '429,Cabin Boy (1994),Comedy': 1,
             '430,Calendar Girl (1993),Comedy|Drama': 1,
             "431,Carlito's Way (1993),Crime|Drama": 1,
             "432,City Slickers II: The Legend of Curly's Gold (1994),Adventure|Comedy|Western": 1,
             '433,Clean Slate (1994),Comedy': 1,
             '434,Cliffhanger (1993),Action|Adventure|Thriller': 1,
             '435,Coneheads (1993),Comedy|Sci-Fi': 1,
             '436,Color of Night (1994),Drama|Thriller': 1,
             '437,Cops and Robbersons (1994),Comedy': 1,
             '438,"Cowboy Way, The (1994)",Action|Comedy|Drama': 1,
             '440,Dave (1993),Comedy|Romance': 1,
             '441,Dazed and Confused (1993),Comedy': 1,
             '442,Demolition Man (1993),Action|Adventure|Sci-Fi': 1,
             '444,Even Cowgirls Get the Blues (1993),Comedy|Romance': 1,
             '445,Fatal Instinct (1993),Comedy': 1,
             '446,Farewell My Concubine (Ba wang bie ji) (1993),Drama|Romance': 1,
             '448,Fearless (1993),Drama': 1,
             '449,Fear of a Black Hat (1994),Comedy': 1,
             '450,With Honors (1994),Comedy|Drama': 1,
             '451,Flesh and Bone (1993),Drama|Mystery|Romance': 1,
             "452,Widows' Peak (1994),Drama": 1,
             '453,For Love or Money (1993),Comedy|Romance': 1,
             '454,"Firm, The (1993)",Drama|Thriller': 1,
             '455,Free Willy (1993),Adventure|Children|Drama': 1,
             '456,Fresh (1994),Crime|Drama|Thriller': 1,
             '457,"Fugitive, The (1993)",Thriller': 1,
             '458,Geronimo: An American Legend (1993),Drama|Western': 1,
             '459,"Getaway, The (1994)",Action|Adventure|Crime|Drama|Romance|Thriller': 1,
             '460,Getting Even with Dad (1994),Comedy': 1,
             '461,Go Fish (1994),Drama|Romance': 1,
             '464,Hard Target (1993),Action|Adventure|Crime|Thriller': 1,
             '466,Hot Shots! Part Deux (1993),Action|Comedy|War': 1,
             '467,Live Nude Girls (1995),Comedy': 1,
             '468,"Englishman Who Went Up a Hill But Came Down a Mountain, The (1995)",Comedy|Romance': 1,
             '469,"House of the Spirits, The (1993)",Drama|Romance': 1,
             '470,House Party 3 (1994),Comedy': 1,
             '471,"Hudsucker Proxy, The (1994)",Comedy': 1,
             "472,I'll Do Anything (1994),Comedy|Drama": 1,
             '473,In the Army Now (1994),Comedy|War': 1,
             '474,In the Line of Fire (1993),Action|Thriller': 1,
             '475,In the Name of the Father (1993),Drama': 1,
             '476,"Inkwell, The (1994)",Comedy|Drama': 1,
             "477,What's Love Got to Do with It? (1993),Drama|Musical": 1,
             '478,Jimmy Hollywood (1994),Comedy|Crime|Drama': 1,
             '479,Judgment Night (1993),Action|Crime|Thriller': 1,
             '480,Jurassic Park (1993),Action|Adventure|Sci-Fi|Thriller': 1,
             '481,Kalifornia (1993),Drama|Thriller': 1,
             '482,Killing Zoe (1994),Crime|Drama|Thriller': 1,
             '484,Lassie (1994),Adventure|Children': 1,
             '485,Last Action Hero (1993),Action|Adventure|Comedy|Fantasy': 1,
             '486,Life with Mikey (1993),Comedy': 1,
             '487,Lightning Jack (1994),Comedy|Western': 1,
             '488,M. Butterfly (1993),Drama|Romance': 1,
             '489,Made in America (1993),Comedy': 1,
             '490,Malice (1993),Thriller': 1,
             '491,"Man Without a Face, The (1993)",Drama': 1,
             '492,Manhattan Murder Mystery (1993),Comedy|Mystery': 1,
             '493,Menace II Society (1993),Action|Crime|Drama': 1,
             '494,Executive Decision (1996),Action|Adventure|Thriller': 1,
             '495,In the Realm of the Senses (Ai no corrida) (1976),Drama': 1,
             '496,What Happened Was... (1994),Comedy|Drama|Romance|Thriller': 1,
             '497,Much Ado About Nothing (1993),Comedy|Romance': 1,
             '499,Mr. Wonderful (1993),Comedy|Romance': 1,
             '500,Mrs. Doubtfire (1993),Comedy|Drama': 1,
             '501,Naked (1993),Drama': 1,
             '502,"Next Karate Kid, The (1994)",Action|Children|Romance': 1,
             '504,No Escape (1994),Action|Drama|Sci-Fi': 1,
             '505,North (1994),Comedy': 1,
             '506,Orlando (1992),Drama|Fantasy|Romance': 1,
             '507,"Perfect World, A (1993)",Crime|Drama|Thriller': 1,
             '508,Philadelphia (1993),Drama': 1,
             '509,"Piano, The (1993)",Drama|Romance': 1,
             '510,Poetic Justice (1993),Drama': 1,
             '511,"Program, The (1993)",Action|Drama': 1,
             '512,"Puppet Masters, The (1994)",Horror|Sci-Fi': 1,
             '513,Radioland Murders (1994),Comedy|Mystery|Romance': 1,
             '514,"Ref, The (1994)",Comedy': 1,
             '515,"Remains of the Day, The (1993)",Drama|Romance': 1,
             '516,Renaissance Man (1994),Comedy|Drama': 1,
             '517,Rising Sun (1993),Action|Drama|Mystery': 1,
             '518,"Road to Wellville, The (1994)",Comedy': 1,
             '519,RoboCop 3 (1993),Action|Crime|Drama|Sci-Fi|Thriller': 1,
             '520,Robin Hood: Men in Tights (1993),Comedy': 1,
             '521,Romeo Is Bleeding (1993),Crime|Thriller': 1,
             '522,Romper Stomper (1992),Action|Drama': 1,
             '523,Ruby in Paradise (1993),Drama': 1,
             '524,Rudy (1993),Drama': 1,
             '526,"Savage Nights (Nuits fauves, Les) (1992)",Drama': 1,
             "527,Schindler's List (1993),Drama|War": 1,
             '528,"Scout, The (1994)",Comedy|Drama': 1,
             '529,Searching for Bobby Fischer (1993),Drama': 1,
             '531,"Secret Garden, The (1993)",Children|Drama': 1,
             '532,Serial Mom (1994),Comedy|Crime|Horror': 1,
             '533,"Shadow, The (1994)",Action|Adventure|Fantasy|Mystery': 1,
             '534,Shadowlands (1993),Drama|Romance': 1,
             '535,Short Cuts (1993),Drama': 1,
             '536,"Simple Twist of Fate, A (1994)",Drama': 1,
             '537,Sirens (1994),Drama': 1,
             '538,Six Degrees of Separation (1993),Drama': 1,
             '539,Sleepless in Seattle (1993),Comedy|Drama|Romance': 1,
             '540,Sliver (1993),Thriller': 1,
             '541,Blade Runner (1982),Action|Sci-Fi|Thriller': 1,
             '542,Son in Law (1993),Comedy|Drama|Romance': 1,
             '543,So I Married an Axe Murderer (1993),Comedy|Romance|Thriller': 1,
             '544,Striking Distance (1993),Action|Crime': 1,
             '546,Super Mario Bros. (1993),Action|Adventure|Children|Comedy|Fantasy|Sci-Fi': 1,
             '547,Surviving the Game (1994),Action|Adventure|Thriller': 1,
             '548,Terminal Velocity (1994),Action|Mystery|Thriller': 1,
             '549,Thirty-Two Short Films About Glenn Gould (1993),Drama|Musical': 1,
             '550,Threesome (1994),Comedy|Romance': 1,
             '551,"Nightmare Before Christmas, The (1993)",Animation|Children|Fantasy|Musical': 1,
             '552,"Three Musketeers, The (1993)",Action|Adventure|Comedy|Romance': 1,
             '553,Tombstone (1993),Action|Drama|Western': 1,
             '555,True Romance (1993),Crime|Thriller': 1,
             '556,"War Room, The (1993)",Documentary': 1,
             '558,"Pagemaster, The (1994)",Action|Adventure|Animation|Children|Fantasy': 1,
             '562,Welcome to the Dollhouse (1995),Comedy|Drama': 1,
             '563,Germinal (1993),Drama|Romance': 1,
             '564,Chasers (1994),Comedy': 1,
             '567,Kika (1993),Comedy|Drama': 1,
             '568,Bhaji on the Beach (1993),Comedy|Drama': 1,
             '569,Little Big League (1994),Comedy|Drama': 1,
             '573,"Ciao, Professore! (Io speriamo che me la cavo) (1992)",Drama': 1,
             '574,Spanking the Monkey (1994),Comedy|Drama': 1,
             '575,"Little Rascals, The (1994)",Children|Comedy': 1,
             '577,Andre (1994),Adventure|Children|Drama': 1,
             '579,"Escort, The (Scorta, La) (1993)",Crime|Thriller': 1,
             '580,Princess Caraboo (1994),Drama': 1,
             '581,"Celluloid Closet, The (1995)",Documentary': 1,
             '583,Dear Diary (Caro Diario) (1994),Comedy|Drama': 1,
             '585,"Brady Bunch Movie, The (1995)",Comedy': 1,
             '586,Home Alone (1990),Children|Comedy': 1,
             '587,Ghost (1990),Comedy|Drama|Fantasy|Romance|Thriller': 1,
             '588,Aladdin (1992),Adventure|Animation|Children|Comedy|Musical': 1,
             '589,Terminator 2: Judgment Day (1991),Action|Sci-Fi': 1,
             '590,Dances with Wolves (1990),Adventure|Drama|Western': 1,
             '592,Batman (1989),Action|Crime|Thriller': 1,
             '593,"Silence of the Lambs, The (1991)",Crime|Horror|Thriller': 1,
             '594,Snow White and the Seven Dwarfs (1937),Animation|Children|Drama|Fantasy|Musical': 1,
             '595,Beauty and the Beast (1991),Animation|Children|Fantasy|Musical|Romance|IMAX': 1,
             '596,Pinocchio (1940),Animation|Children|Fantasy|Musical': 1,
             '597,Pretty Woman (1990),Comedy|Romance': 1,
             '599,"Wild Bunch, The (1969)",Adventure|Western': 1,
             '600,Love and a .45 (1994),Action|Comedy|Crime': 1,
             '602,"Great Day in Harlem, A (1994)",Documentary': 1,
             '605,One Fine Day (1996),Drama|Romance': 1,
             '606,Candyman: Farewell to the Flesh (1995),Fantasy|Horror': 1,
             '608,Fargo (1996),Comedy|Crime|Drama|Thriller': 1,
             '609,Homeward Bound II: Lost in San Francisco (1996),Adventure|Children': 1,
             '610,Heavy Metal (1981),Action|Adventure|Animation|Horror|Sci-Fi': 1,
             '611,Hellraiser: Bloodline (1996),Action|Horror|Sci-Fi': 1,
             '612,"Pallbearer, The (1996)",Comedy': 1,
             '613,Jane Eyre (1996),Drama|Romance': 1,
             '615,Bread and Chocolate (Pane e cioccolata) (1973),Comedy|Drama': 1,
             '616,"Aristocats, The (1970)",Animation|Children': 1,
             '617,"Flower of My Secret, The (La flor de mi secreto) (1995)",Comedy|Drama': 1,
             '618,Two Much (1995),Comedy|Romance': 1,
             '619,Ed (1996),Comedy': 1,
             '626,"Thin Line Between Love and Hate, A (1996)",Comedy': 1,
             '627,"Last Supper, The (1995)",Drama|Thriller': 1,
             '628,Primal Fear (1996),Crime|Drama|Mystery|Thriller': 1,
             '631,All Dogs Go to Heaven 2 (1996),Adventure|Animation|Children|Fantasy|Musical|Romance': 1,
             '632,Land and Freedom (Tierra y libertad) (1995),Drama|War': 1,
             '633,Denise Calls Up (1995),Comedy': 1,
             '634,Theodore Rex (1995),Comedy': 1,
             '635,"Family Thing, A (1996)",Comedy|Drama': 1,
             '636,Frisk (1995),Drama': 1,
             '637,Sgt. Bilko (1996),Comedy': 1,
             '638,Jack and Sarah (1995),Romance': 1,
             '639,Girl 6 (1996),Comedy|Drama': 1,
             '640,Diabolique (1996),Drama|Thriller': 1,
             '645,Nelly &amp; Monsieur Arnaud (1995),Drama': 1,
             '647,Courage Under Fire (1996),Action|Crime|Drama|War': 1,
             '648,Mission: Impossible (1996),Action|Adventure|Mystery|Thriller': 1,
             '649,Cold Fever (Á köldum klaka) (1995),Comedy|Drama': 1,
             '650,Moll Flanders (1996),Drama': 1,
             '653,Dragonheart (1996),Action|Adventure|Fantasy': 1,
             '656,Eddie (1996),Comedy': 1,
             '661,James and the Giant Peach (1996),Adventure|Animation|Children|Fantasy|Musical': 1,
             '662,Fear (1996),Thriller': 1,
             '663,Kids in the Hall: Brain Candy (1996),Comedy': 1,
             '665,Underground (1995),Comedy|Drama|War': 1,
             '667,Bloodsport 2 (a.k.a. Bloodsport II: The Next Kumite) (1996),Action': 1,
             '668,Song of the Little Road (Pather Panchali) (1955),Drama': 1,
             '670,"World of Apu, The (Apur Sansar) (1959)",Drama': 1,
             '671,Mystery Science Theater 3000: The Movie (1996),Comedy|Sci-Fi': 1,
             '673,Space Jam (1996),Adventure|Animation|Children|Comedy|Fantasy|Sci-Fi': 1,
             '674,Barbarella (1968),Adventure|Comedy|Sci-Fi': 1,
             '678,Some Folks Call It a Sling Blade (1993),Drama|Thriller': 1,
             '679,"Run of the Country, The (1995)",Drama': 1,
             '680,"Alphaville (Alphaville, une étrange aventure de Lemmy Caution) (1965)",Drama|Mystery|Romance|Sci-Fi|Thriller': 1,
             "685,It's My Party (1996),Drama": 1,
             '688,Operation Dumbo Drop (1995),Action|Adventure|Comedy|War': 1,
             '691,Mrs. Winterbourne (1996),Comedy|Romance': 1,
             '692,Solo (1996),Action|Sci-Fi|Thriller': 1,
             '694,"Substitute, The (1996)",Action|Crime|Drama': 1,
             '695,True Crime (1996),Mystery|Thriller': 1,
             '697,Feeling Minnesota (1996),Drama|Romance': 1,
             '698,Delta of Venus (1995),Drama': 1,
             '700,Angus (1995),Comedy': 1,
             '703,Boys (1996),Drama': 1,
             '704,"Quest, The (1996)",Action|Adventure': 1,
             '706,Sunset Park (1996),Drama': 1,
             '707,Mulholland Falls (1996),Crime|Drama|Thriller': 1,
             '708,"Truth About Cats &amp; Dogs, The (1996)",Comedy|Romance': 1,
             '709,Oliver &amp; Company (1988),Adventure|Animation|Children|Comedy|Musical': 1,
             '710,Celtic Pride (1996),Comedy': 1,
             '711,Flipper (1996),Adventure|Children': 1,
             '714,Dead Man (1995),Drama|Mystery|Western': 1,
             '715,"Horseman on the Roof, The (Hussard sur le toit, Le) (1995)",Drama|Romance': 1,
             '718,"Visitors, The (Visiteurs, Les) (1993)",Comedy|Fantasy|Sci-Fi': 1,
             '719,Multiplicity (1996),Comedy': 1,
             '720,Wallace &amp; Gromit: The Best of Aardman Animation (1996),Adventure|Animation|Comedy': 1,
             '722,"Haunted World of Edward D. Wood Jr., The (1996)",Documentary': 1,
             '724,"Craft, The (1996)",Drama|Fantasy|Horror|Thriller': 1,
             '725,"Great White Hype, The (1996)",Comedy': 1,
             '726,Last Dance (1996),Drama': 1,
             '728,Cold Comfort Farm (1995),Comedy': 1,
             "731,Heaven's Prisoners (1996),Crime|Thriller": 1,
             '733,"Rock, The (1996)",Action|Adventure|Thriller': 1,
             '735,Cemetery Man (Dellamorte Dellamore) (1994),Horror': 1,
             '736,Twister (1996),Action|Adventure|Romance|Thriller': 1,
             '737,Barb Wire (1996),Action|Sci-Fi': 1,
             '741,Ghost in the Shell (Kôkaku kidôtai) (1995),Animation|Sci-Fi': 1,
             '742,Thinner (1996),Horror|Thriller': 1,
             '743,Spy Hard (1996),Comedy': 1,
             '745,Wallace &amp; Gromit: A Close Shave (1995),Animation|Children|Comedy': 1,
             '747,"Stupids, The (1996)",Comedy': 1,
             '748,"Arrival, The (1996)",Action|Sci-Fi|Thriller': 1,
             '750,Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb (1964),Comedy|War': 1,
             '757,Ashes of Time (Dung che sai duk) (1994),Drama': 1,
             '759,Maya Lin: A Strong Clear Vision (1994),Documentary': 1,
             '760,Stalingrad (1993),Drama|War': 1,
             '761,"Phantom, The (1996)",Action|Adventure': 1,
             '762,Striptease (1996),Comedy|Crime': 1,
             '764,Heavy (1995),Drama|Romance': 1,
             '765,Jack (1996),Comedy|Drama': 1,
             '766,I Shot Andy Warhol (1996),Drama': 1,
             '773,Touki Bouki (1973),Drama': 1,
             '775,Spirits of the Dead (1968),Horror|Mystery': 1,
             '778,Trainspotting (1996),Comedy|Crime|Drama': 1,
             "779,'Til There Was You (1997),Drama|Romance": 1,
             '780,Independence Day (a.k.a. ID4) (1996),Action|Adventure|Sci-Fi|Thriller': 1,
             '781,Stealing Beauty (1996),Drama': 1,
             '782,"Fan, The (1996)",Drama|Thriller': 1,
             '783,"Hunchback of Notre Dame, The (1996)",Animation|Children|Drama|Musical|Romance': 1,
             '784,"Cable Guy, The (1996)",Comedy|Thriller': 1,
             '785,Kingpin (1996),Comedy': 1,
             '786,Eraser (1996),Action|Drama|Thriller': 1,
             '788,"Nutty Professor, The (1996)",Comedy|Fantasy|Romance|Sci-Fi': 1,
             '790,"Unforgettable Summer, An (Un été inoubliable) (1994)",Drama': 1,
             '791,"Last Klezmer: Leopold Kozlowski, His Life and Music, The (1994)",Documentary': 1,
             '795,Somebody to Love (1994),Drama': 1,
             '798,Daylight (1996),Action|Adventure|Drama|Thriller': 1,
             '799,"Frighteners, The (1996)",Comedy|Horror|Thriller': 1,
             '800,Lone Star (1996),Drama|Mystery|Western': 1,
             '801,Harriet the Spy (1996),Children|Comedy': 1,
             '802,Phenomenon (1996),Drama|Romance': 1,
             '803,Walking and Talking (1996),Comedy|Drama|Romance': 1,
             "804,She's the One (1996),Comedy|Romance": 1,
             '805,"Time to Kill, A (1996)",Drama|Thriller': 1,
             '806,American Buffalo (1996),Crime|Drama': 1,
             '808,Alaska (1996),Adventure|Children': 1,
             '809,Fled (1996),Action|Adventure': 1,
             '810,Kazaam (1996),Children|Comedy|Fantasy': 1,
             '813,Larger Than Life (1996),Comedy': 1,
             '818,"Very Brady Sequel, A (1996)",Comedy': 1,
             '823,"Collector, The (La collectionneuse) (1967)",Drama': 1,
             '824,Kaspar Hauser (1993),Drama|Mystery': 1,
             '828,"Adventures of Pinocchio, The (1996)",Adventure|Children': 1,
             "829,Joe's Apartment (1996),Comedy|Fantasy|Musical": 1,
             '830,"First Wives Club, The (1996)",Comedy': 1,
             '832,Ransom (1996),Crime|Thriller': 1,
             '833,High School High (1996),Comedy': 1,
             '835,Foxfire (1996),Drama': 1,
             '836,Chain Reaction (1996),Action|Adventure|Thriller': 1,
             '837,Matilda (1996),Children|Comedy|Fantasy': 1,
             '838,Emma (1996),Comedy|Drama|Romance': 1,
             '839,"Crow: City of Angels, The (1996)",Action|Thriller': 1,
             '840,House Arrest (1996),Children|Comedy': 1,
             '841,"Eyes Without a Face (Yeux sans visage, Les) (1959)",Horror': 1,
             '842,Tales from the Crypt Presents: Bordello of Blood (1996),Comedy|Horror': 1,
             '848,"Spitfire Grill, The (1996)",Drama': 1,
             '849,Escape from L.A. (1996),Action|Adventure|Sci-Fi|Thriller': 1,
             '851,Basquiat (1996),Drama': 1,
             '852,Tin Cup (1996),Comedy|Drama|Romance': 1,
             '858,"Godfather, The (1972)",Crime|Drama': 1,
             '861,Supercop (Police Story 3: Supercop) (Jing cha gu shi III: Chao ji jing cha) (1992),Action|Comedy|Crime|Thriller': 1,
             '866,Bound (1996),Crime|Drama|Romance|Thriller': 1,
             '867,Carpool (1996),Comedy|Crime': 1,
             '869,Kansas City (1996),Crime|Drama|Musical|Thriller': 1,
             "870,Gone Fishin' (1997),Comedy": 1,
             '875,Nothing to Lose (1994),Action|Crime|Drama': 1,
             '876,Supercop 2 (Project S) (Chao ji ji hua) (1993),Action|Comedy|Crime|Thriller': 1,
             '879,"Relic, The (1997)",Horror|Thriller': 1,
             '880,"Island of Dr. Moreau, The (1996)",Sci-Fi|Thriller': 1,
             '881,First Kid (1996),Children|Comedy': 1,
             '882,"Trigger Effect, The (1996)",Drama|Thriller': 1,
             '885,Bogus (1996),Children|Drama|Fantasy': 1,
             '886,Bulletproof (1996),Action|Comedy|Crime': 1,
             '888,Land Before Time III: The Time of the Great Giving (1995),Adventure|Animation|Children|Musical': 1,
             '889,1-900 (06) (1994),Drama|Romance': 1,
             '891,Halloween: The Curse of Michael Myers (Halloween 6: The Curse of Michael Myers) (1995),Horror|Thriller': 1,
             '892,Twelfth Night (1996),Comedy|Drama|Romance': 1,
             '893,Mother Night (1996),Drama': 1,
             '896,Wild Reeds (Les roseaux sauvages) (1994),Drama': 1,
             '897,For Whom the Bell Tolls (1943),Adventure|Drama|Romance|War': 1,
             '898,"Philadelphia Story, The (1940)",Comedy|Drama|Romance': 1,
             "899,Singin' in the Rain (1952),Comedy|Musical|Romance": 1,
             '900,"American in Paris, An (1951)",Musical|Romance': 1,
             '901,Funny Face (1957),Comedy|Musical': 1,
             "902,Breakfast at Tiffany's (1961),Drama|Romance": 1,
             '903,Vertigo (1958),Drama|Mystery|Romance|Thriller': 1,
             '904,Rear Window (1954),Mystery|Thriller': 1,
             '905,It Happened One Night (1934),Comedy|Romance': 1,
             '906,Gaslight (1944),Drama|Thriller': 1,
             '907,"Gay Divorcee, The (1934)",Comedy|Musical|Romance': 1,
             '908,North by Northwest (1959),Action|Adventure|Mystery|Romance|Thriller': 1,
             '909,"Apartment, The (1960)",Comedy|Drama|Romance': 1,
             '910,Some Like It Hot (1959),Comedy|Crime': 1,
             '911,Charade (1963),Comedy|Crime|Mystery|Romance|Thriller': 1,
             '912,Casablanca (1942),Drama|Romance': 1,
             '913,"Maltese Falcon, The (1941)",Film-Noir|Mystery': 1,
             '914,My Fair Lady (1964),Comedy|Drama|Musical|Romance': 1,
             '915,Sabrina (1954),Comedy|Romance': 1,
             '916,Roman Holiday (1953),Comedy|Drama|Romance': 1,
             '917,"Little Princess, The (1939)",Children|Drama': 1,
             '918,Meet Me in St. Louis (1944),Musical': 1,
             '919,"Wizard of Oz, The (1939)",Adventure|Children|Fantasy|Musical': 1,
             '920,Gone with the Wind (1939),Drama|Romance|War': 1,
             '921,My Favorite Year (1982),Comedy': 1,
             '922,Sunset Blvd. (a.k.a. Sunset Boulevard) (1950),Drama|Film-Noir|Romance': 1,
             '923,Citizen Kane (1941),Drama|Mystery': 1,
             '924,2001: A Space Odyssey (1968),Adventure|Drama|Sci-Fi': 1,
             '926,All About Eve (1950),Drama': 1,
             '927,"Women, The (1939)",Comedy': 1,
             '928,Rebecca (1940),Drama|Mystery|Romance|Thriller': 1,
             '929,Foreign Correspondent (1940),Drama|Film-Noir|Mystery|Thriller': 1,
             '930,Notorious (1946),Film-Noir|Romance|Thriller': 1,
             '931,Spellbound (1945),Mystery|Romance|Thriller': 1,
             '932,"Affair to Remember, An (1957)",Drama|Romance': 1,
             '933,To Catch a Thief (1955),Crime|Mystery|Romance|Thriller': 1,
             '934,Father of the Bride (1950),Comedy': 1,
             '935,"Band Wagon, The (1953)",Comedy|Musical': 1,
             '936,Ninotchka (1939),Comedy|Romance': 1,
             '937,Love in the Afternoon (1957),Comedy|Romance': 1,
             '938,Gigi (1958),Musical': 1,
             '940,"Adventures of Robin Hood, The (1938)",Action|Adventure|Romance': 1,
             '941,"Mark of Zorro, The (1940)",Adventure': 1,
             '942,Laura (1944),Crime|Film-Noir|Mystery': 1,
             '943,"Ghost and Mrs. Muir, The (1947)",Drama|Fantasy|Romance': 1,
             '944,Lost Horizon (1937),Drama': 1,
             '945,Top Hat (1935),Comedy|Musical|Romance': 1,
             '946,To Be or Not to Be (1942),Comedy|Drama|War': 1,
             '947,My Man Godfrey (1936),Comedy|Romance': 1,
             '948,Giant (1956),Drama|Romance|Western': 1,
             '949,East of Eden (1955),Drama': 1,
             '950,"Thin Man, The (1934)",Comedy|Crime': 1,
             '951,His Girl Friday (1940),Comedy|Romance': 1,
             '952,Around the World in 80 Days (1956),Adventure|Comedy': 1,
             "953,It's a Wonderful Life (1946),Children|Drama|Fantasy|Romance": 1,
             '954,Mr. Smith Goes to Washington (1939),Drama': 1,
             '955,Bringing Up Baby (1938),Comedy|Romance': 1,
             '956,Penny Serenade (1941),Drama|Romance': 1,
             '959,Of Human Bondage (1934),Drama': 1,
             '961,Little Lord Fauntleroy (1936),Drama': 1,
             '963,"Inspector General, The (1949)",Musical': 1,
             '965,"39 Steps, The (1935)",Drama|Mystery|Thriller': 1,
             '968,Night of the Living Dead (1968),Horror|Sci-Fi|Thriller': 1,
             '969,"African Queen, The (1951)",Adventure|Comedy|Romance|War': 1,
             '970,Beat the Devil (1953),Adventure|Comedy|Crime|Drama|Romance': 1,
             '971,Cat on a Hot Tin Roof (1958),Drama': 1,
             '973,Meet John Doe (1941),Comedy|Drama': 1,
             '976,"Farewell to Arms, A (1932)",Romance|War': 1,
             '979,Nothing Personal (1995),Drama|War': 1,
             '981,Dangerous Ground (1997),Drama': 1,
             '982,Picnic (1955),Drama': 1,
             '984,"Pompatus of Love, The (1996)",Comedy|Drama': 1,
             '986,Fly Away Home (1996),Adventure|Children': 1,
             '987,Bliss (1997),Drama|Romance': 1,
             '988,Grace of My Heart (1996),Comedy|Drama': 1,
             '990,Maximum Risk (1996),Action|Adventure|Thriller': 1,
             '991,Michael Collins (1996),Drama': 1,
             '993,Infinity (1996),Drama': 1,
             '994,Big Night (1996),Comedy|Drama': 1,
             '996,Last Man Standing (1996),Action|Crime|Drama|Thriller': 1,
             '998,Set It Off (1996),Action|Crime': 1,
             '999,2 Days in the Valley (1996),Crime|Film-Noir': 1,
             '1003,Extreme Measures (1996),Drama|Thriller': 1,
             '1004,"Glimmer Man, The (1996)",Action|Thriller': 1,
             '1005,D3: The Mighty Ducks (1996),Children|Comedy': 1,
             '1006,"Chamber, The (1996)",Drama': 1,
             '1007,"Apple Dumpling Gang, The (1975)",Children|Comedy|Western': 1,
             '1008,"Davy Crockett, King of the Wild Frontier (1955)",Adventure|Western': 1,
             '1009,Escape to Witch Mountain (1975),Adventure|Children|Fantasy': 1,
             '1010,"Love Bug, The (1969)",Children|Comedy': 1,
             '1011,Herbie Rides Again (1974),Children|Comedy|Fantasy|Romance': 1,
             '1012,Old Yeller (1957),Children|Drama': 1,
             '1013,"Parent Trap, The (1961)",Children|Comedy|Romance': 1,
             '1014,Pollyanna (1960),Children|Comedy|Drama': 1,
             '1015,Homeward Bound: The Incredible Journey (1993),Adventure|Children|Drama': 1,
             '1016,"Shaggy Dog, The (1959)",Children|Comedy': 1,
             '1017,Swiss Family Robinson (1960),Adventure|Children': 1,
             '1018,That Darn Cat! (1965),Children|Comedy|Mystery': 1,
             '1019,"20,000 Leagues Under the Sea (1954)",Adventure|Drama|Sci-Fi': 1,
             '1020,Cool Runnings (1993),Comedy': 1,
             '1021,Angels in the Outfield (1994),Children|Comedy': 1,
             '1022,Cinderella (1950),Animation|Children|Fantasy|Musical|Romance': 1,
             '1023,Winnie the Pooh and the Blustery Day (1968),Animation|Children|Musical': 1,
             '1024,"Three Caballeros, The (1945)",Animation|Children|Musical': 1,
             '1025,"Sword in the Stone, The (1963)",Animation|Children|Fantasy|Musical': 1,
             '1027,Robin Hood: Prince of Thieves (1991),Adventure|Drama': 1,
             '1028,Mary Poppins (1964),Children|Comedy|Fantasy|Musical': 1,
             '1029,Dumbo (1941),Animation|Children|Drama|Musical': 1,
             "1030,Pete's Dragon (1977),Adventure|Animation|Children|Musical": 1,
             '1031,Bedknobs and Broomsticks (1971),Adventure|Children|Musical': 1,
             '1032,Alice in Wonderland (1951),Adventure|Animation|Children|Fantasy|Musical': 1,
             '1033,"Fox and the Hound, The (1981)",Animation|Children|Drama': 1,
             '1034,Freeway (1996),Comedy|Crime|Drama|Thriller': 1,
             '1035,"Sound of Music, The (1965)",Musical|Romance': 1,
             '1036,Die Hard (1988),Action|Crime|Thriller': 1,
             '1037,"Lawnmower Man, The (1992)",Action|Horror|Sci-Fi|Thriller': 1,
             '1040,"Secret Agent, The (1996)",Drama': 1,
             '1041,Secrets &amp; Lies (1996),Drama': 1,
             '1042,That Thing You Do! (1996),Comedy|Drama': 1,
             '1043,To Gillian on Her 37th Birthday (1996),Drama|Romance': 1,
             '1046,Beautiful Thing (1996),Drama|Romance': 1,
             '1047,"Long Kiss Goodnight, The (1996)",Action|Drama|Thriller': 1,
             '1049,"Ghost and the Darkness, The (1996)",Action|Adventure': 1,
             '1050,Looking for Richard (1996),Documentary|Drama': 1,
             '1051,Trees Lounge (1996),Drama': 1,
             '1053,Normal Life (1996),Crime|Drama|Romance': 1,
             '1054,Get on the Bus (1996),Drama': 1,
             '1055,Shadow Conspiracy (1997),Thriller': 1,
             '1056,Jude (1996),Drama': 1,
             '1057,Everyone Says I Love You (1996),Comedy|Musical|Romance': 1,
             "1059,William Shakespeare's Romeo + Juliet (1996),Drama|Romance": 1,
             '1060,Swingers (1996),Comedy|Drama': 1,
             '1061,Sleepers (1996),Thriller': 1,
             '1064,Aladdin and the King of Thieves (1996),Animation|Children|Comedy|Fantasy|Musical|Romance': 1,
             '1066,Shall We Dance (1937),Comedy|Musical|Romance': 1,
             '1068,Crossfire (1947),Crime|Film-Noir': 1,
             '1073,Willy Wonka &amp; the Chocolate Factory (1971),Children|Comedy|Fantasy|Musical': 1,
             '1076,"Innocents, The (1961)",Drama|Horror|Thriller': 1,
             '1077,Sleeper (1973),Comedy|Sci-Fi': 1,
             '1078,Bananas (1971),Comedy|War': 1,
             '1079,"Fish Called Wanda, A (1988)",Comedy|Crime': 1,
             "1080,Monty Python's Life of Brian (1979),Comedy": 1,
             '1081,Victor/Victoria (1982),Comedy|Musical|Romance': 1,
             '1082,"Candidate, The (1972)",Drama': 1,
             '1083,"Great Race, The (1965)",Comedy|Musical': 1,
             '1084,Bonnie and Clyde (1967),Crime|Drama': 1,
             '1085,"Old Man and the Sea, The (1958)",Adventure|Drama': 1,
             '1086,Dial M for Murder (1954),Crime|Mystery|Thriller': 1,
             '1088,Dirty Dancing (1987),Drama|Musical|Romance': 1,
             '1089,Reservoir Dogs (1992),Crime|Mystery|Thriller': 1,
             '1090,Platoon (1986),Drama|War': 1,
             "1091,Weekend at Bernie's (1989),Comedy": 1,
             '1092,Basic Instinct (1992),Crime|Mystery|Thriller': 1,
             '1093,"Doors, The (1991)",Drama': 1,
             '1094,"Crying Game, The (1992)",Drama|Romance|Thriller': 1,
             '1095,Glengarry Glen Ross (1992),Drama': 1,
             "1096,Sophie's Choice (1982),Drama": 1,
             '1097,E.T. the Extra-Terrestrial (1982),Children|Drama|Sci-Fi': 1,
             '1099,"Christmas Carol, A (1938)",Children|Drama|Fantasy': 1,
             '1100,Days of Thunder (1990),Action|Drama|Romance': 1,
             '1101,Top Gun (1986),Action|Romance': 1,
             '1103,Rebel Without a Cause (1955),Drama': 1,
             '1104,"Streetcar Named Desire, A (1951)",Drama': 1,
             '1105,Children of the Corn IV: The Gathering (1996),Horror': 1,
             '1107,Loser (1991),Comedy': 1,
             "1111,Microcosmos (Microcosmos: Le peuple de l'herbe) (1996),Documentary": 1,
             '1112,Palookaville (1996),Action|Comedy|Drama': 1,
             '1114,"Funeral, The (1996)",Crime|Drama': 1,
             '1116,"Single Girl, A (Fille seule, La) (1995)",Drama': 1,
             '1117,"Eighth Day, The (Huitième jour, Le) (1996)",Drama': 1,
             '1119,Drunks (1995),Drama': 1,
             '1120,"People vs. Larry Flynt, The (1996)",Comedy|Drama': 1,
             '1121,Glory Daze (1995),Drama': 1,
             '1123,"Perfect Candidate, A (1996)",Documentary': 1,
             '1124,On Golden Pond (1981),Drama': 1,
             '1125,"Return of the Pink Panther, The (1975)",Comedy|Crime': 1,
             '1126,Drop Dead Fred (1991),Comedy|Fantasy': 1,
             '1127,"Abyss, The (1989)",Action|Adventure|Sci-Fi|Thriller': 1,
             '1128,"Fog, The (1980)",Horror': 1,
             '1129,Escape from New York (1981),Action|Adventure|Sci-Fi|Thriller': 1,
             '1130,"Howling, The (1980)",Horror|Mystery': 1,
             '1131,Jean de Florette (1986),Drama|Mystery': 1,
             '1132,Manon of the Spring (Manon des sources) (1986),Drama': 1,
             '1135,Private Benjamin (1980),Comedy': 1,
             '1136,Monty Python and the Holy Grail (1975),Adventure|Comedy|Fantasy': 1,
             '1137,Hustler White (1996),Romance': 1,
             '1140,Entertaining Angels: The Dorothy Day Story (1996),Drama': 1,
             '1144,"Line King: The Al Hirschfeld Story, The (1996)",Documentary': 1,
             '1147,When We Were Kings (1996),Documentary': 1,
             '1148,Wallace &amp; Gromit: The Wrong Trousers (1993),Animation|Children|Comedy|Crime': 1,
             '1150,"Return of Martin Guerre, The (Retour de Martin Guerre, Le) (1982)",Drama': 1,
             '1151,Lesson Faust (1994),Animation|Comedy|Drama|Fantasy': 1,
             '1156,"Children Are Watching Us, The (Bambini ci guardano, I) (1944)",Drama': 1,
             '1161,"Tin Drum, The (Blechtrommel, Die) (1979)",Drama|War': 1,
             '1162,"Ruling Class, The (1972)",Comedy|Drama': 1,
             '1163,Mina Tannenbaum (1994),Drama': 1,
             '1167,Dear God (1996),Comedy': 1,
             '1170,Best of the Best 3: No Turning Back (1995),Action': 1,
             '1171,Bob Roberts (1992),Comedy': 1,
             '1172,Cinema Paradiso (Nuovo cinema Paradiso) (1989),Drama': 1,
             '1173,"Cook the Thief His Wife &amp; Her Lover, The (1989)",Comedy|Drama': 1,
             '1175,Delicatessen (1991),Comedy|Drama|Romance': 1,
             '1176,"Double Life of Veronique, The (Double Vie de Véronique, La) (1991)",Drama|Fantasy|Romance': 1,
             '1177,Enchanted April (1992),Drama|Romance': 1,
             '1178,Paths of Glory (1957),Drama|War': 1,
             '1179,"Grifters, The (1990)",Crime|Drama|Film-Noir': 1,
             '1180,Hear My Song (1991),Comedy': 1,
             '1183,"English Patient, The (1996)",Drama|Romance|War': 1,
             '1184,Mediterraneo (1991),Comedy|Drama': 1,
             '1185,My Left Foot (1989),Drama': 1,
             '1186,"Sex, Lies, and Videotape (1989)",Drama': 1,
             '1187,Passion Fish (1992),Drama': 1,
             '1188,Strictly Ballroom (1992),Comedy|Romance': 1,
             '1189,"Thin Blue Line, The (1988)",Documentary': 1,
             '1190,Tie Me Up! Tie Me Down! (¡Átame!) (1990),Crime|Drama|Romance': 1,
             '1191,Madonna: Truth or Dare (1991),Documentary|Musical': 1,
             '1192,Paris Is Burning (1990),Documentary': 1,
             "1193,One Flew Over the Cuckoo's Nest (1975),Drama": 1,
             "1194,Cheech and Chong's Up in Smoke (1978),Comedy": 1,
             '1196,Star Wars: Episode V - The Empire Strikes Back (1980),Action|Adventure|Sci-Fi': 1,
             '1197,"Princess Bride, The (1987)",Action|Adventure|Comedy|Fantasy|Romance': 1,
             '1198,Raiders of the Lost Ark (Indiana Jones and the Raiders of the Lost Ark) (1981),Action|Adventure': 1,
             '1199,Brazil (1985),Fantasy|Sci-Fi': 1,
             '1200,Aliens (1986),Action|Adventure|Horror|Sci-Fi': 1,
             '1201,"Good, the Bad and the Ugly, The (Buono, il brutto, il cattivo, Il) (1966)",Action|Adventure|Western': 1,
             '1202,Withnail &amp; I (1987),Comedy': 1,
             '1203,12 Angry Men (1957),Drama': 1,
             '1204,Lawrence of Arabia (1962),Adventure|Drama|War': 1,
             '1206,"Clockwork Orange, A (1971)",Crime|Drama|Sci-Fi|Thriller': 1,
             '1207,To Kill a Mockingbird (1962),Drama': 1,
             '1208,Apocalypse Now (1979),Action|Drama|War': 1,
             "1209,Once Upon a Time in the West (C'era una volta il West) (1968),Action|Drama|Western": 1,
             '1210,Star Wars: Episode VI - Return of the Jedi (1983),Action|Adventure|Sci-Fi': 1,
             '1211,"Wings of Desire (Himmel über Berlin, Der) (1987)",Drama|Fantasy|Romance': 1,
             '1212,"Third Man, The (1949)",Film-Noir|Mystery|Thriller': 1,
             '1213,Goodfellas (1990),Crime|Drama': 1,
             '1214,Alien (1979),Horror|Sci-Fi': 1,
             '1215,Army of Darkness (1993),Action|Adventure|Comedy|Fantasy|Horror': 1,
             '1216,"Big Blue, The (Grand bleu, Le) (1988)",Adventure|Drama|Romance': 1,
             '1217,Ran (1985),Drama|War': 1,
             '1218,"Killer, The (Die xue shuang xiong) (1989)",Action|Crime|Drama|Thriller': 1,
             '1219,Psycho (1960),Crime|Horror': 1,
             '1220,"Blues Brothers, The (1980)",Action|Comedy|Musical': 1,
             '1221,"Godfather: Part II, The (1974)",Crime|Drama': 1,
             '1222,Full Metal Jacket (1987),Drama|War': 1,
             '1223,"Grand Day Out with Wallace and Gromit, A (1989)",Adventure|Animation|Children|Comedy|Sci-Fi': 1,
             '1224,Henry V (1989),Action|Drama|Romance|War': 1,
             '1225,Amadeus (1984),Drama': 1,
             '1226,"Quiet Man, The (1952)",Drama|Romance': 1,
             '1227,Once Upon a Time in America (1984),Crime|Drama': 1,
             '1228,Raging Bull (1980),Drama': 1,
             '1230,Annie Hall (1977),Comedy|Romance': 1,
             '1231,"Right Stuff, The (1983)",Drama': 1,
             '1232,Stalker (1979),Drama|Mystery|Sci-Fi': 1,
             '1233,"Boot, Das (Boat, The) (1981)",Action|Drama|War': 1,
             '1234,"Sting, The (1973)",Comedy|Crime': 1,
             '1235,Harold and Maude (1971),Comedy|Drama|Romance': 1,
             '1236,Trust (1990),Comedy|Drama|Romance': 1,
             '1237,"Seventh Seal, The (Sjunde inseglet, Det) (1957)",Drama': 1,
             '1238,Local Hero (1983),Comedy': 1,
             '1240,"Terminator, The (1984)",Action|Sci-Fi|Thriller': 1,
             '1241,Dead Alive (Braindead) (1992),Comedy|Fantasy|Horror': 1,
             '1242,Glory (1989),Drama|War': 1,
             '1243,Rosencrantz and Guildenstern Are Dead (1990),Comedy|Drama': 1,
             '1244,Manhattan (1979),Comedy|Drama|Romance': 1,
             "1245,Miller's Crossing (1990),Crime|Drama|Film-Noir|Thriller": 1,
             '1246,Dead Poets Society (1989),Drama': 1,
             '1247,"Graduate, The (1967)",Comedy|Drama|Romance': 1,
             '1248,Touch of Evil (1958),Crime|Film-Noir|Thriller': 1,
             '1249,"Femme Nikita, La (Nikita) (1990)",Action|Crime|Romance|Thriller': 1,
             '1250,"Bridge on the River Kwai, The (1957)",Adventure|Drama|War': 1,
             '1251,8 1/2 (8½) (1963),Drama|Fantasy': 1,
             '1252,Chinatown (1974),Crime|Film-Noir|Mystery|Thriller': 1,
             '1253,"Day the Earth Stood Still, The (1951)",Drama|Sci-Fi|Thriller': 1,
             '1254,"Treasure of the Sierra Madre, The (1948)",Action|Adventure|Drama|Western': 1,
             '1255,Bad Taste (1987),Comedy|Horror|Sci-Fi': 1,
             '1256,Duck Soup (1933),Comedy|Musical|War': 1,
             '1257,Better Off Dead... (1985),Comedy|Romance': 1,
             '1258,"Shining, The (1980)",Horror': 1,
             '1259,Stand by Me (1986),Adventure|Drama': 1,
             '1260,M (1931),Crime|Film-Noir|Thriller': 1,
             '1261,Evil Dead II (Dead by Dawn) (1987),Action|Comedy|Fantasy|Horror': 1,
             '1262,"Great Escape, The (1963)",Action|Adventure|Drama|War': 1,
             '1263,"Deer Hunter, The (1978)",Drama|War': 1,
             '1264,Diva (1981),Action|Drama|Mystery|Romance|Thriller': 1,
             '1265,Groundhog Day (1993),Comedy|Fantasy|Romance': 1,
             '1266,Unforgiven (1992),Drama|Western': 1,
             '1267,"Manchurian Candidate, The (1962)",Crime|Thriller|War': 1,
             '1268,Pump Up the Volume (1990),Comedy|Drama': 1,
             '1269,Arsenic and Old Lace (1944),Comedy|Mystery|Thriller': 1,
             '1270,Back to the Future (1985),Adventure|Comedy|Sci-Fi': 1,
             '1271,Fried Green Tomatoes (1991),Comedy|Crime|Drama': 1,
             '1272,Patton (1970),Drama|War': 1,
             '1273,Down by Law (1986),Comedy|Drama|Film-Noir': 1,
             '1274,Akira (1988),Action|Adventure|Animation|Sci-Fi': 1,
             '1275,Highlander (1986),Action|Adventure|Fantasy': 1,
             '1276,Cool Hand Luke (1967),Drama': 1,
             '1277,Cyrano de Bergerac (1990),Comedy|Drama|Romance': 1,
             '1278,Young Frankenstein (1974),Comedy|Fantasy': 1,
             '1279,Night on Earth (1991),Comedy|Drama': 1,
             '1280,Raise the Red Lantern (Da hong deng long gao gao gua) (1991),Drama': 1,
             '1281,"Great Dictator, The (1940)",Comedy|Drama|War': 1,
             '1282,Fantasia (1940),Animation|Children|Fantasy|Musical': 1,
             '1283,High Noon (1952),Drama|Western': 1,
             '1284,"Big Sleep, The (1946)",Crime|Film-Noir|Mystery': 1,
             '1285,Heathers (1989),Comedy': 1,
             '1286,Somewhere in Time (1980),Drama|Romance': 1,
             '1287,Ben-Hur (1959),Action|Adventure|Drama': 1,
             '1288,This Is Spinal Tap (1984),Comedy': 1,
             '1289,Koyaanisqatsi (a.k.a. Koyaanisqatsi: Life Out of Balance) (1983),Documentary': 1,
             '1290,Some Kind of Wonderful (1987),Drama|Romance': 1,
             '1291,Indiana Jones and the Last Crusade (1989),Action|Adventure': 1,
             '1292,Being There (1979),Comedy|Drama': 1,
             '1293,Gandhi (1982),Drama': 1,
             '1295,"Unbearable Lightness of Being, The (1988)",Drama': 1,
             '1296,"Room with a View, A (1986)",Drama|Romance': 1,
             '1297,Real Genius (1985),Comedy': 1,
             '1298,Pink Floyd: The Wall (1982),Drama|Musical': 1,
             '1299,"Killing Fields, The (1984)",Drama|War': 1,
             '1300,My Life as a Dog (Mitt liv som hund) (1985),Comedy|Drama': 1,
             ...})</code></pre>
</div>
</div>
</section>
<section id="countapproxdistinct" class="level4">
<h4 class="anchored" data-anchor-id="countapproxdistinct">countApproxDistinct()</h4>
<ul>
<li>Spark내부의 Approx알고리즘이 Count해줌
<ul>
<li>데이터가 작을수록 알고리즘 효율이 떨어짐</li>
</ul></li>
<li>데이터가 큰 경우 Count만으로도 오래걸릴 수 있음
<ul>
<li><p>Accumulator를 활용하는게 더 빠를 수 있음 (아래는 이해만을 위한 틀린 코드)</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rdd4.foreachPartition(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    accumulator ac</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    ac.add(<span class="dv">1</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul>
<div id="a1039774" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Approx</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>rdd1.countApproxDistinct()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>10275</code></pre>
</div>
</div>
<div id="0f6ceb3d" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(rdd1.distinct().collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>9743</code></pre>
</div>
</div>
</section>
<section id="cache" class="level4">
<h4 class="anchored" data-anchor-id="cache">Cache</h4>
<ul>
<li>중간에 캐싱을 해 둠</li>
<li>캐싱을 해두었다면 메모리가 터졌을 때, 좀 더 빠르게 계산될 수 있음 (Optimization도움)</li>
<li>캐싱할 때마다, Spark내부적으로 메타데이터 연산(Statistics)을 조금씩 해줌 (Optimization도움)</li>
<li>데이터가 크다면 한번의 작업이 끝날때마다 캐싱을 해두는 것을 추천
<ul>
<li>아래와 같이 작업마다 캐싱</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>rdd2 <span class="op">=</span> rdd1.<span class="bu">filter</span>(...).where().select()</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>rdd2.cache()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<div id="0bb0c554" class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cache</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>rdd2.cache()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>PythonRDD[34] at RDD at PythonRDD.scala:53</code></pre>
</div>
</div>
</section>
<section id="checkpoint" class="level4">
<h4 class="anchored" data-anchor-id="checkpoint">CheckPoint</h4>
<ul>
<li>캐싱도 중간값을 저장해서 비슷하지만, CheckPoint는 명시적으로 어디에 저장할지 정의해야 함</li>
<li>테스트해 본 결과, 아래와 같이 생성되었음
<ul>
<li>_de-2024\2024-08-23 072646.217657\8f6fcbb9-d532-4e6e-a928-39b809364967</li>
</ul></li>
</ul>
<div id="386496dd" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>sc.setCheckpointDir(<span class="st">"../data/temp/checkpoint/"</span> <span class="op">+</span> <span class="bu">str</span>(datetime.now()))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>rdd2.checkpoint()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="persist" class="level4">
<h4 class="anchored" data-anchor-id="persist">Persist</h4>
<ul>
<li>어떤 StorageLevel에 쓸지 정의 가능 (Default는 메모리)
<ul>
<li>무거운 연산을 해야한다면 일부러 디스크를 내릴 때 쓰기도 함 <code>python     from pyspark import StorageLevel     rdd2.persist(StorageLevel.DISK_ONLY)</code></li>
<li>메모리에 올라가지 않아서 아예 멈추는 상황도 생길 수 있어 사용(어떻게든 계산을 시키기 위함)</li>
</ul></li>
</ul>
<div id="f91b9954" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark <span class="im">import</span> StorageLevel</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>rdd2.persist(StorageLevel.MEMORY_ONLY)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd2.getStorageLevel())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Memory Serialized 1x Replicated</code></pre>
</div>
</div>
</section>
<section id="파티션-관련" class="level4">
<h4 class="anchored" data-anchor-id="파티션-관련">파티션 관련</h4>
<ul>
<li>getNumPartitions() : 파티션의 수</li>
</ul>
<div id="b2e31a95" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>rdd1.getNumPartitions()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>3</code></pre>
</div>
</div>
<ul>
<li>partitioner : 파티션을 어떻게 나눌지에 대한 알고리즘이 들어있음
<ul>
<li>기본값은 Hash</li>
</ul></li>
</ul>
<div id="b5798a2c" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd1.partitioner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>None</code></pre>
</div>
</div>
<ul>
<li>repartition() : 파티션의 수 지정
<ul>
<li>기본 알고리즘인 Hashing이 사용되었을 것임</li>
</ul></li>
</ul>
<div id="7271d2a1" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>rdd1 <span class="op">=</span> rdd1.repartition(<span class="dv">3</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd1.getNumPartitions())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3</code></pre>
</div>
</div>
<ul>
<li>coalesce() : 파티션 수 줄이기
<ul>
<li><strong>repartition()으로 줄이는 것보다 효율적</strong>
<ul>
<li>repartition으로 줄이면 Hashing, DiskI/O 등으로 Shuffle이 발생할 수 밖에 없지만</li>
<li>coalesce는 Hashing을 다시 하지 않도록, 최소한의 이동이 일어나도록 함</li>
</ul></li>
</ul></li>
</ul>
<div id="d2952003" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>rdd1 <span class="op">=</span> rdd1.coalesce(<span class="dv">2</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd1.getNumPartitions())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2</code></pre>
</div>
</div>
</section>
<section id="기타" class="level4">
<h4 class="anchored" data-anchor-id="기타">기타</h4>
<div id="9d99f4c1" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>rdd1.isEmpty()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div id="867d663a" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> []</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>rdd5 <span class="op">=</span> sc.parallelize(data)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>rdd5.isEmpty()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div id="01dc87e7" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Max, Min</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>rdd2 <span class="op">=</span> sc.<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd2.<span class="bu">max</span>())</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd2.<span class="bu">min</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>999
0</code></pre>
</div>
</div>
<div id="3bef3848" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Meta</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>rdd1 <span class="op">=</span> sc.textFile(<span class="st">"../data/movies.csv"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd1.<span class="bu">id</span>) </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd1.context) <span class="co"># 어떤 SparkContext를 사용중인지</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdd1.toDebugString)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;bound method RDD.id of ../data/movies.csv MapPartitionsRDD[33] at textFile at NativeMethodAccessorImpl.java:0&gt;
&lt;SparkContext master=local appName=rdd-dataframe&gt;
&lt;bound method RDD.toDebugString of ../data/movies.csv MapPartitionsRDD[33] at textFile at NativeMethodAccessorImpl.java:0&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="rdd-transformation" class="level3">
<h3 class="anchored" data-anchor-id="rdd-transformation">(2) RDD Transformation</h3>
<div id="b4032e5e" class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 실습을 위한 기초코드</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="st">"co1,tcol2,tA_B_C"</span>, <span class="st">"col,tcol3,tD_E_F"</span>]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>rdd1 <span class="op">=</span> sc.parallelize(data)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>rdd1.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['co1,tcol2,tA_B_C', 'col,tcol3,tD_E_F']</code></pre>
</div>
</div>
<div id="6c7011ee" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>rdd2 <span class="op">=</span> rdd1.<span class="bu">map</span>(<span class="kw">lambda</span> v: v.upper())</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>rdd2.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['CO1,TCOL2,TA_B_C', 'COL,TCOL3,TD_E_F']</code></pre>
</div>
</div>
<div id="1533034f" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>rdd5 <span class="op">=</span> rdd1.<span class="bu">map</span>(<span class="kw">lambda</span> v: v.split(<span class="st">','</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>rdd5.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[['co1', 'tcol2', 'tA_B_C'], ['col', 'tcol3', 'tD_E_F']]</code></pre>
</div>
</div>
<div id="e6b94e06" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mapPartitions</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>rdd3 <span class="op">=</span> rdd1.mapPartitions(<span class="kw">lambda</span> it: <span class="bu">map</span>(<span class="kw">lambda</span> v: v.upper(), it))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>rdd3.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['CO1,TCOL2,TA_B_C', 'COL,TCOL3,TD_E_F']</code></pre>
</div>
</div>
<div id="52b62dcf" class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mapPartitionsWithIndex (mapPartitions + Index)</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>rdd4 <span class="op">=</span> rdd1.mapPartitionsWithIndex(<span class="kw">lambda</span> idx, it: <span class="bu">map</span>(<span class="kw">lambda</span> v: <span class="ss">f"idx:</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">, value:</span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span>, it))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>rdd4.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['idx:0, value:co1,tcol2,tA_B_C', 'idx:0, value:col,tcol3,tD_E_F']</code></pre>
</div>
</div>
<div id="10fd5cf3" class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># flatMap</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>rdd6 <span class="op">=</span> rdd1.flatMap(<span class="kw">lambda</span> v: v.split(<span class="st">","</span>))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>rdd6.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['co1', 'tcol2', 'tA_B_C', 'col', 'tcol3', 'tD_E_F']</code></pre>
</div>
</div>
<div id="5e9f8775" class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># distinct</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>rdd8 <span class="op">=</span> sc.parallelize([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">10</span>]).distinct()</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>rdd8.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[1, 2, 3, 5, 6, 8, 10]</code></pre>
</div>
</div>
<div id="1643cb48" class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subtract (겹치는 것을 제거)</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> sc.parallelize([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> sc.parallelize([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>])</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>rdd10 <span class="op">=</span> r1.subtract(r2)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>rdd10.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[2, 1, 3]</code></pre>
</div>
</div>
<div id="2a1f5ce0" class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glom</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>rdd <span class="op">=</span> sc.<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>rdd.glom().collect()</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>rdd.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
</div>
</div>
</section>
<section id="rdd-with-key-value-pairs" class="level3">
<h3 class="anchored" data-anchor-id="rdd-with-key-value-pairs">(3) RDD with key-value pairs</h3>
<div id="d40f60b5" class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 실습을 위한 기초코드</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"d"</span>]</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>rdd1 <span class="op">=</span> sc.parallelize(data)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>rdd2 <span class="op">=</span> rdd1.<span class="bu">map</span>(<span class="kw">lambda</span> v: (v, <span class="dv">1</span>))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>rdd2.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('a', 1), ('b', 1), ('c', 1), ('b', 1), ('b', 1), ('d', 1)]</code></pre>
</div>
</div>
<div id="71e61360" class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mapValues : rdd1은 key-value pair가 아님 [mapValues는 key-value pair를 위한 API이므로 오류발생]</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>rdd1.mapValues(<span class="kw">lambda</span> v: v <span class="op">+</span> <span class="dv">1</span>).take(<span class="dv">10</span>) <span class="co"># error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>24/08/23 12:21:30 ERROR Executor: Exception in task 0.0 in stage 62.0 (TID 113)
org.apache.spark.api.python.PythonException: Traceback (most recent call last):
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 604, in main
    process()
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 596, in process
    serializer.dump_stream(out_iter, outfile)
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/serializers.py", line 259, in dump_stream
    vs = list(itertools.islice(iterator, batch))
  File "/usr/local/spark/python/pyspark/rdd.py", line 1560, in takeUpToNumLeft
    yield next(iterator)
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/util.py", line 73, in wrapper
    return f(*args, **kwargs)
  File "/usr/local/spark/python/pyspark/rdd.py", line 2276, in &lt;lambda&gt;
    map_values_fn = lambda kv: (kv[0], f(kv[1]))
IndexError: string index out of range

    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.handlePythonException(PythonRunner.scala:517)
    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:652)
    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:635)
    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.hasNext(PythonRunner.scala:470)
    at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
    at scala.collection.Iterator.foreach(Iterator.scala:941)
    at scala.collection.Iterator.foreach$(Iterator.scala:941)
    at org.apache.spark.InterruptibleIterator.foreach(InterruptibleIterator.scala:28)
    at scala.collection.generic.Growable.$plus$plus$eq(Growable.scala:62)
    at scala.collection.generic.Growable.$plus$plus$eq$(Growable.scala:53)
    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:105)
    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:49)
    at scala.collection.TraversableOnce.to(TraversableOnce.scala:315)
    at scala.collection.TraversableOnce.to$(TraversableOnce.scala:313)
    at org.apache.spark.InterruptibleIterator.to(InterruptibleIterator.scala:28)
    at scala.collection.TraversableOnce.toBuffer(TraversableOnce.scala:307)
    at scala.collection.TraversableOnce.toBuffer$(TraversableOnce.scala:307)
    at org.apache.spark.InterruptibleIterator.toBuffer(InterruptibleIterator.scala:28)
    at scala.collection.TraversableOnce.toArray(TraversableOnce.scala:294)
    at scala.collection.TraversableOnce.toArray$(TraversableOnce.scala:288)
    at org.apache.spark.InterruptibleIterator.toArray(InterruptibleIterator.scala:28)
    at org.apache.spark.api.python.PythonRDD$.$anonfun$runJob$1(PythonRDD.scala:166)
    at org.apache.spark.SparkContext.$anonfun$runJob$5(SparkContext.scala:2236)
    at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
    at org.apache.spark.scheduler.Task.run(Task.scala:131)
    at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
    at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
    at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
    at java.base/java.lang.Thread.run(Thread.java:829)
24/08/23 12:21:30 WARN TaskSetManager: Lost task 0.0 in stage 62.0 (TID 113) (7b9e2a0ad7ba executor driver): org.apache.spark.api.python.PythonException: Traceback (most recent call last):
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 604, in main
    process()
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 596, in process
    serializer.dump_stream(out_iter, outfile)
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/serializers.py", line 259, in dump_stream
    vs = list(itertools.islice(iterator, batch))
  File "/usr/local/spark/python/pyspark/rdd.py", line 1560, in takeUpToNumLeft
    yield next(iterator)
  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/util.py", line 73, in wrapper
    return f(*args, **kwargs)
  File "/usr/local/spark/python/pyspark/rdd.py", line 2276, in &lt;lambda&gt;
    map_values_fn = lambda kv: (kv[0], f(kv[1]))
IndexError: string index out of range

    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.handlePythonException(PythonRunner.scala:517)
    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:652)
    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:635)
    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.hasNext(PythonRunner.scala:470)
    at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
    at scala.collection.Iterator.foreach(Iterator.scala:941)
    at scala.collection.Iterator.foreach$(Iterator.scala:941)
    at org.apache.spark.InterruptibleIterator.foreach(InterruptibleIterator.scala:28)
    at scala.collection.generic.Growable.$plus$plus$eq(Growable.scala:62)
    at scala.collection.generic.Growable.$plus$plus$eq$(Growable.scala:53)
    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:105)
    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:49)
    at scala.collection.TraversableOnce.to(TraversableOnce.scala:315)
    at scala.collection.TraversableOnce.to$(TraversableOnce.scala:313)
    at org.apache.spark.InterruptibleIterator.to(InterruptibleIterator.scala:28)
    at scala.collection.TraversableOnce.toBuffer(TraversableOnce.scala:307)
    at scala.collection.TraversableOnce.toBuffer$(TraversableOnce.scala:307)
    at org.apache.spark.InterruptibleIterator.toBuffer(InterruptibleIterator.scala:28)
    at scala.collection.TraversableOnce.toArray(TraversableOnce.scala:294)
    at scala.collection.TraversableOnce.toArray$(TraversableOnce.scala:288)
    at org.apache.spark.InterruptibleIterator.toArray(InterruptibleIterator.scala:28)
    at org.apache.spark.api.python.PythonRDD$.$anonfun$runJob$1(PythonRDD.scala:166)
    at org.apache.spark.SparkContext.$anonfun$runJob$5(SparkContext.scala:2236)
    at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
    at org.apache.spark.scheduler.Task.run(Task.scala:131)
    at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
    at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
    at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
    at java.base/java.lang.Thread.run(Thread.java:829)

24/08/23 12:21:30 ERROR TaskSetManager: Task 0 in stage 62.0 failed 1 times; aborting job</code></pre>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>

<span class="ansi-red-fg">Py4JJavaError</span>                             Traceback (most recent call last)

<span class="ansi-green-fg">/tmp/ipykernel_722/413939631.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>

<span class="ansi-green-fg ansi-bold">      1</span> <span class="ansi-red-fg"># rdd1은 key-pair value가 아님</span>

<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>rdd1<span class="ansi-blue-fg">.</span>mapValues<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">lambda</span> v<span class="ansi-blue-fg">:</span> v <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>take<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># error</span>



<span class="ansi-green-fg">/usr/local/spark/python/pyspark/rdd.py</span> in <span class="ansi-cyan-fg">take</span><span class="ansi-blue-fg">(self, num)</span>

<span class="ansi-green-fg ansi-bold">   1564</span> 

<span class="ansi-green-fg ansi-bold">   1565</span>             p <span class="ansi-blue-fg">=</span> range<span class="ansi-blue-fg">(</span>partsScanned<span class="ansi-blue-fg">,</span> min<span class="ansi-blue-fg">(</span>partsScanned <span class="ansi-blue-fg">+</span> numPartsToTry<span class="ansi-blue-fg">,</span> totalParts<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">-&gt; 1566</span><span class="ansi-red-fg">             </span>res <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>context<span class="ansi-blue-fg">.</span>runJob<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> takeUpToNumLeft<span class="ansi-blue-fg">,</span> p<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg ansi-bold">   1567</span> 

<span class="ansi-green-fg ansi-bold">   1568</span>             items <span class="ansi-blue-fg">+=</span> res



<span class="ansi-green-fg">/usr/local/spark/python/pyspark/context.py</span> in <span class="ansi-cyan-fg">runJob</span><span class="ansi-blue-fg">(self, rdd, partitionFunc, partitions, allowLocal)</span>

<span class="ansi-green-fg ansi-bold">   1231</span>         <span class="ansi-red-fg"># SparkContext#runJob.</span>

<span class="ansi-green-fg ansi-bold">   1232</span>         mappedRDD <span class="ansi-blue-fg">=</span> rdd<span class="ansi-blue-fg">.</span>mapPartitions<span class="ansi-blue-fg">(</span>partitionFunc<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">-&gt; 1233</span><span class="ansi-red-fg">         </span>sock_info <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_jvm<span class="ansi-blue-fg">.</span>PythonRDD<span class="ansi-blue-fg">.</span>runJob<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_jsc<span class="ansi-blue-fg">.</span>sc<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> mappedRDD<span class="ansi-blue-fg">.</span>_jrdd<span class="ansi-blue-fg">,</span> partitions<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg ansi-bold">   1234</span>         <span class="ansi-green-fg">return</span> list<span class="ansi-blue-fg">(</span>_load_from_socket<span class="ansi-blue-fg">(</span>sock_info<span class="ansi-blue-fg">,</span> mappedRDD<span class="ansi-blue-fg">.</span>_jrdd_deserializer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg ansi-bold">   1235</span> 



<span class="ansi-green-fg">/usr/local/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args)</span>

<span class="ansi-green-fg ansi-bold">   1302</span> 

<span class="ansi-green-fg ansi-bold">   1303</span>         answer <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>gateway_client<span class="ansi-blue-fg">.</span>send_command<span class="ansi-blue-fg">(</span>command<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">-&gt; 1304</span><span class="ansi-red-fg">         return_value = get_return_value(

</span><span class="ansi-green-fg ansi-bold">   1305</span>             answer, self.gateway_client, self.target_id, self.name)

<span class="ansi-green-fg ansi-bold">   1306</span> 



<span class="ansi-green-fg">/usr/local/spark/python/pyspark/sql/utils.py</span> in <span class="ansi-cyan-fg">deco</span><span class="ansi-blue-fg">(*a, **kw)</span>

<span class="ansi-green-fg ansi-bold">    109</span>     <span class="ansi-green-fg">def</span> deco<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>a<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg ansi-bold">    110</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">--&gt; 111</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>a<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg ansi-bold">    112</span>         <span class="ansi-green-fg">except</span> py4j<span class="ansi-blue-fg">.</span>protocol<span class="ansi-blue-fg">.</span>Py4JJavaError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg ansi-bold">    113</span>             converted <span class="ansi-blue-fg">=</span> convert_exception<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">.</span>java_exception<span class="ansi-blue-fg">)</span>



<span class="ansi-green-fg">/usr/local/spark/python/lib/py4j-0.10.9-src.zip/py4j/protocol.py</span> in <span class="ansi-cyan-fg">get_return_value</span><span class="ansi-blue-fg">(answer, gateway_client, target_id, name)</span>

<span class="ansi-green-fg ansi-bold">    324</span>             value <span class="ansi-blue-fg">=</span> OUTPUT_CONVERTER<span class="ansi-blue-fg">[</span>type<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">(</span>answer<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> gateway_client<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg ansi-bold">    325</span>             <span class="ansi-green-fg">if</span> answer<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">==</span> REFERENCE_TYPE<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">--&gt; 326</span><span class="ansi-red-fg">                 raise Py4JJavaError(

</span><span class="ansi-green-fg ansi-bold">    327</span>                     <span class="ansi-blue-fg">"An error occurred while calling {0}{1}{2}.\n"</span><span class="ansi-blue-fg">.</span>

<span class="ansi-green-fg ansi-bold">    328</span>                     format(target_id, ".", name), value)



<span class="ansi-red-fg">Py4JJavaError</span>: An error occurred while calling z:org.apache.spark.api.python.PythonRDD.runJob.

: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 62.0 failed 1 times, most recent failure: Lost task 0.0 in stage 62.0 (TID 113) (7b9e2a0ad7ba executor driver): org.apache.spark.api.python.PythonException: Traceback (most recent call last):

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 604, in main

    process()

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 596, in process

    serializer.dump_stream(out_iter, outfile)

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/serializers.py", line 259, in dump_stream

    vs = list(itertools.islice(iterator, batch))

  File "/usr/local/spark/python/pyspark/rdd.py", line 1560, in takeUpToNumLeft

    yield next(iterator)

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/util.py", line 73, in wrapper

    return f(*args, **kwargs)

  File "/usr/local/spark/python/pyspark/rdd.py", line 2276, in &lt;lambda&gt;

    map_values_fn = lambda kv: (kv[0], f(kv[1]))

IndexError: string index out of range



    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.handlePythonException(PythonRunner.scala:517)

    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:652)

    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:635)

    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.hasNext(PythonRunner.scala:470)

    at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)

    at scala.collection.Iterator.foreach(Iterator.scala:941)

    at scala.collection.Iterator.foreach$(Iterator.scala:941)

    at org.apache.spark.InterruptibleIterator.foreach(InterruptibleIterator.scala:28)

    at scala.collection.generic.Growable.$plus$plus$eq(Growable.scala:62)

    at scala.collection.generic.Growable.$plus$plus$eq$(Growable.scala:53)

    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:105)

    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:49)

    at scala.collection.TraversableOnce.to(TraversableOnce.scala:315)

    at scala.collection.TraversableOnce.to$(TraversableOnce.scala:313)

    at org.apache.spark.InterruptibleIterator.to(InterruptibleIterator.scala:28)

    at scala.collection.TraversableOnce.toBuffer(TraversableOnce.scala:307)

    at scala.collection.TraversableOnce.toBuffer$(TraversableOnce.scala:307)

    at org.apache.spark.InterruptibleIterator.toBuffer(InterruptibleIterator.scala:28)

    at scala.collection.TraversableOnce.toArray(TraversableOnce.scala:294)

    at scala.collection.TraversableOnce.toArray$(TraversableOnce.scala:288)

    at org.apache.spark.InterruptibleIterator.toArray(InterruptibleIterator.scala:28)

    at org.apache.spark.api.python.PythonRDD$.$anonfun$runJob$1(PythonRDD.scala:166)

    at org.apache.spark.SparkContext.$anonfun$runJob$5(SparkContext.scala:2236)

    at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)

    at org.apache.spark.scheduler.Task.run(Task.scala:131)

    at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)

    at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)

    at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)

    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)

    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)

    at java.base/java.lang.Thread.run(Thread.java:829)



Driver stacktrace:

    at org.apache.spark.scheduler.DAGScheduler.failJobAndIndependentStages(DAGScheduler.scala:2258)

    at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2(DAGScheduler.scala:2207)

    at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2$adapted(DAGScheduler.scala:2206)

    at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)

    at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)

    at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)

    at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2206)

    at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1(DAGScheduler.scala:1079)

    at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1$adapted(DAGScheduler.scala:1079)

    at scala.Option.foreach(Option.scala:407)

    at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:1079)

    at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:2445)

    at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2387)

    at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2376)

    at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)

    at org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:868)

    at org.apache.spark.SparkContext.runJob(SparkContext.scala:2196)

    at org.apache.spark.SparkContext.runJob(SparkContext.scala:2217)

    at org.apache.spark.SparkContext.runJob(SparkContext.scala:2236)

    at org.apache.spark.api.python.PythonRDD$.runJob(PythonRDD.scala:166)

    at org.apache.spark.api.python.PythonRDD.runJob(PythonRDD.scala)

    at jdk.internal.reflect.GeneratedMethodAccessor77.invoke(Unknown Source)

    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)

    at java.base/java.lang.reflect.Method.invoke(Method.java:566)

    at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)

    at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)

    at py4j.Gateway.invoke(Gateway.java:282)

    at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)

    at py4j.commands.CallCommand.execute(CallCommand.java:79)

    at py4j.GatewayConnection.run(GatewayConnection.java:238)

    at java.base/java.lang.Thread.run(Thread.java:829)

Caused by: org.apache.spark.api.python.PythonException: Traceback (most recent call last):

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 604, in main

    process()

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/worker.py", line 596, in process

    serializer.dump_stream(out_iter, outfile)

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/serializers.py", line 259, in dump_stream

    vs = list(itertools.islice(iterator, batch))

  File "/usr/local/spark/python/pyspark/rdd.py", line 1560, in takeUpToNumLeft

    yield next(iterator)

  File "/usr/local/spark/python/lib/pyspark.zip/pyspark/util.py", line 73, in wrapper

    return f(*args, **kwargs)

  File "/usr/local/spark/python/pyspark/rdd.py", line 2276, in &lt;lambda&gt;

    map_values_fn = lambda kv: (kv[0], f(kv[1]))

IndexError: string index out of range



    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.handlePythonException(PythonRunner.scala:517)

    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:652)

    at org.apache.spark.api.python.PythonRunner$$anon$3.read(PythonRunner.scala:635)

    at org.apache.spark.api.python.BasePythonRunner$ReaderIterator.hasNext(PythonRunner.scala:470)

    at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)

    at scala.collection.Iterator.foreach(Iterator.scala:941)

    at scala.collection.Iterator.foreach$(Iterator.scala:941)

    at org.apache.spark.InterruptibleIterator.foreach(InterruptibleIterator.scala:28)

    at scala.collection.generic.Growable.$plus$plus$eq(Growable.scala:62)

    at scala.collection.generic.Growable.$plus$plus$eq$(Growable.scala:53)

    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:105)

    at scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:49)

    at scala.collection.TraversableOnce.to(TraversableOnce.scala:315)

    at scala.collection.TraversableOnce.to$(TraversableOnce.scala:313)

    at org.apache.spark.InterruptibleIterator.to(InterruptibleIterator.scala:28)

    at scala.collection.TraversableOnce.toBuffer(TraversableOnce.scala:307)

    at scala.collection.TraversableOnce.toBuffer$(TraversableOnce.scala:307)

    at org.apache.spark.InterruptibleIterator.toBuffer(InterruptibleIterator.scala:28)

    at scala.collection.TraversableOnce.toArray(TraversableOnce.scala:294)

    at scala.collection.TraversableOnce.toArray$(TraversableOnce.scala:288)

    at org.apache.spark.InterruptibleIterator.toArray(InterruptibleIterator.scala:28)

    at org.apache.spark.api.python.PythonRDD$.$anonfun$runJob$1(PythonRDD.scala:166)

    at org.apache.spark.SparkContext.$anonfun$runJob$5(SparkContext.scala:2236)

    at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)

    at org.apache.spark.scheduler.Task.run(Task.scala:131)

    at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)

    at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)

    at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)

    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)

    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)

    ... 1 more
</pre>
</div>
</div>
</div>
<div id="16ece568" class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mapValues : rdd2는 key-value pair가 맞음</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>rdd3 <span class="op">=</span> rdd2.mapValues(<span class="kw">lambda</span> v: v <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>rdd3.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('a', 2), ('b', 2), ('c', 2), ('b', 2), ('b', 2), ('d', 2)]</code></pre>
</div>
</div>
<div id="9e3ee2d0" class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># flatMapValues</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [(<span class="st">"a"</span>, <span class="st">"1,2,3"</span>), (<span class="st">"b"</span>, <span class="st">"4,5,6"</span>)]</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>rdd <span class="op">=</span> sc.parallelize(data)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>rdd.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('a', '1,2,3'), ('b', '4,5,6')]</code></pre>
</div>
</div>
<div id="ef61d83b" class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>rdd4 <span class="op">=</span> rdd.flatMapValues(<span class="kw">lambda</span> v: v.split(<span class="st">","</span>))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>rdd4.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('a', '1'), ('a', '2'), ('a', '3'), ('b', '4'), ('b', '5'), ('b', '6')]</code></pre>
</div>
</div>
<div id="7a4ec7b0" class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reduceByKey</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rdd2 = [('a', 1), ('b', 1), ('c', 1), ('b', 1), ('b', 1), ('d', 1)]</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>rdd6 <span class="op">=</span> rdd2.reduceByKey(<span class="kw">lambda</span> a, b: a <span class="op">+</span> b)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>rdd6.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('a', 1), ('b', 3), ('c', 1), ('d', 1)]</code></pre>
</div>
</div>
<div id="0c3e6f94" class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># groupByKey</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>rdd7 <span class="op">=</span> rdd6.groupByKey()</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>rdd7.<span class="bu">map</span>(<span class="kw">lambda</span> x : (x[<span class="dv">0</span>], <span class="bu">list</span>(x[<span class="dv">1</span>]))).collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('a', [1]), ('b', [3]), ('c', [1]), ('d', [1])]</code></pre>
</div>
</div>
<div id="733c3284" class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cogroup</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="86a2ef27" class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">## group1 : rdd8</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>kv1 <span class="op">=</span> [(<span class="st">"k1"</span>, <span class="st">"v1"</span>), (<span class="st">"k2"</span>, <span class="st">"v2"</span>), (<span class="st">"k3"</span>, <span class="st">"v3"</span>)]</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>rdd8 <span class="op">=</span> sc.parallelize(kv1)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>rdd8.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('k1', 'v1'), ('k2', 'v2'), ('k3', 'v3')]</code></pre>
</div>
</div>
<div id="5ee638b4" class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3 group2 : rdd9</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>kv2 <span class="op">=</span> [(<span class="st">"k1"</span>, <span class="st">"v4"</span>), (<span class="st">"k2"</span>, <span class="st">"v5"</span>), (<span class="st">"k3"</span>, <span class="st">"v6"</span>)]</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>rdd9 <span class="op">=</span> sc.parallelize(kv2)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>rdd9.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('k1', 'v4'), ('k2', 'v5'), ('k3', 'v6')]</code></pre>
</div>
</div>
<div id="408e430b" class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>rdd10 <span class="op">=</span> rdd8.cogroup(rdd9)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>[(x, <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">list</span>, y))) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">sorted</span>(<span class="bu">list</span>(rdd10.collect()))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('k1', (['v1'], ['v4'])), ('k2', (['v2'], ['v5'])), ('k3', (['v3'], ['v6']))]</code></pre>
</div>
</div>
<div id="95c47088" class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join  실제로는 cogroup보다는 join을 많이 사용</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>rdd11 <span class="op">=</span> rdd8.join(rdd9)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>rdd11.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('k2', ('v2', 'v5')), ('k1', ('v1', 'v4')), ('k3', ('v3', 'v6'))]</code></pre>
</div>
</div>
<div id="833bc60f" class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combineByKey</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> sc.parallelize([(<span class="st">"Math"</span>, <span class="dv">100</span>), (<span class="st">"Eng"</span>, <span class="dv">80</span>), (<span class="st">"Math"</span>, <span class="dv">50</span>), (<span class="st">"Eng"</span>, <span class="dv">70</span>), (<span class="st">"Eng"</span>, <span class="dv">90</span>)])</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_list(a):</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [a]</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> append(a, b):</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    a.append(b)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extend(a, b):</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>    a.extend(b)</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>rdd12 <span class="op">=</span> r1.combineByKey(to_list, append, extend)</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>rdd12.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('Math', [100, 50]), ('Eng', [80, 70, 90])]</code></pre>
</div>
</div>
</section>
<section id="dataframe" class="level3">
<h3 class="anchored" data-anchor-id="dataframe">(4) DataFrame</h3>
<section id="row" class="level4">
<h4 class="anchored" data-anchor-id="row">Row</h4>
<ul>
<li>보통은 데이터를 읽어오지만, Row를 활용해 데이터를 정의해줄 수도 있음</li>
</ul>
<div id="b21c691f" class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> Row</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> Row(<span class="dv">1</span>, <span class="st">"two"</span>, <span class="va">True</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>r1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Row(1, 'two', True)&gt;</code></pre>
</div>
</div>
<div id="d8188db3" class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r1[<span class="dv">0</span>])</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r1[<span class="dv">1</span>])</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r1[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
two
True</code></pre>
</div>
</div>
</section>
<section id="dataframe-1" class="level4">
<h4 class="anchored" data-anchor-id="dataframe-1">DataFrame</h4>
<ul>
<li>파이썬 list로 바로 DataFrame을 생성할 수는 없으며, Row 등으로 감싸준 경우는 가능</li>
<li>컬럼명 미지정시 _1, _2와 같이 생성됨</li>
</ul>
<div id="29764a2b" class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrame생성 불가능 예시 (TypeError 발생)</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data1)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>df.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>TypeError: Can not infer schema for type: &lt;class ‘int’&gt;</p>
<div id="5c1ccebf" class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrame생성 가능 예시 (컬럼 미지정)</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> Row</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> [Row(<span class="dv">1</span>), Row(<span class="dv">2</span>), Row(<span class="dv">3</span>)]</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data2)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>df.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+
| _1|
+---+
|  1|
|  2|
|  3|
+---+
</code></pre>
</div>
</div>
<div id="c73a2efa" class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrame생성 가능 예시 (컬럼 지정)</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data2, [<span class="st">'num'</span>])</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>df.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+
|num|
+---+
|  1|
|  2|
|  3|
+---+
</code></pre>
</div>
</div>
<div id="01cb51cb" class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrame생성 가능 예시 (Class를 활용)</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person:</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> <span class="st">"name"</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.age <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.job <span class="op">=</span> <span class="st">"student"</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name, age, job):</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.age <span class="op">=</span> age</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.job <span class="op">=</span> job</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> Person(<span class="st">"foo"</span>, <span class="dv">30</span>, <span class="st">"programmer"</span>)</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> Person(<span class="st">"bar"</span>, <span class="dv">10</span>, <span class="st">"student"</span>)</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>spark.createDataFrame([p1, p2]).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+----------+----+
|age|       job|name|
+---+----------+----+
| 30|programmer| foo|
| 10|   student| bar|
+---+----------+----+
</code></pre>
</div>
</div>
<div id="96783b66" class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrame생성 가능 예시 (Tuple 활용)</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> (<span class="st">"foo"</span>, <span class="dv">30</span>, <span class="st">"programmer"</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> (<span class="st">"bar"</span>, <span class="dv">10</span>, <span class="st">"student"</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>spark.createDataFrame([t1, t2]).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+---+----------+
| _1| _2|        _3|
+---+---+----------+
|foo| 30|programmer|
|bar| 10|   student|
+---+---+----------+
</code></pre>
</div>
</div>
<div id="b7e502e7" class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrame생성 가능 예시 (Tuple 활용+컬럼지정)</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> (<span class="st">"foo"</span>, <span class="dv">30</span>, <span class="st">"programmer"</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> (<span class="st">"bar"</span>, <span class="dv">10</span>, <span class="st">"student"</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>spark.createDataFrame([t1, t2],[<span class="st">'name'</span>,<span class="st">'age'</span>,<span class="st">'job'</span>]).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----+---+----------+
|name|age|       job|
+----+---+----------+
| foo| 30|programmer|
| bar| 10|   student|
+----+---+----------+
</code></pre>
</div>
</div>
<div id="5e6c9c12" class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrame생성 가능 예시 (스키마 정의)</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> StructType,StructField,StringType,IntegerType</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> StructType(</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    [StructField(<span class="st">"name"</span>, StringType(), nullable <span class="op">=</span> <span class="va">True</span>),</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>     StructField(<span class="st">"age"</span>, IntegerType(), nullable <span class="op">=</span> <span class="va">True</span>),</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>     StructField(<span class="st">"job"</span>, StringType(), nullable <span class="op">=</span> <span class="va">True</span>)]</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>rowRDD <span class="op">=</span> sc.parallelize([Row(<span class="st">"foo"</span>, <span class="dv">7</span>, <span class="st">"programmer"</span>), Row(<span class="st">"bar"</span>, <span class="dv">13</span>, <span class="st">"student"</span>)])</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>rowRDD.collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[&lt;Row('foo', 7, 'programmer')&gt;, &lt;Row('bar', 13, 'student')&gt;]</code></pre>
</div>
</div>
<div id="e06fce22" class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>spark.createDataFrame(rowRDD, schema).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----+---+----------+
|name|age|       job|
+----+---+----------+
| foo|  7|programmer|
| bar| 13|   student|
+----+---+----------+
</code></pre>
</div>
</div>
<div id="f0bee0c2" class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkSession을 활용해 DataFrame으로 생성 [spark.read.text()]</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>spark.read.text(<span class="st">"../data/movies.csv"</span>).show(<span class="dv">3</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 참고 : sc.textFile() : SparkContext를 활용해 RDD로 생성</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+
|               value|
+--------------------+
|movieId,title,genres|
|1,Toy Story (1995...|
|2,Jumanji (1995),...|
+--------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="ba260c08" class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkSession을 활용해 DataFrame으로 생성 [read.option()]</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>spark.read.option(<span class="st">"sep"</span>, <span class="st">","</span>).csv(<span class="st">"../data/movies.csv"</span>).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------+----------------+--------------------+
|    _c0|             _c1|                 _c2|
+-------+----------------+--------------------+
|movieId|           title|              genres|
|      1|Toy Story (1995)|Adventure|Animati...|
|      2|  Jumanji (1995)|Adventure|Childre...|
+-------+----------------+--------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="e810ec21" class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkSession을 활용해 DataFrame으로 생성 [read.option(), 여러 데이터 소스]</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>spark.read.option(<span class="st">"basePath"</span>, <span class="st">"../data/"</span>).csv(<span class="st">"../data/*.csv"</span>).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+-------+------+---------+
|   _c0|    _c1|   _c2|      _c3|
+------+-------+------+---------+
|userId|movieId|rating|timestamp|
|     1|      1|   4.0|964982703|
|     1|      3|   4.0|964981247|
+------+-------+------+---------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="6f1c3ac2" class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table을 만들고 쿼리해서 사용 (영구적으로 사용할 수 없는 테이블임을 유의)</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co">## buckected_table이란 이름의 table이 없으면(count == 0)</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (spark.sql(<span class="st">"show tables"</span>).where(<span class="st">"tableName = 'buckected_table' "</span>).count() <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Data를 읽고</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> spark.read.csv(<span class="st">"../data/movies.csv"</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">## created_at 기준으로 3개의 bucket으로 나누고 / buckected_table로 테이블 생성</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    df.repartition(<span class="dv">1</span>).write.mode(<span class="st">"Overwrite"</span>).bucketBy(<span class="dv">3</span>, <span class="st">"id"</span>).saveAsTable(<span class="st">"buckected_table"</span>)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">## 테이블을 읽고 SQL 쿼리 사용</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    spark.read.table(<span class="st">"buckected_table"</span>)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    spark.sql(<span class="st">"select * from buckected_table limit 10"</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataframe-api" class="level4">
<h4 class="anchored" data-anchor-id="dataframe-api">DataFrame API</h4>
<div id="24caf430" class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .select()를 사용해 쿼리</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> spark.read.json(<span class="st">"../data/*.json"</span>)</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>df1.show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------+--------------------+--------------------+------+--------------------+------------------+
|               actor|created_at|                 org|             payload|public|                repo|              type|
+--------------------+----------+--------------------+--------------------+------+--------------------+------------------+
|{"id":35613825,"l...|2024-05-19|{"id":126833237,"...|{"comment":{"url"...|  true|{"id":749408001,"...|CommitCommentEvent|
|{"id":84257236,"l...|2024-05-19|                null|{"comment":{"url"...|  true|{"id":430924902,"...|CommitCommentEvent|
|{"id":41898282,"l...|2024-05-19|{"id":1040002,"lo...|{"comment":{"url"...|  true|{"id":170801983,"...|CommitCommentEvent|
+--------------------+----------+--------------------+--------------------+------+--------------------+------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="7c8b135d" class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>df1.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- actor: string (nullable = true)
 |-- created_at: string (nullable = true)
 |-- org: string (nullable = true)
 |-- payload: string (nullable = true)
 |-- public: boolean (nullable = true)
 |-- repo: string (nullable = true)
 |-- type: string (nullable = true)
</code></pre>
</div>
</div>
<div id="1667f4dd" class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>df1.select(<span class="st">"actor"</span>, <span class="st">"created_at"</span>).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------+
|               actor|created_at|
+--------------------+----------+
|{"id":35613825,"l...|2024-05-19|
|{"id":84257236,"l...|2024-05-19|
|{"id":41898282,"l...|2024-05-19|
+--------------------+----------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="e9b8389c" class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkSQL (Expression) 활용</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>df1.selectExpr(<span class="st">'actor'</span>).show(<span class="dv">3</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|actor                                                                                                                                                                                                                    |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|{"id":35613825,"login":"vercel[bot]","display_login":"vercel","gravatar_id":"","url":"https://api.github.com/users/vercel[bot]","avatar_url":"https://avatars.githubusercontent.com/u/35613825?"}                        |
|{"id":84257236,"login":"DM-netizen","display_login":"DM-netizen","gravatar_id":"","url":"https://api.github.com/users/DM-netizen","avatar_url":"https://avatars.githubusercontent.com/u/84257236?"}                      |
|{"id":41898282,"login":"github-actions[bot]","display_login":"github-actions","gravatar_id":"","url":"https://api.github.com/users/github-actions[bot]","avatar_url":"https://avatars.githubusercontent.com/u/41898282?"}|
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="edc943f0" class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SparkSQL (Expression) 활용</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>df1.selectExpr(<span class="st">'upper(actor) as upperName'</span>).show(<span class="dv">3</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|upperName                                                                                                                                                                                                                |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|{"ID":35613825,"LOGIN":"VERCEL[BOT]","DISPLAY_LOGIN":"VERCEL","GRAVATAR_ID":"","URL":"HTTPS://API.GITHUB.COM/USERS/VERCEL[BOT]","AVATAR_URL":"HTTPS://AVATARS.GITHUBUSERCONTENT.COM/U/35613825?"}                        |
|{"ID":84257236,"LOGIN":"DM-NETIZEN","DISPLAY_LOGIN":"DM-NETIZEN","GRAVATAR_ID":"","URL":"HTTPS://API.GITHUB.COM/USERS/DM-NETIZEN","AVATAR_URL":"HTTPS://AVATARS.GITHUBUSERCONTENT.COM/U/84257236?"}                      |
|{"ID":41898282,"LOGIN":"GITHUB-ACTIONS[BOT]","DISPLAY_LOGIN":"GITHUB-ACTIONS","GRAVATAR_ID":"","URL":"HTTPS://API.GITHUB.COM/USERS/GITHUB-ACTIONS[BOT]","AVATAR_URL":"HTTPS://AVATARS.GITHUBUSERCONTENT.COM/U/41898282?"}|
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="b80d99f7" class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># col을 사용해 쿼리</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co">## pyspark.sql.functions.* 의 모든 타입은 column을 input으로 받는다</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co">## split('id',', ')는 미동작 → split(col('id'),', ')해야 동작</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>c1 <span class="op">=</span> col(<span class="st">"actor"</span>)</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>c2 <span class="op">=</span> col(<span class="st">"org"</span>)</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>df1.select(c1, c2).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+--------------------+
|               actor|                 org|
+--------------------+--------------------+
|{"id":35613825,"l...|{"id":126833237,"...|
|{"id":84257236,"l...|                null|
|{"id":41898282,"l...|{"id":1040002,"lo...|
+--------------------+--------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="74da9e24" class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter 사용</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> [Row(<span class="dv">1</span>), Row(<span class="dv">2</span>), Row(<span class="dv">3</span>)]</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data2)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">filter</span>(<span class="st">"_1 == 2"</span>).show(<span class="dv">3</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+
|_1 |
+---+
|2  |
+---+
</code></pre>
</div>
</div>
<div id="adbfd8a5" class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># where 사용</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> [Row(<span class="dv">1</span>), Row(<span class="dv">2</span>), Row(<span class="dv">3</span>)]</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data2)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>df.where(<span class="st">"_1 == 2"</span>).show(<span class="dv">3</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+
|_1 |
+---+
|2  |
+---+
</code></pre>
</div>
</div>
<div id="4ece3720" class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># orderBy</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> [Row(<span class="dv">3</span>), Row(<span class="dv">2</span>), Row(<span class="dv">4</span>)]</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data2)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>df.orderBy(<span class="st">"_1"</span>).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+
| _1|
+---+
|  2|
|  3|
|  4|
+---+
</code></pre>
</div>
</div>
<div id="027b6394" class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> [Row(<span class="dv">3</span>), Row(<span class="dv">2</span>), Row(<span class="dv">4</span>)]</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data2)</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>df.sort(col(<span class="st">"_1"</span>)).show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+
| _1|
+---+
|  2|
|  3|
|  4|
+---+
</code></pre>
</div>
</div>
<div id="1fb98244" class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># groupBy</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> F</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.read.json(<span class="st">"../data/*.json"</span>)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregations</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>groupedDF <span class="op">=</span> df.groupBy(<span class="st">"type"</span>)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>groupedDF.agg(F.<span class="bu">max</span>(F.col(<span class="st">"created_at"</span>))).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------+---------------+
|              type|max(created_at)|
+------------------+---------------+
|CommitCommentEvent|     2024-05-19|
+------------------+---------------+
</code></pre>
</div>
</div>
<div id="bb954f3a" class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 중복제거</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.count())</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.distinct().count())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>228</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
[Stage 218:=================================&gt;                   (128 + 1) / 200]

[Stage 218:==============================================&gt;      (176 + 1) / 200]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>228</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
                                                                                </code></pre>
</div>
</div>
</section>
<section id="많이-사용하는-dataframe-api" class="level4">
<h4 class="anchored" data-anchor-id="많이-사용하는-dataframe-api">많이 사용하는 DataFrame API</h4>
<ul>
<li>withColumn (많이 쓰임)
<ul>
<li>pyspark.sql.functions.*로 transformation작업을 많이함
<ul>
<li><code>import pyspark.sql.functions as F</code> 로 많이 사용</li>
</ul></li>
<li>필터링해서 새로운 컬럼에 넣고, 기존 컬럼을 Drop하는 식으로 많이 사용</li>
</ul></li>
</ul>
<div id="019fa8fc" class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> F</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co"># actor컬럼을 trim해서, newColumn라는 컬럼을 새로 만들어 저장</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>df.withColumn(<span class="st">"newColumn"</span>, F.trim(F.col(<span class="st">"actor"</span>))).show(<span class="dv">3</span>,<span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+----------------------------------------------------------------------------------------------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|actor                                                                                                                                                                                                                    |created_at|org                                                                                                                                                                          |payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |public|repo                                                                                                            |type              |newColumn                                                                                                                                                                                                                |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+----------------------------------------------------------------------------------------------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|{"id":35613825,"login":"vercel[bot]","display_login":"vercel","gravatar_id":"","url":"https://api.github.com/users/vercel[bot]","avatar_url":"https://avatars.githubusercontent.com/u/35613825?"}                        |2024-05-19|{"id":126833237,"login":"boxlife-app","gravatar_id":"","url":"https://api.github.com/orgs/boxlife-app","avatar_url":"https://avatars.githubusercontent.com/u/126833237?"}    |{"comment":{"url":"https://api.github.com/repos/boxlife-app/calisto/comments/142178684","html_url":"https://github.com/boxlife-app/calisto/commit/7651f70845e3313adf7d6c534ce90d1157e1daab#commitcomment-142178684","id":142178684,"node_id":"CC_kwDOLKsPAc4IeXl8","user":{"login":"vercel[bot]","id":35613825,"node_id":"MDM6Qm90MzU2MTM4MjU=","avatar_url":"https://avatars.githubusercontent.com/in/8329?v=4","gravatar_id":"","url":"https://api.github.com/users/vercel%5Bbot%5D","html_url":"https://github.com/apps/vercel","followers_url":"https://api.github.com/users/vercel%5Bbot%5D/followers","following_url":"https://api.github.com/users/vercel%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/vercel%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/vercel%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vercel%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/vercel%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/vercel%5Bbot%5D/repos","events_url":"https://api.github.com/users/vercel%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/vercel%5Bbot%5D/received_events","type":"Bot","site_admin":false},"position":null,"line":null,"path":null,"commit_id":"7651f70845e3313adf7d6c534ce90d1157e1daab","created_at":"2024-05-19T14:00:00Z","updated_at":"2024-05-19T14:00:00Z","author_association":"NONE","body":"Successfully deployed to the following URLs:\n\n## calisto – ./\n\n[calisto-git-main-boxlife.vercel.app](https://calisto-git-main-boxlife.vercel.app)  \n[calisto-sigma.vercel.app](https://calisto-sigma.vercel.app)  \n[calisto-boxlife.vercel.app](https://calisto-boxlife.vercel.app)  \n[calisto.js.org](https://calisto.js.org)  \n[calisto.boxlife.app](https://calisto.boxlife.app)","reactions":{"url":"https://api.github.com/repos/boxlife-app/calisto/comments/142178684/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0}}}                                                                                                                                                                                                                                                                                                                                                                                                                             |true  |{"id":749408001,"name":"boxlife-app/calisto","url":"https://api.github.com/repos/boxlife-app/calisto"}          |CommitCommentEvent|{"id":35613825,"login":"vercel[bot]","display_login":"vercel","gravatar_id":"","url":"https://api.github.com/users/vercel[bot]","avatar_url":"https://avatars.githubusercontent.com/u/35613825?"}                        |
|{"id":84257236,"login":"DM-netizen","display_login":"DM-netizen","gravatar_id":"","url":"https://api.github.com/users/DM-netizen","avatar_url":"https://avatars.githubusercontent.com/u/84257236?"}                      |2024-05-19|null                                                                                                                                                                         |{"comment":{"url":"https://api.github.com/repos/joyhughes/Jen/comments/142178686","html_url":"https://github.com/joyhughes/Jen/commit/2516172cb9b3efde69c236491e36b1ba7bc567c2#commitcomment-142178686","id":142178686,"node_id":"CC_kwDOGa9kZs4IeXl-","user":{"login":"DM-netizen","id":84257236,"node_id":"MDQ6VXNlcjg0MjU3MjM2","avatar_url":"https://avatars.githubusercontent.com/u/84257236?v=4","gravatar_id":"","url":"https://api.github.com/users/DM-netizen","html_url":"https://github.com/DM-netizen","followers_url":"https://api.github.com/users/DM-netizen/followers","following_url":"https://api.github.com/users/DM-netizen/following{/other_user}","gists_url":"https://api.github.com/users/DM-netizen/gists{/gist_id}","starred_url":"https://api.github.com/users/DM-netizen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DM-netizen/subscriptions","organizations_url":"https://api.github.com/users/DM-netizen/orgs","repos_url":"https://api.github.com/users/DM-netizen/repos","events_url":"https://api.github.com/users/DM-netizen/events{/privacy}","received_events_url":"https://api.github.com/users/DM-netizen/received_events","type":"User","site_admin":false},"position":null,"line":null,"path":null,"commit_id":"2516172cb9b3efde69c236491e36b1ba7bc567c2","created_at":"2024-05-19T14:00:42Z","updated_at":"2024-05-19T14:00:42Z","author_association":"NONE","body":"```\r\ntemplate&lt; class T &gt; void eff_kaleidoscope&lt; T &gt;::operator () ( any_buffer_pair_ptr&amp; buf, element_context&amp; context )\r\n{\r\n    vec2f old_center; float old_segments; float old_offset_angle; bool old_reflect;\r\n    center(context); segments(context); offset_angle(context); reflect(context); filled(context);\r\n    \r\n    if(*center!=old_center || *segments!=old_segments || *offset_angle!=old_offset_angle || *reflect!=old_reflect)\r\n    filled=false;\r\n    old_center = *center; old_segments=*segments; old_offset_angle=*offset_angle; old_reflect=*reflect;\r\n\r\n    if(!filled)\r\n    {\r\n        filled =true;\r\n        vftools tools( get_image&lt; T &gt;( buf ) );\r\n        tools.kaleidoscope(*center,*segments,*offset_angle,*reflect);\r\n    }  \r\n}\r\n\r\ntemplate class eff_kaleidoscope&lt; vec2f &gt;;\r\n```\r\n\r\nI think this should work now.","reactions":{"url":"https://api.github.com/repos/joyhughes/Jen/comments/142178686/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0}}}|true  |{"id":430924902,"name":"joyhughes/Jen","url":"https://api.github.com/repos/joyhughes/Jen"}                      |CommitCommentEvent|{"id":84257236,"login":"DM-netizen","display_login":"DM-netizen","gravatar_id":"","url":"https://api.github.com/users/DM-netizen","avatar_url":"https://avatars.githubusercontent.com/u/84257236?"}                      |
|{"id":41898282,"login":"github-actions[bot]","display_login":"github-actions","gravatar_id":"","url":"https://api.github.com/users/github-actions[bot]","avatar_url":"https://avatars.githubusercontent.com/u/41898282?"}|2024-05-19|{"id":1040002,"login":"linuxfoundation","gravatar_id":"","url":"https://api.github.com/orgs/linuxfoundation","avatar_url":"https://avatars.githubusercontent.com/u/1040002?"}|{"comment":{"url":"https://api.github.com/repos/linuxfoundation/lfevents/comments/142178688","html_url":"https://github.com/linuxfoundation/lfevents/commit/b2ef1fcd2f3488f79c7a3f74e5692e4305e4dc16#commitcomment-142178688","id":142178688,"node_id":"CC_kwDOCi47P84IeXmA","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","site_admin":false},"position":null,"line":null,"path":null,"commit_id":"b2ef1fcd2f3488f79c7a3f74e5692e4305e4dc16","created_at":"2024-05-19T14:01:02Z","updated_at":"2024-05-19T14:01:02Z","author_association":"NONE","body":"[![Visit Site](https://raw.githubusercontent.com/pantheon-systems/terminus-build-tools-plugin/master/assets/images/visit-site-36.png)](https://pr-903-lfasiallcci.pantheonsite.io/)\n\nCreated multidev environment [pr-903](https://dashboard.pantheon.io/sites/d9d89786-a031-4501-a11a-542662f8f8c1#pr-903) for lfasiallcci.","reactions":{"url":"https://api.github.com/repos/linuxfoundation/lfevents/comments/142178688/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0}}}                                                                                                                                                                                                                                                                                                                                                                          |true  |{"id":170801983,"name":"linuxfoundation/lfevents","url":"https://api.github.com/repos/linuxfoundation/lfevents"}|CommitCommentEvent|{"id":41898282,"login":"github-actions[bot]","display_login":"github-actions","gravatar_id":"","url":"https://api.github.com/users/github-actions[bot]","avatar_url":"https://avatars.githubusercontent.com/u/41898282?"}|
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+----------------------------------------------------------------------------------------------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
</section>
<section id="column-api" class="level4">
<h4 class="anchored" data-anchor-id="column-api">Column API</h4>
<div id="894fa3a5" class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seㅣect + Col로 DataFrame생성하기</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> spark.read.json(<span class="st">"../data/*.json"</span>)</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>df1.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- actor: string (nullable = true)
 |-- created_at: string (nullable = true)
 |-- org: string (nullable = true)
 |-- payload: string (nullable = true)
 |-- public: boolean (nullable = true)
 |-- repo: string (nullable = true)
 |-- type: string (nullable = true)
</code></pre>
</div>
</div>
<div id="b356be5f" class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>c1 <span class="op">=</span> F.col(<span class="st">"actor"</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>c2 <span class="op">=</span> F.col(<span class="st">"org"</span>)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df1.select(c1, c2)</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>df2.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- actor: string (nullable = true)
 |-- org: string (nullable = true)
</code></pre>
</div>
</div>
<div id="22ddabe8" class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># orderBy</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>df1.select(<span class="st">"org"</span>).orderBy(<span class="st">"created_at"</span>).show(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+
|                 org|
+--------------------+
|{"id":126833237,"...|
|                null|
|{"id":1040002,"lo...|
|                null|
|                null|
+--------------------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="0c7e835d" class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F.split 예제 (데이터 불러오기)</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="co">## F.split(F.col("genres"), '[|]', 2) : 마지막 숫자는 최대로 나눌 수 있는 수. -1넣으면 무제한</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> F</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> spark.read.options(header<span class="op">=</span><span class="st">'True'</span>).csv(<span class="st">"../data/movies.csv"</span>)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>df1.show(<span class="dv">3</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------+-----------------------+-------------------------------------------+
|movieId|title                  |genres                                     |
+-------+-----------------------+-------------------------------------------+
|1      |Toy Story (1995)       |Adventure|Animation|Children|Comedy|Fantasy|
|2      |Jumanji (1995)         |Adventure|Children|Fantasy                 |
|3      |Grumpier Old Men (1995)|Comedy|Romance                             |
+-------+-----------------------+-------------------------------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="2bfdb0c5" class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F.split (limit를 2로 지정)</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>cc <span class="op">=</span> F.split(F.col(<span class="st">"genres"</span>), <span class="st">'[|]'</span>, <span class="dv">2</span>)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df1.select(cc.alias(<span class="st">"cc"</span>))</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>df2.show(<span class="dv">5</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------------------------------------------+
|cc                                            |
+----------------------------------------------+
|[Adventure, Animation|Children|Comedy|Fantasy]|
|[Adventure, Children|Fantasy]                 |
|[Comedy, Romance]                             |
|[Comedy, Drama|Romance]                       |
|[Comedy]                                      |
+----------------------------------------------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="3c98ead7" class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F.split (limit를 -1로 지정, 무제한)</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>cc <span class="op">=</span> F.split(F.col(<span class="st">"genres"</span>), <span class="st">'[|]'</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df1.select(cc.alias(<span class="st">"cc"</span>))</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>df2.show(<span class="dv">5</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------------------------------+
|cc                                               |
+-------------------------------------------------+
|[Adventure, Animation, Children, Comedy, Fantasy]|
|[Adventure, Children, Fantasy]                   |
|[Comedy, Romance]                                |
|[Comedy, Drama, Romance]                         |
|[Comedy]                                         |
+-------------------------------------------------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="a0a35022" class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F.expr &amp; select(cols)</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [F.expr(<span class="ss">f"cc[</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">]"</span>) <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">2</span>)]</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> df2.select(cols)</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>df3.show(<span class="dv">5</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+---------+
|cc[0]    |cc[1]    |
+---------+---------+
|Adventure|Animation|
|Adventure|Children |
|Comedy   |Romance  |
|Comedy   |Drama    |
|Comedy   |null     |
+---------+---------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="98ff3641" class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># withColumn + F.lit : 컬럼 생성 후 값 채우기</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> df3.withColumn(<span class="st">"c3"</span>, F.lit(<span class="st">"Korea"</span>))</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>df4.show(<span class="dv">5</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+---------+-----+
|cc[0]    |cc[1]    |c3   |
+---------+---------+-----+
|Adventure|Animation|Korea|
|Adventure|Children |Korea|
|Comedy   |Romance  |Korea|
|Comedy   |Drama    |Korea|
|Comedy   |null     |Korea|
+---------+---------+-----+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="029a7ed2" class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> df4.withColumn(<span class="st">"c4"</span>, F.lit(<span class="st">"Test"</span>))</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>df5.show(<span class="dv">5</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+---------+-----+----+
|cc[0]    |cc[1]    |c3   |c4  |
+---------+---------+-----+----+
|Adventure|Animation|Korea|Test|
|Adventure|Children |Korea|Test|
|Comedy   |Romance  |Korea|Test|
|Comedy   |Drama    |Korea|Test|
|Comedy   |null     |Korea|Test|
+---------+---------+-----+----+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="e8c8088e" class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># explode : 각 행의 list-like값을, 모두 각자 다른 행으로 쪼개어 분리</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 아래 예시로, df2의 첫 행의 데이터라 df6의 1~5행으로 나뉘고, 두번째 행이 6~8로 나뉨</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>df2.show(<span class="dv">5</span>,<span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------------------------------+
|cc                                               |
+-------------------------------------------------+
|[Adventure, Animation, Children, Comedy, Fantasy]|
|[Adventure, Children, Fantasy]                   |
|[Comedy, Romance]                                |
|[Comedy, Drama, Romance]                         |
|[Comedy]                                         |
+-------------------------------------------------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="6d764d67" class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> df2.select(F.explode(col(<span class="st">"cc"</span>)))</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>df6.show(<span class="dv">10</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+
|col      |
+---------+
|Adventure|
|Animation|
|Children |
|Comedy   |
|Fantasy  |
|Adventure|
|Children |
|Fantasy  |
|Comedy   |
|Romance  |
+---------+
only showing top 10 rows
</code></pre>
</div>
</div>
<div id="c0432dee" class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>df4.show(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+---------+-----+
|    cc[0]|    cc[1]|   c3|
+---------+---------+-----+
|Adventure|Animation|Korea|
|Adventure| Children|Korea|
|   Comedy|  Romance|Korea|
|   Comedy|    Drama|Korea|
|   Comedy|     null|Korea|
+---------+---------+-----+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="8a5dda80" class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>df4.drop(<span class="st">"cc[1]"</span>, <span class="st">"c3"</span>).show(<span class="dv">5</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+
|cc[0]    |
+---------+
|Adventure|
|Adventure|
|Comedy   |
|Comedy   |
|Comedy   |
+---------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="9e308e21" class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># groupBy &amp; countDistinct</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="co">## genres기준으로, title의 Distinct값을 세서(unique)m  titleCount컬럼으로 저장</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>df7 <span class="op">=</span> df1.groupBy(<span class="st">"genres"</span>).agg(F.countDistinct(<span class="st">"title"</span>).alias(<span class="st">"titleCount"</span>))</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>df7.show(<span class="dv">5</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 253:================================================&gt;    (182 + 1) / 200]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+------------------------------+----------+
|genres                        |titleCount|
+------------------------------+----------+
|Comedy|Horror|Thriller        |17        |
|Action|Drama|Horror           |1         |
|Adventure|Sci-Fi|Thriller     |4         |
|Action|Animation|Comedy|Sci-Fi|2         |
|Action|Adventure|Drama|Fantasy|6         |
+------------------------------+----------+
only showing top 5 rows
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
[Stage 253:====================================================&gt;(198 + 1) / 200]

                                                                                </code></pre>
</div>
</div>
<div id="5e3344f4" class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort &amp; F.desc</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>df8 <span class="op">=</span> df7.sort(F.desc(<span class="st">"titleCount"</span>))</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>df8.show(<span class="dv">10</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 260:===================================================&gt; (195 + 1) / 200]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------+
|genres              |titleCount|
+--------------------+----------+
|Drama               |1053      |
|Comedy              |946       |
|Comedy|Drama        |435       |
|Comedy|Romance      |363       |
|Drama|Romance       |349       |
|Documentary         |339       |
|Comedy|Drama|Romance|276       |
|Drama|Thriller      |168       |
|Horror              |167       |
|Horror|Thriller     |135       |
+--------------------+----------+
only showing top 10 rows
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
                                                                                </code></pre>
</div>
</div>
</section>
<section id="udfuser-defined-function" class="level4">
<h4 class="anchored" data-anchor-id="udfuser-defined-function">UDF(User Defined Function)</h4>
<div id="1c8cc838" class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> F</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> spark.read.options(header<span class="op">=</span><span class="st">'True'</span>, inferSchema<span class="op">=</span><span class="st">'True'</span>, delimiter<span class="op">=</span><span class="st">','</span>).csv(<span class="st">"../data/movies.csv"</span>)</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>df1.show(<span class="dv">3</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------+-----------------------+-------------------------------------------+
|movieId|title                  |genres                                     |
+-------+-----------------------+-------------------------------------------+
|1      |Toy Story (1995)       |Adventure|Animation|Children|Comedy|Fantasy|
|2      |Jumanji (1995)         |Adventure|Children|Fantasy                 |
|3      |Grumpier Old Men (1995)|Comedy|Romance                             |
+-------+-----------------------+-------------------------------------------+
only showing top 3 rows
</code></pre>
</div>
</div>
<div id="d7c30e1c" class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>newCol <span class="op">=</span> F.udf(<span class="kw">lambda</span> v: v.upper())</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>df1.select(F.col(<span class="st">"genres"</span>), newCol(F.col(<span class="st">"genres"</span>))).show(<span class="dv">1</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------------------------+-------------------------------------------+
|genres                                     |&lt;lambda&gt;(genres)                           |
+-------------------------------------------+-------------------------------------------+
|Adventure|Animation|Children|Comedy|Fantasy|ADVENTURE|ANIMATION|CHILDREN|COMEDY|FANTASY|
+-------------------------------------------+-------------------------------------------+
only showing top 1 row
</code></pre>
</div>
</div>


</section>
</section>
</section>
</section>

<p><br><strong>Copyright © 2024 Kibok Park All rights reserved.</strong><br></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kr9268\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="kr9268/giscus_for_blog" data-repo-id="R_kgDOL0Sthw" data-category="General" data-category-id="DIC_kwDOL0Sth84Ce_5h" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<script>
    const baseFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
    const watermark = new XWatermark.XWatermark();
    watermark.init("Kibok Park", {
      parentSelector: "body",
      prevent: true,
      observer: true,
      mode: "normal",
      font: "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', 'Noto Sans', 'Liberation Sans', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'",
      fontsize: baseFontSize * 1.000000,
      angle: -15.000000,
      color: "#000000",
      alpha: 0.100000,
      cols: 10,
      rows: 50,
      xSpace: baseFontSize * 4.000000,
      ySpace: baseFontSize * 4.000000,
      zIndex: -1
    });
    </script>




</body></html>