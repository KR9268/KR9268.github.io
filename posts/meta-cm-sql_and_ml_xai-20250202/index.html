<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kibok Park">
<meta name="dcterms.date" content="2025-02-02">

<title>[DA스터디/최종과제] Autogluon활용한 베이스모델 생성 및 고도화 실험 – Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-71390cc8b9bae10139428574d3aab2c6.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c37a40b267d3139d93432c283e34c257.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-bdc1e6ac3e28299057f0fc16b5bab4ae.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/watermark-1.0.11/watermark.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LPL499WQBH"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LPL499WQBH', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index_dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index_miniprojects.html"> 
<span class="menu-text">Mini Projects</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/KR9268"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/%EA%B8%B0%EB%B3%B5-%EB%B0%95-573a68268/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">[DA스터디/최종과제] Autogluon활용한 베이스모델 생성 및 고도화 실험</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Python</div>
                <div class="quarto-category">Autogluon</div>
                <div class="quarto-category">CUDA</div>
                <div class="quarto-category">EDA</div>
                <div class="quarto-category">SHAP</div>
                <div class="quarto-category">202412Study_DataAnalysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kibok Park </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 2, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#개요" id="toc-개요" class="nav-link active" data-scroll-target="#개요">개요</a></li>
  <li><a href="#최종과제" id="toc-최종과제" class="nav-link" data-scroll-target="#최종과제">최종과제</a>
  <ul class="collapse">
  <li><a href="#과제-목표-및-데이터-설명" id="toc-과제-목표-및-데이터-설명" class="nav-link" data-scroll-target="#과제-목표-및-데이터-설명">과제 목표 및 데이터 설명</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#eda-기초통계-등" id="toc-eda-기초통계-등" class="nav-link" data-scroll-target="#eda-기초통계-등">EDA : 기초통계 등</a></li>
  <li><a href="#결측치-처리-직업유형occyp_type의-결측치는-무직을-의미할까" id="toc-결측치-처리-직업유형occyp_type의-결측치는-무직을-의미할까" class="nav-link" data-scroll-target="#결측치-처리-직업유형occyp_type의-결측치는-무직을-의미할까">결측치 처리 : 직업유형(occyp_type)의 결측치는 무직을 의미할까?</a></li>
  <li><a href="#trainvalidatetest-데이터셋으로-정리" id="toc-trainvalidatetest-데이터셋으로-정리" class="nav-link" data-scroll-target="#trainvalidatetest-데이터셋으로-정리">train/validate/test 데이터셋으로 정리</a></li>
  <li><a href="#빠른-처리를-위한-gpu설정" id="toc-빠른-처리를-위한-gpu설정" class="nav-link" data-scroll-target="#빠른-처리를-위한-gpu설정">빠른 처리를 위한 GPU설정</a></li>
  <li><a href="#평가-metric-설정" id="toc-평가-metric-설정" class="nav-link" data-scroll-target="#평가-metric-설정">평가 Metric 설정</a></li>
  <li><a href="#autogluon-활용한-베이스-모델" id="toc-autogluon-활용한-베이스-모델" class="nav-link" data-scroll-target="#autogluon-활용한-베이스-모델">Autogluon 활용한 베이스 모델</a></li>
  <li><a href="#xaishap를-통한-데이터-확인-및-불필요한-변수-제거" id="toc-xaishap를-통한-데이터-확인-및-불필요한-변수-제거" class="nav-link" data-scroll-target="#xaishap를-통한-데이터-확인-및-불필요한-변수-제거">XAI(SHAP)를 통한 데이터 확인 및 불필요한 변수 제거</a></li>
  <li><a href="#데이터-전처리를-위한-추가-eda" id="toc-데이터-전처리를-위한-추가-eda" class="nav-link" data-scroll-target="#데이터-전처리를-위한-추가-eda">데이터 전처리를 위한 추가 EDA</a>
  <ul class="collapse">
  <li><a href="#수치형-변수의-eda-및-전처리-방향" id="toc-수치형-변수의-eda-및-전처리-방향" class="nav-link" data-scroll-target="#수치형-변수의-eda-및-전처리-방향">수치형 변수의 EDA 및 전처리 방향</a></li>
  <li><a href="#수치형-변수의-전처리-진행-최소값-조정-및-로그변환" id="toc-수치형-변수의-전처리-진행-최소값-조정-및-로그변환" class="nav-link" data-scroll-target="#수치형-변수의-전처리-진행-최소값-조정-및-로그변환">수치형 변수의 전처리 진행 : 최소값 조정 및 로그변환</a></li>
  <li><a href="#범주형-변수의-eda-및-전처리-방향" id="toc-범주형-변수의-eda-및-전처리-방향" class="nav-link" data-scroll-target="#범주형-변수의-eda-및-전처리-방향">범주형 변수의 EDA 및 전처리 방향</a></li>
  <li><a href="#범주형-변수의-전처리-진행-ordinalencoder-edu_type" id="toc-범주형-변수의-전처리-진행-ordinalencoder-edu_type" class="nav-link" data-scroll-target="#범주형-변수의-전처리-진행-ordinalencoder-edu_type">범주형 변수의 전처리 진행 : OrdinalEncoder (edu_type)</a></li>
  <li><a href="#범주형-변수의-전처리-진행-onehotencoder-gender-car-reality-income_type-family_type-house_type" id="toc-범주형-변수의-전처리-진행-onehotencoder-gender-car-reality-income_type-family_type-house_type" class="nav-link" data-scroll-target="#범주형-변수의-전처리-진행-onehotencoder-gender-car-reality-income_type-family_type-house_type">범주형 변수의 전처리 진행 : OneHotEncoder (gender, car, reality, income_type, family_type, house_type)</a></li>
  <li><a href="#범주형-변수의-전처리-진행-leaveoneoutencoder-occyp_type" id="toc-범주형-변수의-전처리-진행-leaveoneoutencoder-occyp_type" class="nav-link" data-scroll-target="#범주형-변수의-전처리-진행-leaveoneoutencoder-occyp_type">범주형 변수의 전처리 진행 : LeaveOneOutEncoder (occyp_type)</a></li>
  </ul></li>
  <li><a href="#전처리-기능-함수화-및-저장" id="toc-전처리-기능-함수화-및-저장" class="nav-link" data-scroll-target="#전처리-기능-함수화-및-저장">전처리 기능 함수화 및 저장</a></li>
  <li><a href="#전처리한-데이터-및-autogluon활용한-모델-고도화" id="toc-전처리한-데이터-및-autogluon활용한-모델-고도화" class="nav-link" data-scroll-target="#전처리한-데이터-및-autogluon활용한-모델-고도화">전처리한 데이터 및 autogluon활용한 모델 고도화</a></li>
  <li><a href="#제출용-csv파일-생성-및-제출하기" id="toc-제출용-csv파일-생성-및-제출하기" class="nav-link" data-scroll-target="#제출용-csv파일-생성-및-제출하기">제출용 CSV파일 생성 및 제출하기</a></li>
  </ul></li>
  <li><a href="#향후-추가해보기" id="toc-향후-추가해보기" class="nav-link" data-scroll-target="#향후-추가해보기">향후 추가해보기</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>금융권 데이터를 활용한 분석 스터디 - 최종과제</p>
<section id="개요" class="level1">
<h1>개요</h1>
<ul>
<li>최종과제
<ul>
<li>기존에 진행했던 과제에서 해보지 않았던 것 위주로 진행해보고자 함함
<ul>
<li>GPU(CUDA)설정 : docker 및 전용 torch 패키지 설치 등</li>
<li>autogluon으로 빠르게 베이스모델 설정 후(medium quality설정) 결정력 없는 변수 먼저 제거</li>
<li>SHAP시각화 진행시, EDA로 전처리하기 전보다 데이터의 경향성 등을 확인하기 어려웠음</li>
</ul></li>
<li>학습했던 음수변수에 대한 최소값 조정 등 진행</li>
<li>One-hot, Ordinal 인코딩에 대해 배웠는데, 상하관계 혼동을 주지않으면서 컬럼 수를 증가시키지 않는 방법 고민
<ul>
<li>Leaveoneout 인코딩이라는 것을 적용. 향후에는 좀 더 알아보고 적용하면 좋을 것 같음</li>
</ul></li>
<li>전처리한 데이터를 바탕으로 autogluon(best quality)으로 고도화된 모델을 얻고자 함
<ul>
<li>데이터에 대한 반영과 AutoML을 반복하며 개선을 진행하고자하였으나, 시간관계상 1회만 진행함</li>
<li>1회만 진행하며 오히려 점수는 조금 떨어짐.</li>
<li>향후 파생변수 생성 등 데이터에 좀 더 중점을 둔 방법으로 진행해보면 좋을 것 같음</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="최종과제" class="level1">
<h1>최종과제</h1>
<section id="과제-목표-및-데이터-설명" class="level2">
<h2 class="anchored" data-anchor-id="과제-목표-및-데이터-설명">과제 목표 및 데이터 설명</h2>
<ul>
<li>과제 목표
<ul>
<li>차량소유 여부 등 데이터를 바탕으로, 고객의 신용도를 예측(대금연체를 기준으로 한 신용도)</li>
<li><strong><code>Logloss</code>의 최소화</strong></li>
</ul></li>
<li>데이터 설명
<ul>
<li>데이터 출처 : <a href="https://dacon.io/competitions/official/235713/overview/description">월간 데이콘 신용카드 사용자 연체 예측 AI 경진대회 데이터</a>
<ul>
<li>세부 출처 : https://mp.weixin.qq.com/s/upjzuPg5AMIDsGxlpqnoCg</li>
</ul></li>
<li>변수 설명 <a href="https://www.dacon.io/competitions/official/235713/talkboard/402821/?_gl=1%2a1qi5pgu%2a_gcl_au%2aMTY1MzAzMjUwMi4xNzMyNDU0MDQ2%2a_ga%2aNTU2Mjg0MDUwLjE3MjQxMzkwODk.%2a_ga_35PZM515YN%2aMTczNjI1MzI0NS4xOC4xLjE3MzYyNTMyNjQuNDEuMC4w">(데이콘설명 원본링크)</a>
<ul>
<li>gender: 성별</li>
<li>car: 차량 소유 여부</li>
<li>reality: 부동산 소유 여부</li>
<li>child_num: 자녀 수</li>
<li>income_total: 연간 소득</li>
<li>income_type: 소득 분류 [‘Commercial associate’, ‘Working’, ‘State servant’, ‘Pensioner’, ‘Student’]</li>
<li>edu_type: 교육 수준 [‘Higher education’ ,‘Secondary / secondary special’, ‘Incomplete higher’, ‘Lower secondary’, ‘Academic degree’]</li>
<li>family_type: 결혼 여부 [‘Married’, ‘Civil marriage’, ‘Separated’, ‘Single / not married’, ‘Widow’]</li>
<li>house_type: 생활 방식 [‘Municipal apartment’, ‘House / apartment’, ‘With parents’, ‘Co-op apartment’, ‘Rented apartment’, ‘Office apartment’]</li>
<li>DAYS_BIRTH: 출생일
<ul>
<li>데이터 수집 당시 (0)부터 역으로 셈, 즉, -1은 데이터 수집일 하루 전에 태어났음을 의미</li>
</ul></li>
<li>DAYS_EMPLOYED: 업무 시작일
<ul>
<li>데이터 수집 당시 (0)부터 역으로 셈, 즉, -1은 데이터 수집일 하루 전부터 일을 시작함을 의미</li>
<li>양수 값은 고용되지 않은 상태를 의미함</li>
</ul></li>
<li>FLAG_MOBIL: 핸드폰 소유 여부</li>
<li>work_phone: 업무용 전화 소유 여부</li>
<li>phone: 전화 소유 여부</li>
<li>email: 이메일 소유 여부</li>
<li>occyp_type: 직업 유형<br>
</li>
<li>family_size: 가족 규모</li>
<li>begin_month: 신용카드 발급 월
<ul>
<li>데이터 수집 당시 (0)부터 역으로 셈, 즉, -1은 데이터 수집일 한 달 전에 신용카드를 발급함을 의미</li>
</ul></li>
<li><strong>credit</strong>: 사용자의 신용카드 대금 연체를 기준으로 한 신용도
<ul>
<li>낮을 수록 높은 신용의 신용카드 사용자를 의미함</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="eda-기초통계-등" class="level2">
<h2 class="anchored" data-anchor-id="eda-기초통계-등">EDA : 기초통계 등</h2>
<ul>
<li>데이터 로딩 및 train x,y로 분할</li>
</ul>
<div id="3cff5335" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pkb_sqlite3 <span class="im">import</span> DB_sqlite3</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># db로 저장해둔 데이터 읽기</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>db_controller <span class="op">=</span> DB_sqlite3(<span class="st">'Dacon_creditcard_overdue.db'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> db_controller.search_db_show_df(<span class="st">'SELECT * FROM train'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> db_controller.search_db_show_df(<span class="st">'SELECT * FROM test'</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df_sample_submission <span class="op">=</span> db_controller.search_db_show_df(<span class="st">'SELECT * FROM sample_submission'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 나누기</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>Y_train <span class="op">=</span> df_train[<span class="st">'credit'</span>].copy()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> df_train.drop(<span class="st">'credit'</span>,axis<span class="op">=</span><span class="dv">1</span>).copy()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> df_test.copy()</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 나눠진 데이터 확인</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"""* 전체 : </span><span class="sc">{</span>df_train<span class="sc">.</span>shape<span class="sc">}</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ss">* x_train : </span><span class="sc">{</span>X_train<span class="sc">.</span>shape<span class="sc">}</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ss">* y_train : </span><span class="sc">{</span>Y_train<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>* 전체 : (26457, 20)
* x_train : (26457, 19)
* y_train : (26457,)</code></pre>
</div>
</div>
<ul>
<li>describe()를 활용한 데이터 확인
<ul>
<li>index컬럼은 삭제</li>
<li><strong>unique</strong>와 <strong>top</strong>을 기준으로, <code>gender</code>, <code>income_type</code> 등 컬럼은 범주형 변수로 추측</li>
<li><strong>count</strong>를 기준으로, <code>occyp_type</code>컬럼은 결측치가 많을 것으로 추측</li>
<li><strong>count</strong>대비 <strong>freq</strong>값을 참고하여, <code>house_type</code> 등 컬럼이 편향되어 있음을 추측</li>
</ul></li>
</ul>
<div id="c81d4725" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>X_train.describe(include<span class="op">=</span><span class="st">'all'</span>).transpose().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">unique</th>
<th data-quarto-table-cell-role="th">top</th>
<th data-quarto-table-cell-role="th">freq</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>index</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>13228.0</td>
<td>7637.622372</td>
<td>0.0</td>
<td>6614.0</td>
<td>13228.0</td>
<td>19842.0</td>
<td>26456.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>gender</td>
<td>26457</td>
<td>2</td>
<td>F</td>
<td>17697</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>car</td>
<td>26457</td>
<td>2</td>
<td>N</td>
<td>16410</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>reality</td>
<td>26457</td>
<td>2</td>
<td>Y</td>
<td>17830</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>child_num</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.428658</td>
<td>0.747326</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>19.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>income_total</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>187306.524493</td>
<td>101878.367995</td>
<td>27000.0</td>
<td>121500.0</td>
<td>157500.0</td>
<td>225000.0</td>
<td>1575000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>income_type</td>
<td>26457</td>
<td>5</td>
<td>Working</td>
<td>13645</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>edu_type</td>
<td>26457</td>
<td>5</td>
<td>Secondary / secondary special</td>
<td>17995</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>family_type</td>
<td>26457</td>
<td>5</td>
<td>Married</td>
<td>18196</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>house_type</td>
<td>26457</td>
<td>6</td>
<td>House / apartment</td>
<td>23653</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>DAYS_BIRTH</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-15958.053899</td>
<td>4201.589022</td>
<td>-25152.0</td>
<td>-19431.0</td>
<td>-15547.0</td>
<td>-12446.0</td>
<td>-7705.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>DAYS_EMPLOYED</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>59068.750728</td>
<td>137475.427503</td>
<td>-15713.0</td>
<td>-3153.0</td>
<td>-1539.0</td>
<td>-407.0</td>
<td>365243.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>FLAG_MOBIL</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>work_phone</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.224742</td>
<td>0.41742</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>phone</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.294251</td>
<td>0.455714</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>email</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.09128</td>
<td>0.288013</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>occyp_type</td>
<td>18286</td>
<td>18</td>
<td>Laborers</td>
<td>4512</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>family_size</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2.196848</td>
<td>0.916717</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>20.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>begin_month</td>
<td>26457.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-26.123294</td>
<td>16.55955</td>
<td>-60.0</td>
<td>-39.0</td>
<td>-24.0</td>
<td>-12.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="결측치-처리-직업유형occyp_type의-결측치는-무직을-의미할까" class="level2">
<h2 class="anchored" data-anchor-id="결측치-처리-직업유형occyp_type의-결측치는-무직을-의미할까">결측치 처리 : 직업유형(occyp_type)의 결측치는 무직을 의미할까?</h2>
<ul>
<li><strong>결측치가 69%에 해당하여 삭제가 아닌 대체</strong>로 진행 필요함</li>
<li>결측치에 <strong>맥락이나 의미</strong>가 있는지에 대한 고민
<ul>
<li><p>직업유형에 ’무직’을 뜻하는 단어가 없음 → None은 무직을 의미하는가?</p>
<pre><code>array([None, 'Laborers', 'Managers', 'Sales staff',
    'High skill tech staff', 'Core staff', 'Drivers', 'Medicine staff',
    'Accountants', 'Realty agents', 'Security staff', 'Cleaning staff',
    'Private service staff', 'Cooking staff', 'Secretaries',
    'HR staff', 'IT staff', 'Low-skill Laborers',
    'Waiters/barmen staff'], dtype=object)</code></pre></li>
<li><p>실제로 직업이 없음을 의미하는 데이터로 검증</p>
<ul>
<li>방법 : DAYS_EMPLOYED(고용일)이 양수인 경우 무직. 이를 대조함
<ul>
<li>직업유형이 None인 값 중, 고용기간이 있는 값과 없는 값이 공존</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DAYS_EMPLOYED 고용기간 있음</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(X_train[(X_train[<span class="st">'occyp_type'</span>].isna())<span class="op">&amp;</span>(X_train[<span class="st">'DAYS_EMPLOYED'</span>]<span class="op">&lt;</span><span class="dv">0</span>)])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">3733</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># DAYS_EMPLOYED 고용기간 없음</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(X_train[(X_train[<span class="st">'occyp_type'</span>].isna())<span class="op">&amp;</span>(X_train[<span class="st">'DAYS_EMPLOYED'</span>]<span class="op">&lt;</span><span class="dv">0</span>)])</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">4438</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>고용기간도 없는 경우는 ’NoJob’으로 대체</strong></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<div id="983ecb41" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 결측치 처리 함수</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fill_occyp_type(row):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">'occyp_type'</span>]):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">'DAYS_EMPLOYED'</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'NoJob'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> row[<span class="st">'occyp_type'</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>X_train[<span class="st">'occyp_type'</span>] <span class="op">=</span> X_train.<span class="bu">apply</span>(fill_occyp_type, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>X_train[<span class="st">'occyp_type'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([None, 'Laborers', 'Managers', 'Sales staff',
       'High skill tech staff', 'Core staff', 'Drivers', 'Medicine staff',
       'Accountants', 'NoJob', 'Realty agents', 'Security staff',
       'Cleaning staff', 'Private service staff', 'Cooking staff',
       'Secretaries', 'HR staff', 'IT staff', 'Low-skill Laborers',
       'Waiters/barmen staff'], dtype=object)</code></pre>
</div>
</div>
</section>
<section id="trainvalidatetest-데이터셋으로-정리" class="level2">
<h2 class="anchored" data-anchor-id="trainvalidatetest-데이터셋으로-정리">train/validate/test 데이터셋으로 정리</h2>
<div id="deaf5cbb" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># index컬럼 삭제</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.drop(columns<span class="op">=</span>[<span class="st">'index'</span>])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.drop(columns<span class="op">=</span>[<span class="st">'index'</span>])</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 분할</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>x_train, x_validate, y_train, y_validate<span class="op">=</span> train_test_split(X_train, Y_train, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="빠른-처리를-위한-gpu설정" class="level2">
<h2 class="anchored" data-anchor-id="빠른-처리를-위한-gpu설정">빠른 처리를 위한 GPU설정</h2>
<ul>
<li>CUDA 설치 : https://developer.nvidia.com/cuda-downloads?target_os=Windows&amp;target_arch=x86_64&amp;target_version=11&amp;target_type=exe_local</li>
<li>CUDA버전 확인 : 12.1</li>
<li>CUDA버전에 맞는, GPU지원되는 torch버전으로 설치</li>
</ul>
<div id="a6d3c503" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>nvcc <span class="op">--</span>version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2025 NVIDIA Corporation
Built on Wed_Jan_15_19:38:46_Pacific_Standard_Time_2025
Cuda compilation tools, release 12.8, V12.8.61
Build cuda_12.8.r12.8/compiler.35404655_0</code></pre>
</div>
</div>
<div id="a66df11a" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 설치된 torch버전을 확인해, torch.version.cuda가 None인 경우 CUDA지원버전으로 torch 재설치</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># torch가 GPU지원버전인지 확인(+cu121)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(torch.__version__)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(torch.version.cuda)  <span class="co"># CUDA 버전 확인 (None이면 GPU 미지원 버전)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(torch.cuda.is_available())  <span class="co"># False면 GPU 미지원</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 사용가능한 GPU확인</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(torch.cuda.device_count())  <span class="co"># 사용 가능한 GPU 개수</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(torch.cuda.get_device_name(<span class="dv">0</span>))  <span class="co"># 첫 번째 GPU 이름</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.5.1+cu121
12.1
True
1
NVIDIA GeForce RTX 2060 SUPER</code></pre>
</div>
</div>
</section>
<section id="평가-metric-설정" class="level2">
<h2 class="anchored" data-anchor-id="평가-metric-설정">평가 Metric 설정</h2>
<ul>
<li>대회 규정에 맞춰 <code>Logloss</code>를 primary metric으로 설정</li>
<li>데이터를 좀 더 용이하게 파악하고, 소통 등의 이점을 위해 보조 지표 설정
<ul>
<li>balance accuracy, weighted f1-score, roc_auc</li>
</ul></li>
</ul>
</section>
<section id="autogluon-활용한-베이스-모델" class="level2">
<h2 class="anchored" data-anchor-id="autogluon-활용한-베이스-모델">Autogluon 활용한 베이스 모델</h2>
<div id="098e0305" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autogluon.tabular <span class="im">import</span> TabularPredictor</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 저장할 경로 지정</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">'autogluon_1basemodel'</span> <span class="co"># 저장할 경로</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autogluon이 지원하지 않는 metric함수 설정(logloss로 평가예정으로 여기서는 미사용)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_f1_autogluon(y_true, y_pred_proba):</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.argmax(y_pred_proba, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f1_score(y_true, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># AutoGluon을 위해 데이터프레임으로 병합</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> x_train</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>train_data[<span class="st">'target'</span>] <span class="op">=</span> y_train</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>val_data <span class="op">=</span> x_validate</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>val_data[<span class="st">'target'</span>] <span class="op">=</span> y_validate</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># AutoGluon 학습</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>predictor <span class="op">=</span> TabularPredictor(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'target'</span>, </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    problem_type<span class="op">=</span><span class="st">'multiclass'</span>, </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    eval_metric<span class="op">=</span><span class="st">'log_loss'</span>, </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    verbosity<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    path<span class="op">=</span>path</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>predictor.fit(</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    train_data,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    tuning_data<span class="op">=</span>val_data,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    time_limit<span class="op">=</span><span class="dv">3600</span>,  <span class="co"># 시간 제한 설정 (1시간)</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    num_gpus<span class="op">=</span><span class="dv">1</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: path already exists! This predictor may overwrite an existing predictor! path="autogluon_1basemodel"
Verbosity: 2 (Standard Logging)
=================== System Info ===================
AutoGluon Version:  1.2
Python Version:     3.12.8
Operating System:   Windows
Platform Machine:   AMD64
Platform Version:   10.0.26100
CPU Count:          8
Memory Avail:       5.73 GB / 15.94 GB (35.9%)
Disk Space Avail:   504.61 GB / 931.51 GB (54.2%)
===================================================
No presets specified! To achieve strong results with AutoGluon, it is recommended to use the available presets. Defaulting to `'medium'`...
    Recommended Presets (For more details refer to https://auto.gluon.ai/stable/tutorials/tabular/tabular-essentials.html#presets):
    presets='experimental' : New in v1.2: Pre-trained foundation model + parallel fits. The absolute best accuracy without consideration for inference speed. Does not support GPU.
    presets='best'         : Maximize accuracy. Recommended for most users. Use in competitions and benchmarks.
    presets='high'         : Strong accuracy with fast inference speed.
    presets='good'         : Good accuracy with very fast inference speed.
    presets='medium'       : Fast training time, ideal for initial prototyping.
Beginning AutoGluon training ... Time limit = 3600s
AutoGluon will save models to "e:\0_Backup\14.Python\metacode_202412_study_creditmodeling\autogluon_1basemodel"
Train Data Rows:    18519
Train Data Columns: 18
Tuning Data Rows:    7938
Tuning Data Columns: 18
Label Column:       target
Problem Type:       multiclass
Preprocessing data ...
Train Data Class Count: 3
Using Feature Generators to preprocess the data ...
Fitting AutoMLPipelineFeatureGenerator...
    Available Memory:                    5876.50 MB
    Train Data (Original)  Memory Usage: 13.65 MB (0.2% of available memory)
    Inferring data type of each feature based on column values. Set feature_metadata_in to manually specify special dtypes of the features.
    Stage 1 Generators:
        Fitting AsTypeFeatureGenerator...
            Note: Converting 6 features to boolean dtype as they only contain 2 unique values.
    Stage 2 Generators:
        Fitting FillNaFeatureGenerator...
    Stage 3 Generators:
        Fitting IdentityFeatureGenerator...
        Fitting CategoryFeatureGenerator...
            Fitting CategoryMemoryMinimizeFeatureGenerator...
    Stage 4 Generators:
        Fitting DropUniqueFeatureGenerator...
    Stage 5 Generators:
        Fitting DropDuplicatesFeatureGenerator...
    Useless Original Features (Count: 1): ['FLAG_MOBIL']
        These features carry no predictive signal and should be manually investigated.
        This is typically a feature which has the same value for all rows.
        These features do not need to be present at inference time.
    Types of features in original data (raw dtype, special dtypes):
        ('float', [])  : 3 | ['income_total', 'family_size', 'begin_month']
        ('int', [])    : 6 | ['child_num', 'DAYS_BIRTH', 'DAYS_EMPLOYED', 'work_phone', 'phone', ...]
        ('object', []) : 8 | ['gender', 'car', 'reality', 'income_type', 'edu_type', ...]
    Types of features in processed data (raw dtype, special dtypes):
        ('category', [])  : 5 | ['income_type', 'edu_type', 'family_type', 'house_type', 'occyp_type']
        ('float', [])     : 3 | ['income_total', 'family_size', 'begin_month']
        ('int', [])       : 3 | ['child_num', 'DAYS_BIRTH', 'DAYS_EMPLOYED']
        ('int', ['bool']) : 6 | ['gender', 'car', 'reality', 'work_phone', 'phone', ...]
    0.4s = Fit runtime
    17 features in original data used to generate 17 features in processed data.
    Train Data (Processed) Memory Usage: 1.49 MB (0.0% of available memory)
Data preprocessing and feature engineering runtime = 0.44s ...
AutoGluon will gauge predictive performance using evaluation metric: 'log_loss'
    This metric's sign has been flipped to adhere to being higher_is_better. The metric score can be multiplied by -1 to get the metric value.
    This metric expects predicted probabilities rather than predicted class labels, so you'll need to use predict_proba() instead of predict()
    To change this, specify the eval_metric parameter of Predictor()
User-specified model hyperparameters to be fit:
{
    'NN_TORCH': [{}],
    'GBM': [{'extra_trees': True, 'ag_args': {'name_suffix': 'XT'}}, {}, {'learning_rate': 0.03, 'num_leaves': 128, 'feature_fraction': 0.9, 'min_data_in_leaf': 3, 'ag_args': {'name_suffix': 'Large', 'priority': 0, 'hyperparameter_tune_kwargs': None}}],
    'CAT': [{}],
    'XGB': [{}],
    'FASTAI': [{}],
    'RF': [{'criterion': 'gini', 'ag_args': {'name_suffix': 'Gini', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'entropy', 'ag_args': {'name_suffix': 'Entr', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'squared_error', 'ag_args': {'name_suffix': 'MSE', 'problem_types': ['regression', 'quantile']}}],
    'XT': [{'criterion': 'gini', 'ag_args': {'name_suffix': 'Gini', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'entropy', 'ag_args': {'name_suffix': 'Entr', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'squared_error', 'ag_args': {'name_suffix': 'MSE', 'problem_types': ['regression', 'quantile']}}],
    'KNN': [{'weights': 'uniform', 'ag_args': {'name_suffix': 'Unif'}}, {'weights': 'distance', 'ag_args': {'name_suffix': 'Dist'}}],
}
Fitting 13 L1 models, fit_strategy="sequential" ...
Fitting model: KNeighborsUnif ... Training model for up to 3599.56s of the 3599.55s of remaining time.
    -2.1126  = Validation score   (-log_loss)
    0.04s    = Training   runtime
    0.06s    = Validation runtime
Fitting model: KNeighborsDist ... Training model for up to 3599.42s of the 3599.42s of remaining time.
    -2.5663  = Validation score   (-log_loss)
    0.05s    = Training   runtime
    0.05s    = Validation runtime
Fitting model: NeuralNetFastAI ... Training model for up to 3599.30s of the 3599.29s of remaining time.
    -0.8157  = Validation score   (-log_loss)
    29.12s   = Training   runtime
    0.11s    = Validation runtime
Fitting model: LightGBMXT ... Training model for up to 3570.04s of the 3570.03s of remaining time.
    Training LightGBMXT with GPU, note that this may negatively impact model quality compared to CPU training.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1000]  valid_set's multi_logloss: 0.760515</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>    -0.7594  = Validation score   (-log_loss)
    25.16s   = Training   runtime
    0.22s    = Validation runtime
Fitting model: LightGBM ... Training model for up to 3544.53s of the 3544.52s of remaining time.
    Training LightGBM with GPU, note that this may negatively impact model quality compared to CPU training.
    -0.7514  = Validation score   (-log_loss)
    11.64s   = Training   runtime
    0.09s    = Validation runtime
Fitting model: RandomForestGini ... Training model for up to 3532.74s of the 3532.74s of remaining time.
    -0.7675  = Validation score   (-log_loss)
    1.74s    = Training   runtime
    0.1s     = Validation runtime
Fitting model: RandomForestEntr ... Training model for up to 3530.57s of the 3530.56s of remaining time.
    -0.7735  = Validation score   (-log_loss)
    1.94s    = Training   runtime
    0.1s     = Validation runtime
Fitting model: CatBoost ... Training model for up to 3528.25s of the 3528.24s of remaining time.
    Training CatBoost with GPU, note that this may negatively impact model quality compared to CPU training.
    Warning: CatBoost on GPU is experimental. If you encounter issues, use CPU for training CatBoost instead.
    -0.7615  = Validation score   (-log_loss)
    26.21s   = Training   runtime
    0.03s    = Validation runtime
Fitting model: ExtraTreesGini ... Training model for up to 3501.99s of the 3501.99s of remaining time.
    -0.7841  = Validation score   (-log_loss)
    1.15s    = Training   runtime
    0.12s    = Validation runtime
Fitting model: ExtraTreesEntr ... Training model for up to 3500.37s of the 3500.37s of remaining time.
    -0.7812  = Validation score   (-log_loss)
    1.14s    = Training   runtime
    0.1s     = Validation runtime
Fitting model: XGBoost ... Training model for up to 3482.78s of the 3482.78s of remaining time.
e:\0_Backup\14.Python\metacode_202412_study_creditmodeling\.venv\Lib\site-packages\xgboost\core.py:158: UserWarning: [02:32:39] WARNING: C:\buildkite-agent\builds\buildkite-windows-cpu-autoscaling-group-i-0c55ff5f71b100e98-1\xgboost\xgboost-ci-windows\src\common\error_msg.cc:27: The tree method `gpu_hist` is deprecated since 2.0.0. To use GPU training, set the `device` parameter to CUDA instead.

    E.g. tree_method = "hist", device = "cuda"

  warnings.warn(smsg, UserWarning)
e:\0_Backup\14.Python\metacode_202412_study_creditmodeling\.venv\Lib\site-packages\xgboost\core.py:158: UserWarning: [02:32:44] WARNING: C:\buildkite-agent\builds\buildkite-windows-cpu-autoscaling-group-i-0c55ff5f71b100e98-1\xgboost\xgboost-ci-windows\src\common\error_msg.cc:27: The tree method `gpu_hist` is deprecated since 2.0.0. To use GPU training, set the `device` parameter to CUDA instead.

    E.g. tree_method = "hist", device = "cuda"

  warnings.warn(smsg, UserWarning)
    -0.7579  = Validation score   (-log_loss)
    5.54s    = Training   runtime
    0.04s    = Validation runtime
Fitting model: NeuralNetTorch ... Training model for up to 3477.17s of the 3477.17s of remaining time.
    -0.8183  = Validation score   (-log_loss)
    36.99s   = Training   runtime
    0.04s    = Validation runtime
Fitting model: LightGBMLarge ... Training model for up to 3440.13s of the 3440.13s of remaining time.
    Training LightGBMLarge with GPU, note that this may negatively impact model quality compared to CPU training.
    -0.7414  = Validation score   (-log_loss)
    39.25s   = Training   runtime
    0.12s    = Validation runtime
Fitting model: WeightedEnsemble_L2 ... Training model for up to 360.00s of the 3400.63s of remaining time.
    Ensemble Weights: {'RandomForestGini': 0.32, 'LightGBM': 0.2, 'KNeighborsDist': 0.12, 'CatBoost': 0.12, 'LightGBMLarge': 0.12, 'NeuralNetTorch': 0.08, 'XGBoost': 0.04}
    -0.7193  = Validation score   (-log_loss)
    0.67s    = Training   runtime
    0.0s     = Validation runtime
AutoGluon training complete, total runtime = 200.09s ... Best model: WeightedEnsemble_L2 | Estimated inference throughput: 16983.3 rows/s (7938 batch size)
TabularPredictor saved. To load, use: predictor = TabularPredictor.load("e:\0_Backup\14.Python\metacode_202412_study_creditmodeling\autogluon_1basemodel")</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;autogluon.tabular.predictor.predictor.TabularPredictor at 0x2543c01fec0&gt;</code></pre>
</div>
</div>
<div id="9d299941" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 단순 참고용</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, log_loss, confusion_matrix</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 예측 및 평가</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> x_validate</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>test_data[<span class="st">'target'</span>] <span class="op">=</span> y_validate</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>y_pred_proba_ag <span class="op">=</span> predictor.predict_proba(test_data)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>y_pred_ag <span class="op">=</span> predictor.predict(test_data)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> predictor.predict(test_data)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>y_proba <span class="op">=</span> predictor.predict_proba(test_data)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(test_data[<span class="st">'target'</span>], y_pred)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>logloss <span class="op">=</span> log_loss(test_data[<span class="st">'target'</span>], y_proba)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>cf <span class="op">=</span> confusion_matrix(test_data[<span class="st">'target'</span>], y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b7e8987a" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>predictor.leaderboard(x_validate, extra_metrics<span class="op">=</span>[<span class="st">'balanced_accuracy'</span>, <span class="st">'f1_weighted'</span>, <span class="st">'roc_auc_ovr_weighted'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">score_test</th>
<th data-quarto-table-cell-role="th">balanced_accuracy</th>
<th data-quarto-table-cell-role="th">f1_weighted</th>
<th data-quarto-table-cell-role="th">roc_auc_ovr_weighted</th>
<th data-quarto-table-cell-role="th">score_val</th>
<th data-quarto-table-cell-role="th">eval_metric</th>
<th data-quarto-table-cell-role="th">pred_time_test</th>
<th data-quarto-table-cell-role="th">pred_time_val</th>
<th data-quarto-table-cell-role="th">fit_time</th>
<th data-quarto-table-cell-role="th">pred_time_test_marginal</th>
<th data-quarto-table-cell-role="th">pred_time_val_marginal</th>
<th data-quarto-table-cell-role="th">fit_time_marginal</th>
<th data-quarto-table-cell-role="th">stack_level</th>
<th data-quarto-table-cell-role="th">can_infer</th>
<th data-quarto-table-cell-role="th">fit_order</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>WeightedEnsemble_L2</td>
<td>-0.719272</td>
<td>0.506493</td>
<td>0.679734</td>
<td>0.759321</td>
<td>-0.719287</td>
<td>log_loss</td>
<td>1.010035</td>
<td>0.467401</td>
<td>122.088188</td>
<td>0.006076</td>
<td>0.001995</td>
<td>0.671924</td>
<td>2</td>
<td>True</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>LightGBMLarge</td>
<td>-0.741424</td>
<td>0.473018</td>
<td>0.658814</td>
<td>0.734866</td>
<td>-0.741424</td>
<td>log_loss</td>
<td>0.145274</td>
<td>0.116242</td>
<td>39.248754</td>
<td>0.145274</td>
<td>0.116242</td>
<td>39.248754</td>
<td>1</td>
<td>True</td>
<td>13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>LightGBM</td>
<td>-0.751353</td>
<td>0.453062</td>
<td>0.644461</td>
<td>0.723493</td>
<td>-0.751353</td>
<td>log_loss</td>
<td>0.158483</td>
<td>0.090607</td>
<td>11.635407</td>
<td>0.158483</td>
<td>0.090607</td>
<td>11.635407</td>
<td>1</td>
<td>True</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>XGBoost</td>
<td>-0.757927</td>
<td>0.465824</td>
<td>0.651667</td>
<td>0.720750</td>
<td>-0.757927</td>
<td>log_loss</td>
<td>0.178037</td>
<td>0.036000</td>
<td>5.536725</td>
<td>0.178037</td>
<td>0.036000</td>
<td>5.536725</td>
<td>1</td>
<td>True</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>LightGBMXT</td>
<td>-0.759434</td>
<td>0.459947</td>
<td>0.645968</td>
<td>0.718343</td>
<td>-0.759434</td>
<td>log_loss</td>
<td>0.324177</td>
<td>0.224359</td>
<td>25.162158</td>
<td>0.324177</td>
<td>0.224359</td>
<td>25.162158</td>
<td>1</td>
<td>True</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>CatBoost</td>
<td>-0.761541</td>
<td>0.439993</td>
<td>0.633287</td>
<td>0.713087</td>
<td>-0.761541</td>
<td>log_loss</td>
<td>0.074158</td>
<td>0.026571</td>
<td>26.207678</td>
<td>0.074158</td>
<td>0.026571</td>
<td>26.207678</td>
<td>1</td>
<td>True</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>RandomForestGini</td>
<td>-0.767504</td>
<td>0.534628</td>
<td>0.685285</td>
<td>0.752369</td>
<td>-0.767504</td>
<td>log_loss</td>
<td>0.331259</td>
<td>0.102593</td>
<td>1.737886</td>
<td>0.331259</td>
<td>0.102593</td>
<td>1.737886</td>
<td>1</td>
<td>True</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>RandomForestEntr</td>
<td>-0.773531</td>
<td>0.532764</td>
<td>0.684485</td>
<td>0.752317</td>
<td>-0.773531</td>
<td>log_loss</td>
<td>0.299343</td>
<td>0.100369</td>
<td>1.936155</td>
<td>0.299343</td>
<td>0.100369</td>
<td>1.936155</td>
<td>1</td>
<td>True</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>ExtraTreesEntr</td>
<td>-0.781154</td>
<td>0.514000</td>
<td>0.672208</td>
<td>0.737642</td>
<td>-0.781154</td>
<td>log_loss</td>
<td>0.451465</td>
<td>0.101042</td>
<td>1.143195</td>
<td>0.451465</td>
<td>0.101042</td>
<td>1.143195</td>
<td>1</td>
<td>True</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>ExtraTreesGini</td>
<td>-0.784103</td>
<td>0.515487</td>
<td>0.674453</td>
<td>0.736337</td>
<td>-0.784103</td>
<td>log_loss</td>
<td>0.368600</td>
<td>0.121832</td>
<td>1.149729</td>
<td>0.368600</td>
<td>0.121832</td>
<td>1.149729</td>
<td>1</td>
<td>True</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>NeuralNetFastAI</td>
<td>-0.815732</td>
<td>0.439552</td>
<td>0.628491</td>
<td>0.674919</td>
<td>-0.815732</td>
<td>log_loss</td>
<td>0.096067</td>
<td>0.113365</td>
<td>29.115618</td>
<td>0.096067</td>
<td>0.113365</td>
<td>29.115618</td>
<td>1</td>
<td>True</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>NeuralNetTorch</td>
<td>-0.818329</td>
<td>0.411790</td>
<td>0.606342</td>
<td>0.648959</td>
<td>-0.818329</td>
<td>log_loss</td>
<td>0.063465</td>
<td>0.040002</td>
<td>36.994816</td>
<td>0.063465</td>
<td>0.040002</td>
<td>36.994816</td>
<td>1</td>
<td>True</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>KNeighborsUnif</td>
<td>-2.112598</td>
<td>0.473339</td>
<td>0.607854</td>
<td>0.666518</td>
<td>-2.112598</td>
<td>log_loss</td>
<td>0.036525</td>
<td>0.056145</td>
<td>0.042302</td>
<td>0.036525</td>
<td>0.056145</td>
<td>0.042302</td>
<td>1</td>
<td>True</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>KNeighborsDist</td>
<td>-2.566280</td>
<td>0.530617</td>
<td>0.647806</td>
<td>0.697774</td>
<td>-2.566280</td>
<td>log_loss</td>
<td>0.053282</td>
<td>0.053392</td>
<td>0.054998</td>
<td>0.053282</td>
<td>0.053392</td>
<td>0.054998</td>
<td>1</td>
<td>True</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="xaishap를-통한-데이터-확인-및-불필요한-변수-제거" class="level2">
<h2 class="anchored" data-anchor-id="xaishap를-통한-데이터-확인-및-불필요한-변수-제거">XAI(SHAP)를 통한 데이터 확인 및 불필요한 변수 제거</h2>
<ul>
<li>WeightedEnsemble_L2모델은 KernelExplainer 실행시 76~79시간 소요 예상</li>
<li>데이터의 확인과 변수를 걸러낼 용도이므로, 빠르게 가능하면서 2번째로 성능이 좋았던 모델로 SHAP 확인
<ul>
<li>X_train을 넣엇으나, 데이터구성이 다르다는 오류 발생 (autogluon이 제거했던 feature가 있었음)
<ul>
<li>확인해보니 휴대폰 소유여부로, 요즘 시대에 중요한 변수는 아닐 것 같은 생각이 들어 제외하기로 함</li>
</ul>
<pre><code>set(X_train) - set(model.feature_name())
&gt;&gt;&gt; {'FLAG_MOBIL'}</code></pre></li>
</ul></li>
</ul>
<div id="9bf74a92" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># FLAG_MOBIL 드랍</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.drop(columns<span class="op">=</span><span class="st">'FLAG_MOBIL'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Autogluon의 모델 가져오기</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> predictor._trainer.load_model(<span class="st">"LightGBMLarge"</span>).model</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># SHAP계산을 위해 Autogluon의 피쳐형태와 동일하게 만들기</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>X_train_transformed <span class="op">=</span> predictor.transform_features(X_train)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Explainer를 활용한 SHAP 계산</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(model)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>shap_values_train <span class="op">=</span> explainer.shap_values(X_train_transformed)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 전체 SHAP값의 절대값의 평균으로 Feature Importance 구하기</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>shap_values_mean <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(shap_values_train), axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">2</span>))  <span class="co"># (35,) 크기</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"""SHAP value의 Shape              : </span><span class="sc">{</span>shap_values_train<span class="sc">.</span>shape<span class="sc">}</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="ss">SHAP Feature Importance의 Shape : </span><span class="sc">{</span>shap_values_mean<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SHAP value의 Shape              : (26457, 17, 3)
SHAP Feature Importance의 Shape : (17,)</code></pre>
</div>
</div>
<ul>
<li>Feature importance 확인
<ul>
<li>소득이나 교육수준 등 일반적으로 영향을 미칠것으로 보이는 feature들이 상위에 보임</li>
<li>importance가 0인 경우는 없어, 현재 상황에서 feature삭제는 별도로 하지 않음
<ul>
<li>지난 실습때는 전체fit &amp; SHAP importance산출 후 0이었던 FLAG_MOBIL을 직접 삭제</li>
<li>이번에는 autogluon을 통해 영향없는 feature로 자동 제외됨</li>
</ul></li>
</ul></li>
</ul>
<div id="00c47146" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Feature'</span>: [<span class="ss">f'</span><span class="sc">{</span>X_train<span class="sc">.</span>columns[i]<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shap_values_mean.shape[<span class="dv">0</span>])],</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Importance'</span>: shap_values_mean</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>}).sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>feature_importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature</th>
<th data-quarto-table-cell-role="th">Importance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>work_phone</td>
<td>0.309656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>income_type</td>
<td>0.126218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>edu_type</td>
<td>0.093286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>income_total</td>
<td>0.087204</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>begin_month</td>
<td>0.083925</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>phone</td>
<td>0.029627</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>email</td>
<td>0.021359</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>occyp_type</td>
<td>0.020650</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>child_num</td>
<td>0.019754</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>DAYS_EMPLOYED</td>
<td>0.018939</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>house_type</td>
<td>0.017252</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>family_type</td>
<td>0.014357</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>reality</td>
<td>0.014261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>DAYS_BIRTH</td>
<td>0.012142</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>car</td>
<td>0.011479</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>gender</td>
<td>0.010771</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>family_size</td>
<td>0.008313</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>신용도 높음(0)과 낮음(2)에 대해서 SHAP Summary plot 시각화
<ul>
<li>회색은 영향도가 낮은 값이라고 하며, 해당하는 값인 소득수준 등이 제외할 정도로 무의미한 값으로는 판단되지 않아 삭제는 하지 않음</li>
<li>전반적으로 섞여있거나 유의미하게 특징적인 부분은 발견하지 못함</li>
</ul></li>
</ul>
<div id="c773beca" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 글꼴 크기 조정</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">8</span>})</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 그림 생성 및 크기 설정 (2개의 서브플롯)</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">30</span>, <span class="dv">8</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0에 대한 SHAP 값 시각화</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plt.sca(axes[<span class="dv">0</span>])</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    shap_values_train[:, :, <span class="dv">0</span>],</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    X_train_transformed,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>X_train_transformed.columns,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    plot_type<span class="op">=</span><span class="st">"dot"</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    show<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Class 0"</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"SHAP value"</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 2에 대한 SHAP 값 시각화</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>plt.sca(axes[<span class="dv">1</span>])</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    shap_values_train[:, :, <span class="dv">2</span>],</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    X_train_transformed,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>X_train_transformed.columns,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    plot_type<span class="op">=</span><span class="st">"dot"</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    show<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Class 2"</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"SHAP value"</span>)</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 전체 그림 제목 설정</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"SHAP Summary Plots for Classes 0 and 2"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 그림 간격 조정</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 그림 표시</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="데이터-전처리를-위한-추가-eda" class="level2">
<h2 class="anchored" data-anchor-id="데이터-전처리를-위한-추가-eda">데이터 전처리를 위한 추가 EDA</h2>
<section id="수치형-변수의-eda-및-전처리-방향" class="level3">
<h3 class="anchored" data-anchor-id="수치형-변수의-eda-및-전처리-방향">수치형 변수의 EDA 및 전처리 방향</h3>
<ul>
<li>유무(0,1)만을 나타내는 값은 별도로 처리하지 않음 : <code>work_phone</code>, <code>phone</code>, <code>email</code></li>
<li>음수변수는 최소값 조정 : <code>DAYS_BIRTH</code>, <code>DAYS_EMPLOYED</code>, <code>begin_month</code></li>
<li>왜도/첨도/이상치 확인에 따라 추가적인 조정 : <code>DAYS_BIRTH</code>, <code>DAYS_EMPLOYED</code>, <code>begin_month</code>, <code>child_num</code>, <code>income_total</code>, <code>family_size</code>
<ul>
<li>왜도가 크고, IQR기준 이상치를 보유한 3개 변수에 대해 로그변환 진행 : <code>child_num</code>, <code>income_total</code>, <code>DAYS_EMPLOYED</code></li>
<li>타 변수 대비 값의 규모(천~만 단위)가 달라 발생할 수 있는 문제를 방지하고자 정규화(Min-Max) : <code>DAYS_BIRTH</code></li>
</ul></li>
</ul>
<div id="b9474db4" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 수치형 변수 추출</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>x_numerical <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>전반적인 시각화 및 왜도/첨도 확인
<ul>
<li>왜도가 큰 3개 변수 : <code>child_num</code>, <code>income_total</code>, <code>DAYS_EMPLOYED</code></li>
</ul></li>
</ul>
<div id="4f0428b1" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 왜도/첨도 분석</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_to_analyze <span class="op">=</span> x_numerical[[<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>, <span class="st">'child_num'</span>, <span class="st">'income_total'</span>, <span class="st">'family_size'</span>]]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>numeric_skew <span class="op">=</span> df_to_analyze.skew().reset_index().rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'왜도'</span>, <span class="st">'index'</span>:<span class="st">'feature_s'</span>}).sort_values(by<span class="op">=</span><span class="st">'왜도'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>numeric_kurt <span class="op">=</span> df_to_analyze.kurtosis().reset_index().rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'첨도'</span>, <span class="st">'index'</span>:<span class="st">'feature_k'</span>}).sort_values(by<span class="op">=</span><span class="st">'첨도'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>pd.concat([numeric_skew.reset_index(), numeric_kurt.reset_index()], axis<span class="op">=</span><span class="dv">1</span>)[[<span class="st">'feature_s'</span>,<span class="st">'왜도'</span>,<span class="st">'feature_k'</span>,<span class="st">'첨도'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_s</th>
<th data-quarto-table-cell-role="th">왜도</th>
<th data-quarto-table-cell-role="th">feature_k</th>
<th data-quarto-table-cell-role="th">첨도</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>begin_month</td>
<td>-0.290050</td>
<td>DAYS_BIRTH</td>
<td>-1.046188</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>DAYS_BIRTH</td>
<td>-0.185986</td>
<td>begin_month</td>
<td>-1.041906</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>family_size</td>
<td>1.431759</td>
<td>DAYS_EMPLOYED</td>
<td>1.161734</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DAYS_EMPLOYED</td>
<td>1.777596</td>
<td>family_size</td>
<td>10.578051</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>income_total</td>
<td>2.659271</td>
<td>income_total</td>
<td>16.359621</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>child_num</td>
<td>2.852376</td>
<td>child_num</td>
<td>29.172394</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="42fc5607" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 히스토그램 시각화를 통한 확인</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 시각화 대상</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>columns_to_visualize <span class="op">=</span> [<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>, <span class="st">'child_num'</span>, <span class="st">'income_total'</span>, <span class="st">'family_size'</span>]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>df_to_visualize <span class="op">=</span> x_numerical[columns_to_visualize]</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 설정: 가로 그래프 개수</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>num_vars <span class="op">=</span> <span class="bu">len</span>(columns_to_visualize)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> math.ceil(num_vars <span class="op">/</span> cols)  <span class="co"># 필요한 행(row) 수 계산</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 서브플롯 생성</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">15</span>, rows <span class="op">*</span> <span class="dv">3</span>))  <span class="co"># 전체 figure 크기 조정</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()  <span class="co"># 2D 배열을 1D로 변환하여 인덱싱 편리하게</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 그래프 그리기</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var_idx, var_nm <span class="kw">in</span> <span class="bu">enumerate</span>(columns_to_visualize):</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[var_idx]</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    ax.hist(df_to_visualize.iloc[:, var_idx], bins<span class="op">=</span><span class="st">'auto'</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>var_nm<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 빈 서브플롯 숨기기</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_vars, <span class="bu">len</span>(axes)):</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    axes[i].axis(<span class="st">'off'</span>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>이상치 확인
<ul>
<li><code>DAYS_EMPLOYED</code>의 경우 365243값에 3천여개가 모여있으며, 양수인 경우 무직임을 표현하므로 1로 변경을 고려했으나, 모델에 확실히 다른 값임을 알리기 위해 변환하지 않음</li>
<li>나머지 변수는 이상치의 적정 수준과 판단이 어려워 별도로 처리하지 않음
<ul>
<li>IQR기준으로 판단된 이상치가 실제 이상치로 봐야할지에 대한 부분이 모호</li>
<li><code>child_num</code> : 자녀가 19명인 경우는 확실히 이상치라는 느낌이지만, 몇명부터 이상치로 봐야할지 판단 어려움</li>
<li><code>family_size</code> : 가족구성원도 시대상에 따라 평균치가 감소할 순 있겠으나, 이상치의 기준선이 모호함</li>
</ul></li>
</ul></li>
</ul>
<div id="3bfd7920" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IQR기준 이상치</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_unique_outliers(x_numerical, x_outliers):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 각 컬럼별로 이상치의 고유값을 추출하여 딕셔너리로 저장</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    unique_outliers <span class="op">=</span> x_numerical[x_outliers].<span class="bu">apply</span>(<span class="kw">lambda</span> col: col.unique().tolist())</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 딕셔너리 형태로 반환</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    unique_outliers_dict <span class="op">=</span> unique_outliers.to_dict()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unique_outliers_dict</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>unique_outliers <span class="op">=</span> summarize_unique_outliers(x_numerical, x_outliers)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"""* 이상치로 판명된 Unique값 현황</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="ss">child_num : </span><span class="sc">{</span>unique_outliers[<span class="st">'child_num'</span>]<span class="sc">}</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="ss">income_total : </span><span class="sc">{</span>unique_outliers[<span class="st">'income_total'</span>]<span class="sc">}</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="ss">DAYS_EMPLOYED : </span><span class="sc">{</span>unique_outliers[<span class="st">'DAYS_EMPLOYED'</span>]<span class="sc">}</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="ss">family_size : </span><span class="sc">{</span>unique_outliers[<span class="st">'family_size'</span>]<span class="sc">}</span><span class="ss">"""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>* 이상치로 판명된 Unique값 현황
child_num : [nan, 3.0, 4.0, 5.0, 14.0, 19.0, 7.0]
income_total : [nan, 450000.0, 405000.0, 585000.0, 495000.0, 540000.0, 459000.0, 720000.0, 382500.0, 427500.0, 562500.0, 630000.0, 432000.0, 391500.0, 675000.0, 612000.0, 1575000.0, 652500.0, 387000.0, 945000.0, 418500.0, 634500.0, 423000.0, 517500.0, 900000.0, 560250.0, 445500.0, 616500.0, 765000.0, 396000.0, 472500.0, 594000.0, 810000.0, 468000.0, 661500.0, 716323.5, 787500.0, 990000.0, 494100.0, 441000.0, 531000.0, 607500.0, 742500.0, 697500.0, 1125000.0, 414000.0, 1350000.0]
DAYS_EMPLOYED : [nan, 365243.0, -9391.0, -9404.0, -12332.0, -9988.0, -11940.0, -8091.0, -9957.0, -7310.0, -11062.0, -7514.0, -8671.0, -10121.0, -12278.0, -7415.0, -8553.0, -7593.0, -7401.0, -9683.0, -7346.0, -9925.0, -7379.0, -8375.0, -7536.0, -10600.0, -7851.0, -9575.0, -9255.0, -8298.0, -8163.0, -12179.0, -13245.0, -9258.0, -8100.0, -10384.0, -10821.0, -8538.0, -8772.0, -9359.0, -15072.0, -7733.0, -7979.0, -7471.0, -11951.0, -8412.0, -7824.0, -11589.0, -12169.0, -7840.0, -8022.0, -8316.0, -9485.0, -7624.0, -10149.0, -8953.0, -11451.0, -10454.0, -9479.0, -11183.0, -9870.0, -10079.0, -8109.0, -8684.0, -7465.0, -11157.0, -11083.0, -9269.0, -15038.0, -8643.0, -7371.0, -10094.0, -8479.0, -10290.0, -7734.0, -8469.0, -9866.0, -8760.0, -10689.0, -7752.0, -8737.0, -8855.0, -10236.0, -7627.0, -8794.0, -9136.0, -9751.0, -12423.0, -10437.0, -13102.0, -7369.0, -10050.0, -7288.0, -7718.0, -12148.0, -7866.0, -7827.0, -9947.0, -7341.0, -7830.0, -7400.0, -14810.0, -7804.0, -12949.0, -14473.0, -7614.0, -9046.0, -8131.0, -9447.0, -7404.0, -12827.0, -8649.0, -8369.0, -9178.0, -8405.0, -12621.0, -8063.0, -9225.0, -11884.0, -8284.0, -10936.0, -9745.0, -7698.0, -8377.0, -8497.0, -7364.0, -8624.0, -8083.0, -10364.0, -10994.0, -8348.0, -8206.0, -7888.0, -10490.0, -13800.0, -7778.0, -8448.0, -8862.0, -8015.0, -7551.0, -8714.0, -9422.0, -10758.0, -8509.0, -7347.0, -8803.0, -7811.0, -7413.0, -8157.0, -10110.0, -10993.0, -8143.0, -7747.0, -11693.0, -8040.0, -8691.0, -8033.0, -8875.0, -12647.0, -10762.0, -7557.0, -10773.0, -8601.0, -11552.0, -7522.0, -7738.0, -11542.0, -8756.0, -9152.0, -8987.0, -9482.0, -9029.0, -9076.0, -11906.0, -8140.0, -7949.0, -11907.0, -7622.0, -9239.0, -9748.0, -9349.0, -7278.0, -7500.0, -9724.0, -8036.0, -9975.0, -8767.0, -8443.0, -7871.0, -13415.0, -7513.0, -8966.0, -14018.0, -9044.0, -9240.0, -7276.0, -9564.0, -8044.0, -8175.0, -9385.0, -7679.0, -8376.0, -8647.0, -7786.0, -8254.0, -8995.0, -10155.0, -8710.0, -8290.0, -9419.0, -10909.0, -8071.0, -7343.0, -9581.0, -10475.0, -10217.0, -9363.0, -12490.0, -7373.0, -9236.0, -9131.0, -10361.0, -9508.0, -8535.0, -12870.0, -7640.0, -11398.0, -9756.0, -8152.0, -11202.0, -7900.0, -9052.0, -14536.0, -8808.0, -14413.0, -9194.0, -11954.0, -8325.0, -8801.0, -9794.0, -10843.0, -11555.0, -8230.0, -8618.0, -9389.0, -10629.0, -7916.0, -7504.0, -11272.0, -7566.0, -10353.0, -8072.0, -9325.0, -9311.0, -8757.0, -7676.0, -8411.0, -9698.0, -10647.0, -11061.0, -14338.0, -9830.0, -14887.0, -9320.0, -7314.0, -11332.0, -7838.0, -10147.0, -9527.0, -12455.0, -8011.0, -10305.0, -7280.0, -13010.0, -10746.0, -7953.0, -8491.0, -7706.0, -10052.0, -9316.0, -11603.0, -10688.0, -7835.0, -8410.0, -11692.0, -7518.0, -9574.0, -12917.0, -9559.0, -12513.0, -8870.0, -7494.0, -7591.0, -8256.0, -7756.0, -8342.0, -9270.0, -9181.0, -11683.0, -8510.0, -8189.0, -10232.0, -8863.0, -12462.0, -10627.0, -12163.0, -9989.0, -10452.0, -7736.0, -11448.0, -8205.0, -12253.0, -8066.0, -9019.0, -10777.0]
family_size : [nan, 5.0, 6.0, 7.0, 15.0, 20.0, 9.0]</code></pre>
</div>
</div>
<div id="cffc2270" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IQR기준 이상치 시각화</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_outliers_fast(df):</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate IQR without NaN values</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    Q1 <span class="op">=</span> df.quantile(<span class="fl">0.25</span>, interpolation<span class="op">=</span><span class="st">'midpoint'</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    Q3 <span class="op">=</span> df.quantile(<span class="fl">0.75</span>, interpolation<span class="op">=</span><span class="st">'midpoint'</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="op">=</span> Q1 <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="op">=</span> Q3 <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorized outlier detection with NaN handling</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    outlier_flags <span class="op">=</span> df.<span class="bu">apply</span>(</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> col: <span class="op">~</span>col.between(lower_bound[col.name], upper_bound[col.name]) <span class="op">&amp;</span> col.notna()</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> outlier_flags</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 시각화 대상</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>columns_to_visualize <span class="op">=</span> [<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>, <span class="st">'child_num'</span>, <span class="st">'income_total'</span>, <span class="st">'family_size'</span>]</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>df_to_visualize <span class="op">=</span> x_numerical[columns_to_visualize]</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 구한 이상치가 0인 경우를 제외하고 표기</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>x_outliers <span class="op">=</span> detect_outliers_fast(df_to_visualize)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>outliers_to_see <span class="op">=</span> x_outliers.<span class="bu">sum</span>()[x_outliers.<span class="bu">sum</span>()<span class="op">&gt;</span><span class="dv">0</span>]</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 설정: 가로 그래프 개수</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>num_vars <span class="op">=</span> <span class="bu">len</span>(outliers_to_see.index)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> math.ceil(num_vars <span class="op">/</span> cols)  <span class="co"># 필요한 행(row) 수 계산</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 서브플롯 생성</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">18</span>, rows <span class="op">*</span> <span class="dv">4</span>))  <span class="co"># 전체 figure 크기 조정</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()  <span class="co"># 2D 배열을 1D로 변환하여 인덱싱 편리하게</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 그래프 그리기</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var_idx, var_nm <span class="kw">in</span> <span class="bu">enumerate</span>(outliers_to_see.index):</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[var_idx]</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(x<span class="op">=</span>df_to_visualize[var_nm], ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'lightblue'</span>)</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>var_nm<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(var_nm)</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 빈 서브플롯 숨기기</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_vars, <span class="bu">len</span>(axes)):</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    axes[i].axis(<span class="st">'off'</span>)</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="수치형-변수의-전처리-진행-최소값-조정-및-로그변환" class="level3">
<h3 class="anchored" data-anchor-id="수치형-변수의-전처리-진행-최소값-조정-및-로그변환">수치형 변수의 전처리 진행 : 최소값 조정 및 로그변환</h3>
<div id="ce97f66a" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 최소값 조정</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>x_numerical[[<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>]] <span class="op">=</span> x_numerical[[<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>]] <span class="op">+</span> x_numerical[[<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>]].<span class="bu">min</span>()<span class="op">*-</span><span class="dv">1</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 로그변환</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>x_numerical[[<span class="st">'child_num'</span>, <span class="st">'income_total'</span>, <span class="st">'DAYS_EMPLOYED'</span>]] <span class="op">=</span> x_numerical[[<span class="st">'child_num'</span>, <span class="st">'income_total'</span>, <span class="st">'DAYS_EMPLOYED'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x : np.log1p(x))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Min-Max Scaler 적용</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>min_max_scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>x_numerical[[<span class="st">'DAYS_BIRTH'</span>]]  <span class="op">=</span> min_max_scaler.fit_transform(x_numerical[[<span class="st">'DAYS_BIRTH'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7fb4abfc" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>x_numerical.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">child_num</th>
<th data-quarto-table-cell-role="th">income_total</th>
<th data-quarto-table-cell-role="th">DAYS_BIRTH</th>
<th data-quarto-table-cell-role="th">DAYS_EMPLOYED</th>
<th data-quarto-table-cell-role="th">FLAG_MOBIL</th>
<th data-quarto-table-cell-role="th">work_phone</th>
<th data-quarto-table-cell-role="th">phone</th>
<th data-quarto-table-cell-role="th">email</th>
<th data-quarto-table-cell-role="th">family_size</th>
<th data-quarto-table-cell-role="th">begin_month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.000000</td>
<td>12.218500</td>
<td>0.644982</td>
<td>9.306105</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2.0</td>
<td>54.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.693147</td>
<td>12.419170</td>
<td>0.789362</td>
<td>9.559165</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>3.0</td>
<td>55.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.000000</td>
<td>13.017005</td>
<td>0.347624</td>
<td>9.330787</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>2.0</td>
<td>38.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="범주형-변수의-eda-및-전처리-방향" class="level3">
<h3 class="anchored" data-anchor-id="범주형-변수의-eda-및-전처리-방향">범주형 변수의 EDA 및 전처리 방향</h3>
<ul>
<li>전체 변수 : <code>gender</code>, <code>car</code>, <code>reality</code>, <code>income_type</code>, <code>family_type</code>, <code>house_type</code>, <code>occyp_type</code>, <code>edu_type</code></li>
<li>모델의 혼동(상위관계 여부)을 방지하고자 <code>OneHotEncoder</code> : <code>gender</code>, <code>car</code>, <code>reality</code>, <code>income_type</code>, <code>family_type</code>, <code>house_type</code>
<ul>
<li>대다수의 변수가 2~6개의 unique값을 가져 크게 어려움은 없을 것으로 보임</li>
</ul></li>
<li>순서가 중요한 Ordinal변수에 대해서 <code>OrdinalEncoder</code>로 우선순위를 지정 : <code>edu_type</code></li>
<li>unique값이 18개로 많은 편이며, 모델의 상하관계 혼동도 방지하고자 <code>LeaveOneOutEncoder</code>(타겟 인코딩) : <code>occyp_type</code></li>
</ul>
<div id="05e68f8a" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 범주형 변수 추출</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>x_categorical <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c376d28c" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 전반적인 시각화</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># credit 데이터 합치기</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>combined_data <span class="op">=</span> x_categorical.copy()</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>combined_data[<span class="st">'credit'</span>] <span class="op">=</span> y_train.copy()  <span class="co"># 동일한 인덱스를 기준으로 credit 추가</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 범주형 변수 설정</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> [<span class="st">'gender'</span>, <span class="st">'car'</span>, <span class="st">'reality'</span>, <span class="st">'income_type'</span>, <span class="st">'edu_type'</span>, <span class="st">'family_type'</span>, <span class="st">'house_type'</span>, <span class="st">'occyp_type'</span>]</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>num_vars <span class="op">=</span> <span class="bu">len</span>(categorical_columns)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> math.ceil(num_vars <span class="op">/</span> cols)  <span class="co"># 필요한 행(row) 수 계산</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 서브플롯 생성</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">18</span>, rows <span class="op">*</span> <span class="dv">5</span>))  <span class="co"># 전체 figure 크기 조정</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()  <span class="co"># 2D 배열을 1D로 변환하여 인덱싱 편리하게</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 그래프 그리기</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, var_nm <span class="kw">in</span> <span class="bu">enumerate</span>(categorical_columns):</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[idx]</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 데이터 그룹화 및 스택 데이터 계산</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    stacked_data <span class="op">=</span> combined_data.groupby([var_nm, <span class="st">'credit'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 각 카테고리의 막대 그래프 그리기</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    bottom_values <span class="op">=</span> np.zeros(<span class="bu">len</span>(stacked_data))</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> credit_value <span class="kw">in</span> stacked_data.columns:</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        ax.bar(stacked_data.index, stacked_data[credit_value], bottom<span class="op">=</span>bottom_values, label<span class="op">=</span><span class="ss">f'Credit </span><span class="sc">{</span>credit_value<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        bottom_values <span class="op">+=</span> stacked_data[credit_value]</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 그래프 설정</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'Stacked Bar Plot of </span><span class="sc">{</span>var_nm<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(var_nm)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Count'</span>)</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    ax.legend(title<span class="op">=</span><span class="st">'Credit'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 빈 서브플롯 숨기기</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_vars, <span class="bu">len</span>(axes)):</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    axes[i].axis(<span class="st">'off'</span>)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="범주형-변수의-전처리-진행-ordinalencoder-edu_type" class="level3">
<h3 class="anchored" data-anchor-id="범주형-변수의-전처리-진행-ordinalencoder-edu_type">범주형 변수의 전처리 진행 : OrdinalEncoder (edu_type)</h3>
<div id="6733346b" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Label인코딩 후 (Order값은 낮은 것부터 입력)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Lower secondary'</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Secondary / secondary special'</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Incomplete higher'</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Higher education'</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Academic degree'</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>o_encoder <span class="op">=</span> OrdinalEncoder(categories<span class="op">=</span>[order])</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>oe_df <span class="op">=</span> o_encoder.fit_transform(x_categorical[[<span class="st">'edu_type'</span>]])</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>x_categorical[<span class="st">'edu_type'</span>] <span class="op">=</span> oe_df.flatten()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="범주형-변수의-전처리-진행-onehotencoder-gender-car-reality-income_type-family_type-house_type" class="level3">
<h3 class="anchored" data-anchor-id="범주형-변수의-전처리-진행-onehotencoder-gender-car-reality-income_type-family_type-house_type">범주형 변수의 전처리 진행 : OneHotEncoder (gender, car, reality, income_type, family_type, house_type)</h3>
<div id="4db19851" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot 인코딩 데이터프레임 생성</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>one_hot_columns <span class="op">=</span> [<span class="st">'gender'</span>, <span class="st">'car'</span>, <span class="st">'reality'</span>, <span class="st">'income_type'</span>, <span class="st">'family_type'</span>, <span class="st">'house_type'</span>]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>oh_encoder <span class="op">=</span> OneHotEncoder(sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>onehot_encoded <span class="op">=</span> oh_encoder.fit_transform(x_categorical[one_hot_columns])</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>encoded_col_names <span class="op">=</span> oh_encoder.get_feature_names_out(input_features<span class="op">=</span>one_hot_columns)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>df_onehot_encoded <span class="op">=</span> pd.DataFrame(onehot_encoded, columns<span class="op">=</span>encoded_col_names, index<span class="op">=</span>x_categorical.index)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ont-hot인코딩된 데이터프레임으로 교체</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>x_categorical.drop(one_hot_columns, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>x_categorical <span class="op">=</span> pd.concat([x_categorical, df_onehot_encoded], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="범주형-변수의-전처리-진행-leaveoneoutencoder-occyp_type" class="level3">
<h3 class="anchored" data-anchor-id="범주형-변수의-전처리-진행-leaveoneoutencoder-occyp_type">범주형 변수의 전처리 진행 : LeaveOneOutEncoder (occyp_type)</h3>
<div id="38cc5927" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> category_encoders <span class="im">as</span> ce</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>x_column <span class="op">=</span> <span class="st">'occyp_type'</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>leave_one_out_encoder <span class="op">=</span> ce.LeaveOneOutEncoder(cols<span class="op">=</span>x_column, sigma<span class="op">=</span><span class="fl">0.1</span>, return_df<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>df_target_encoded <span class="op">=</span> leave_one_out_encoder.fit_transform(x_categorical[x_column], Y_train)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>joblib.dump(leave_one_out_encoder, <span class="st">'encoder_leave_one_out.pkl'</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>x_categorical[<span class="st">'occyp_type'</span>] <span class="op">=</span> df_target_encoded[<span class="st">'occyp_type'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="전처리-기능-함수화-및-저장" class="level2">
<h2 class="anchored" data-anchor-id="전처리-기능-함수화-및-저장">전처리 기능 함수화 및 저장</h2>
<div id="d1ebb552" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler, StandardScaler, OrdinalEncoder, OneHotEncoder</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> category_encoders <span class="im">as</span> ce</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pkb_sqlite3 <span class="im">import</span> DB_sqlite3</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_x_data(train_or_test:<span class="bu">str</span>, dataset:<span class="bu">list</span>[DataFrame], output_name:<span class="bu">dict</span>)<span class="op">-&gt;</span><span class="va">None</span>:</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 파라메터 검증 및 데이터셋 복사</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> train_or_test <span class="op">==</span> <span class="st">'train'</span>:</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(dataset) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>            X_train <span class="op">=</span> dataset[<span class="dv">0</span>].copy()</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>            Y_train <span class="op">=</span> dataset[<span class="dv">1</span>].copy()</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'train인 경우 x,y 데이터가 필요합니다'</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> train_or_test <span class="op">==</span> <span class="st">'test'</span>:</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(dataset) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>            X_train <span class="op">=</span> dataset[<span class="dv">0</span>].copy()</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'test인 경우 x 데이터만 필요합니다'</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'train 또는 test만 입력 가능합니다'</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (공통)결측치 대체 : occyp_type</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fill_occyp_type(row):</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(row[<span class="st">'occyp_type'</span>]):</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'DAYS_EMPLOYED'</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="st">'NoJob'</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> row[<span class="st">'occyp_type'</span>]</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    X_train[<span class="st">'occyp_type'</span>] <span class="op">=</span> X_train.<span class="bu">apply</span>(fill_occyp_type, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 수치형 변수 작업</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>    x_numerical <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">## 최소값 조정</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>    x_numerical[[<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>]] <span class="op">=</span> x_numerical[[<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>]] <span class="op">+</span> x_numerical[[<span class="st">'DAYS_BIRTH'</span>, <span class="st">'DAYS_EMPLOYED'</span>, <span class="st">'begin_month'</span>]].<span class="bu">min</span>()<span class="op">*-</span><span class="dv">1</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">## 로그변환</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    x_numerical[[<span class="st">'child_num'</span>, <span class="st">'income_total'</span>, <span class="st">'DAYS_EMPLOYED'</span>]] <span class="op">=</span> x_numerical[[<span class="st">'child_num'</span>, <span class="st">'income_total'</span>, <span class="st">'DAYS_EMPLOYED'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x : np.log1p(x))</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Min-Max Scaler 적용</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    min_max_scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>    x_numerical[[<span class="st">'DAYS_BIRTH'</span>]]  <span class="op">=</span> min_max_scaler.fit_transform(x_numerical[[<span class="st">'DAYS_BIRTH'</span>]])</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 범주형 변수 작업</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    x_categorical <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>])</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Label인코딩</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> [</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lower secondary'</span>,</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Secondary / secondary special'</span>,</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Incomplete higher'</span>,</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Higher education'</span>,</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Academic degree'</span></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>    o_encoder <span class="op">=</span> OrdinalEncoder(categories<span class="op">=</span>[order])</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>    oe_df <span class="op">=</span> o_encoder.fit_transform(x_categorical[[<span class="st">'edu_type'</span>]])</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>    x_categorical[<span class="st">'edu_type'</span>] <span class="op">=</span> oe_df.flatten()</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">## One-hot 인코딩</span></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>    one_hot_columns <span class="op">=</span> [<span class="st">'gender'</span>, <span class="st">'car'</span>, <span class="st">'reality'</span>, <span class="st">'income_type'</span>, <span class="st">'family_type'</span>, <span class="st">'house_type'</span>]</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>    oh_encoder <span class="op">=</span> OneHotEncoder(sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>    onehot_encoded <span class="op">=</span> oh_encoder.fit_transform(x_categorical[one_hot_columns])</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>    encoded_col_names <span class="op">=</span> oh_encoder.get_feature_names_out(input_features<span class="op">=</span>one_hot_columns)</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>    df_onehot_encoded <span class="op">=</span> pd.DataFrame(onehot_encoded, columns<span class="op">=</span>encoded_col_names, index<span class="op">=</span>x_categorical.index)</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>    x_categorical.drop(one_hot_columns, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>    x_categorical <span class="op">=</span> pd.concat([x_categorical, df_onehot_encoded], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">## LeaveOneOut인코딩</span></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>    x_column <span class="op">=</span> <span class="st">'occyp_type'</span></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>    <span class="co">### 파일로 저장해둔 인코더가 있으면 로딩, 아니면 생성</span></span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.isfile(<span class="st">'encoder_leave_one_out.pkl'</span>):</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>        leave_one_out_encoder <span class="op">=</span> joblib.load(<span class="st">'encoder_leave_one_out.pkl'</span>)</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>        leave_one_out_encoder <span class="op">=</span> ce.LeaveOneOutEncoder(cols<span class="op">=</span>x_column, sigma<span class="op">=</span><span class="fl">0.1</span>, return_df<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">### 인코딩된 데이터 생성 및 인코더 업데이트</span></span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> train_or_test <span class="op">==</span> <span class="st">'train'</span>:</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>        df_target_encoded <span class="op">=</span> leave_one_out_encoder.fit_transform(x_categorical[x_column], Y_train)</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> train_or_test <span class="op">==</span> <span class="st">'test'</span>:</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>        df_target_encoded <span class="op">=</span> leave_one_out_encoder.transform(x_categorical[x_column])</span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>    joblib.dump(leave_one_out_encoder, <span class="st">'encoder_leave_one_out.pkl'</span>)</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>    x_categorical[<span class="st">'occyp_type'</span>] <span class="op">=</span> df_target_encoded[<span class="st">'occyp_type'</span>]</span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 나누어 작업한 수치형/범주형 변수 합치고 저장</span></span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>    x_train_preprocessed <span class="op">=</span> pd.concat([x_categorical, x_numerical], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> train_or_test <span class="op">==</span> <span class="st">'train'</span>:</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a>        x_train_preprocessed <span class="op">=</span> pd.concat([x_train_preprocessed, Y_train], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> train_or_test <span class="op">==</span> <span class="st">'test'</span>:</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>    <span class="co">## CSV저장 </span></span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>    x_train_preprocessed.to_csv(output_name[<span class="st">'csv_file_name'</span>]) <span class="co"># 'train_preprocessed.csv'</span></span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">## DB저장 (아래 함수는 이미 테이블이 있는 경우 덮어씀)</span></span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a>    db_controller.df_to_table(output_name[<span class="st">'db_table_name'</span>], x_train_preprocessed) <span class="co"># 'train_pre'</span></span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'작업이 완료되었습니다'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c3dd48ce" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train 데이터 전처리</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>preprocess_x_data(train_or_test<span class="op">=</span><span class="st">'train'</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                  dataset<span class="op">=</span>[X_train, Y_train], </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                  output_name<span class="op">=</span>{<span class="st">'csv_file_name'</span>:<span class="st">'train_preprocessed.csv'</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'db_table_name'</span>:<span class="st">'train_pre'</span>}</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'작업이 완료되었습니다'</code></pre>
</div>
</div>
<div id="db828cdf" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 전처리 후 db저장된 결과 확인</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>db_controller.search_db_show_df(<span class="st">"SELECT * FROM train_pre"</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">edu_type</th>
<th data-quarto-table-cell-role="th">occyp_type</th>
<th data-quarto-table-cell-role="th">gender_F</th>
<th data-quarto-table-cell-role="th">gender_M</th>
<th data-quarto-table-cell-role="th">car_N</th>
<th data-quarto-table-cell-role="th">car_Y</th>
<th data-quarto-table-cell-role="th">reality_N</th>
<th data-quarto-table-cell-role="th">reality_Y</th>
<th data-quarto-table-cell-role="th">income_type_Commercial associate</th>
<th data-quarto-table-cell-role="th">income_type_Pensioner</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">income_total</th>
<th data-quarto-table-cell-role="th">DAYS_BIRTH</th>
<th data-quarto-table-cell-role="th">DAYS_EMPLOYED</th>
<th data-quarto-table-cell-role="th">FLAG_MOBIL</th>
<th data-quarto-table-cell-role="th">work_phone</th>
<th data-quarto-table-cell-role="th">phone</th>
<th data-quarto-table-cell-role="th">email</th>
<th data-quarto-table-cell-role="th">family_size</th>
<th data-quarto-table-cell-role="th">begin_month</th>
<th data-quarto-table-cell-role="th">credit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
<td>1.461445</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>...</td>
<td>12.218500</td>
<td>0.644982</td>
<td>9.306105</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2.0</td>
<td>54.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>1.488029</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>...</td>
<td>12.419170</td>
<td>0.789362</td>
<td>9.559165</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>3.0</td>
<td>55.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>1.652069</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>13.017005</td>
<td>0.347624</td>
<td>9.330787</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>2.0</td>
<td>38.0</td>
<td>2.0</td>
</tr>
</tbody>
</table>

<p>3 rows × 35 columns</p>
</div>
</div>
</div>
<div id="04bb680c" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test 데이터 전처리</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>preprocess_x_data(train_or_test<span class="op">=</span><span class="st">'test'</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                  dataset<span class="op">=</span>[X_test], </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                  output_name<span class="op">=</span>{<span class="st">'csv_file_name'</span>:<span class="st">'test_preprocessed.csv'</span>, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'db_table_name'</span>:<span class="st">'test_pre'</span>}</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'작업이 완료되었습니다'</code></pre>
</div>
</div>
</section>
<section id="전처리한-데이터-및-autogluon활용한-모델-고도화" class="level2">
<h2 class="anchored" data-anchor-id="전처리한-데이터-및-autogluon활용한-모델-고도화">전처리한 데이터 및 autogluon활용한 모델 고도화</h2>
<div id="607646b1" class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>pre_df_train <span class="op">=</span> db_controller.search_db_show_df(<span class="st">"SELECT * FROM train_pre"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 나누기</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>Y_train <span class="op">=</span> pre_df_train[<span class="st">'credit'</span>].copy()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>pre_X_train <span class="op">=</span> pre_df_train.drop(<span class="st">'credit'</span>,axis<span class="op">=</span><span class="dv">1</span>).copy()</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> df_test.copy()</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 분할</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>pre_x_train, pre_x_validate, y_train, y_validate<span class="op">=</span> train_test_split(pre_X_train, Y_train, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="69776404" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autogluon.tabular <span class="im">import</span> TabularPredictor</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 저장할 경로 지정</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">'autogluon_2secondmodel'</span> <span class="co"># 저장할 경로</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># AutoGluon을 위해 데이터프레임으로 병합</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> pre_x_train</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>train_data[<span class="st">'target'</span>] <span class="op">=</span> y_train</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>val_data <span class="op">=</span> pre_x_validate</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>val_data[<span class="st">'target'</span>] <span class="op">=</span> y_validate</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># AutoGluon 학습</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>predictor <span class="op">=</span> TabularPredictor(</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'target'</span>, </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    problem_type<span class="op">=</span><span class="st">'multiclass'</span>, </span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    eval_metric<span class="op">=</span><span class="st">'log_loss'</span>, </span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    verbosity<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    path<span class="op">=</span>path,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>predictor.fit(</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    train_data,</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    tuning_data<span class="op">=</span>val_data,</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    time_limit<span class="op">=</span><span class="dv">3600</span>,  <span class="co"># 시간 제한 설정 (1시간)</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    num_gpus<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>    presets<span class="op">=</span><span class="st">'best_quality'</span>,</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    use_bag_holdout<span class="op">=</span><span class="va">True</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: path already exists! This predictor may overwrite an existing predictor! path="autogluon_2secondmodel"
Verbosity: 2 (Standard Logging)
=================== System Info ===================
AutoGluon Version:  1.2
Python Version:     3.12.8
Operating System:   Windows
Platform Machine:   AMD64
Platform Version:   10.0.26100
CPU Count:          8
Memory Avail:       5.04 GB / 15.94 GB (31.6%)
Disk Space Avail:   504.61 GB / 931.51 GB (54.2%)
===================================================
Presets specified: ['best_quality']
Setting dynamic_stacking from 'auto' to False. Reason: Skip dynamic_stacking when use_bag_holdout is enabled. (use_bag_holdout=True)
Stack configuration (auto_stack=True): num_stack_levels=1, num_bag_folds=8, num_bag_sets=1
Beginning AutoGluon training ... Time limit = 3600s
AutoGluon will save models to "e:\0_Backup\14.Python\metacode_202412_study_creditmodeling\autogluon_2secondmodel"
Train Data Rows:    18519
Train Data Columns: 34
Tuning Data Rows:    7938
Tuning Data Columns: 34
Label Column:       target
Problem Type:       multiclass
Preprocessing data ...
Train Data Class Count: 3
Using Feature Generators to preprocess the data ...
Fitting AutoMLPipelineFeatureGenerator...
    Available Memory:                    5148.66 MB
    Train Data (Original)  Memory Usage: 6.86 MB (0.1% of available memory)
    Inferring data type of each feature based on column values. Set feature_metadata_in to manually specify special dtypes of the features.
    Stage 1 Generators:
        Fitting AsTypeFeatureGenerator...
            Note: Converting 25 features to boolean dtype as they only contain 2 unique values.
    Stage 2 Generators:
        Fitting FillNaFeatureGenerator...
    Stage 3 Generators:
        Fitting IdentityFeatureGenerator...
    Stage 4 Generators:
        Fitting DropUniqueFeatureGenerator...
    Stage 5 Generators:
        Fitting DropDuplicatesFeatureGenerator...
    Useless Original Features (Count: 1): ['FLAG_MOBIL']
        These features carry no predictive signal and should be manually investigated.
        This is typically a feature which has the same value for all rows.
        These features do not need to be present at inference time.
    Types of features in original data (raw dtype, special dtypes):
        ('float', []) : 30 | ['edu_type', 'occyp_type', 'gender_F', 'gender_M', 'car_N', ...]
        ('int', [])   :  3 | ['work_phone', 'phone', 'email']
    Types of features in processed data (raw dtype, special dtypes):
        ('float', [])     :  8 | ['edu_type', 'occyp_type', 'child_num', 'income_total', 'DAYS_BIRTH', ...]
        ('int', ['bool']) : 25 | ['gender_F', 'gender_M', 'car_N', 'car_Y', 'reality_N', ...]
    0.1s = Fit runtime
    33 features in original data used to generate 33 features in processed data.
    Train Data (Processed) Memory Usage: 2.25 MB (0.0% of available memory)
Data preprocessing and feature engineering runtime = 0.19s ...
AutoGluon will gauge predictive performance using evaluation metric: 'log_loss'
    This metric's sign has been flipped to adhere to being higher_is_better. The metric score can be multiplied by -1 to get the metric value.
    This metric expects predicted probabilities rather than predicted class labels, so you'll need to use predict_proba() instead of predict()
    To change this, specify the eval_metric parameter of Predictor()
use_bag_holdout=True, will use tuning_data as holdout (will not be used for early stopping).
Large model count detected (112 configs) ... Only displaying the first 3 models of each family. To see all, set `verbosity=3`.
User-specified model hyperparameters to be fit:
{
    'NN_TORCH': [{}, {'activation': 'elu', 'dropout_prob': 0.10077639529843717, 'hidden_size': 108, 'learning_rate': 0.002735937344002146, 'num_layers': 4, 'use_batchnorm': True, 'weight_decay': 1.356433327634438e-12, 'ag_args': {'name_suffix': '_r79', 'priority': -2}}, {'activation': 'elu', 'dropout_prob': 0.11897478034205347, 'hidden_size': 213, 'learning_rate': 0.0010474382260641949, 'num_layers': 4, 'use_batchnorm': False, 'weight_decay': 5.594471067786272e-10, 'ag_args': {'name_suffix': '_r22', 'priority': -7}}],
    'GBM': [{'extra_trees': True, 'ag_args': {'name_suffix': 'XT'}}, {}, {'learning_rate': 0.03, 'num_leaves': 128, 'feature_fraction': 0.9, 'min_data_in_leaf': 3, 'ag_args': {'name_suffix': 'Large', 'priority': 0, 'hyperparameter_tune_kwargs': None}}],
    'CAT': [{}, {'depth': 6, 'grow_policy': 'SymmetricTree', 'l2_leaf_reg': 2.1542798306067823, 'learning_rate': 0.06864209415792857, 'max_ctr_complexity': 4, 'one_hot_max_size': 10, 'ag_args': {'name_suffix': '_r177', 'priority': -1}}, {'depth': 8, 'grow_policy': 'Depthwise', 'l2_leaf_reg': 2.7997999596449104, 'learning_rate': 0.031375015734637225, 'max_ctr_complexity': 2, 'one_hot_max_size': 3, 'ag_args': {'name_suffix': '_r9', 'priority': -5}}],
    'XGB': [{}, {'colsample_bytree': 0.6917311125174739, 'enable_categorical': False, 'learning_rate': 0.018063876087523967, 'max_depth': 10, 'min_child_weight': 0.6028633586934382, 'ag_args': {'name_suffix': '_r33', 'priority': -8}}, {'colsample_bytree': 0.6628423832084077, 'enable_categorical': False, 'learning_rate': 0.08775715546881824, 'max_depth': 5, 'min_child_weight': 0.6294123374222513, 'ag_args': {'name_suffix': '_r89', 'priority': -16}}],
    'FASTAI': [{}, {'bs': 256, 'emb_drop': 0.5411770367537934, 'epochs': 43, 'layers': [800, 400], 'lr': 0.01519848858318159, 'ps': 0.23782946566604385, 'ag_args': {'name_suffix': '_r191', 'priority': -4}}, {'bs': 2048, 'emb_drop': 0.05070411322605811, 'epochs': 29, 'layers': [200, 100], 'lr': 0.08974235041576624, 'ps': 0.10393466140748028, 'ag_args': {'name_suffix': '_r102', 'priority': -11}}],
    'RF': [{'criterion': 'gini', 'ag_args': {'name_suffix': 'Gini', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'entropy', 'ag_args': {'name_suffix': 'Entr', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'squared_error', 'ag_args': {'name_suffix': 'MSE', 'problem_types': ['regression', 'quantile']}}],
    'XT': [{'criterion': 'gini', 'ag_args': {'name_suffix': 'Gini', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'entropy', 'ag_args': {'name_suffix': 'Entr', 'problem_types': ['binary', 'multiclass']}}, {'criterion': 'squared_error', 'ag_args': {'name_suffix': 'MSE', 'problem_types': ['regression', 'quantile']}}],
    'KNN': [{'weights': 'uniform', 'ag_args': {'name_suffix': 'Unif'}}, {'weights': 'distance', 'ag_args': {'name_suffix': 'Dist'}}],
}
AutoGluon will fit 2 stack levels (L1 to L2) ...
Fitting 110 L1 models, fit_strategy="sequential" ...
Fitting model: KNeighborsUnif_BAG_L1 ... Training model for up to 2399.27s of the 3599.79s of remaining time.
    -2.4262  = Validation score   (-log_loss)
    0.12s    = Training   runtime
    0.08s    = Validation runtime
Fitting model: KNeighborsDist_BAG_L1 ... Training model for up to 2398.82s of the 3599.34s of remaining time.
    -2.4431  = Validation score   (-log_loss)
    0.04s    = Training   runtime
    0.08s    = Validation runtime
Fitting model: NeuralNetFastAI_BAG_L1 ... Training model for up to 2398.47s of the 3598.99s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.37%)
    -0.8011  = Validation score   (-log_loss)
    86.42s   = Training   runtime
    1.02s    = Validation runtime
Fitting model: LightGBMXT_BAG_L1 ... Training model for up to 2303.53s of the 3504.05s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=0.35%)
    -0.7725  = Validation score   (-log_loss)
    10.48s   = Training   runtime
    2.17s    = Validation runtime
Fitting model: LightGBM_BAG_L1 ... Training model for up to 2282.75s of the 3483.27s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=0.36%)
    -0.7655  = Validation score   (-log_loss)
    7.32s    = Training   runtime
    1.02s    = Validation runtime
Fitting model: RandomForestGini_BAG_L1 ... Training model for up to 2267.33s of the 3467.85s of remaining time.
    -0.7434  = Validation score   (-log_loss)
    2.07s    = Training   runtime
    0.39s    = Validation runtime
Fitting model: RandomForestEntr_BAG_L1 ... Training model for up to 2263.26s of the 3463.78s of remaining time.
    -0.7396  = Validation score   (-log_loss)
    2.31s    = Training   runtime
    3.34s    = Validation runtime
Fitting model: CatBoost_BAG_L1 ... Training model for up to 2256.21s of the 3456.73s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.52%)
    -0.7751  = Validation score   (-log_loss)
    97.28s   = Training   runtime
    0.2s     = Validation runtime
Fitting model: ExtraTreesGini_BAG_L1 ... Training model for up to 2155.91s of the 3356.43s of remaining time.
    -0.7802  = Validation score   (-log_loss)
    1.54s    = Training   runtime
    0.56s    = Validation runtime
Fitting model: ExtraTreesEntr_BAG_L1 ... Training model for up to 2152.48s of the 3353.00s of remaining time.
    -0.7828  = Validation score   (-log_loss)
    1.42s    = Training   runtime
    0.51s    = Validation runtime
Fitting model: XGBoost_BAG_L1 ... Training model for up to 2144.57s of the 3345.09s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.59%)
    -0.7668  = Validation score   (-log_loss)
    21.91s   = Training   runtime
    1.11s    = Validation runtime
Fitting model: NeuralNetTorch_BAG_L1 ... Training model for up to 2118.51s of the 3319.03s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (1 workers, per: cpus=8, gpus=0, memory=0.22%)
    -0.8113  = Validation score   (-log_loss)
    251.72s  = Training   runtime
    0.31s    = Validation runtime
Fitting model: LightGBMLarge_BAG_L1 ... Training model for up to 1863.68s of the 3064.20s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=0.73%)
    -0.7542  = Validation score   (-log_loss)
    9.23s    = Training   runtime
    1.39s    = Validation runtime
Fitting model: CatBoost_r177_BAG_L1 ... Training model for up to 1847.37s of the 3047.89s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.45%)
    -0.7746  = Validation score   (-log_loss)
    63.28s   = Training   runtime
    0.15s    = Validation runtime
Fitting model: NeuralNetTorch_r79_BAG_L1 ... Training model for up to 1781.19s of the 2981.71s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (1 workers, per: cpus=8, gpus=0, memory=0.19%)
    -0.7953  = Validation score   (-log_loss)
    293.93s  = Training   runtime
    0.32s    = Validation runtime
Fitting model: LightGBM_r131_BAG_L1 ... Training model for up to 1484.24s of the 2684.76s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=0.44%)
    -0.7565  = Validation score   (-log_loss)
    23.01s   = Training   runtime
    6.31s    = Validation runtime
Fitting model: NeuralNetFastAI_r191_BAG_L1 ... Training model for up to 1446.16s of the 2646.68s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.35%)
    -0.798   = Validation score   (-log_loss)
    153.76s  = Training   runtime
    1.06s    = Validation runtime
Fitting model: CatBoost_r9_BAG_L1 ... Training model for up to 1288.58s of the 2489.10s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=1.22%)
    -0.7616  = Validation score   (-log_loss)
    164.84s  = Training   runtime
    0.51s    = Validation runtime
Fitting model: LightGBM_r96_BAG_L1 ... Training model for up to 1120.44s of the 2320.96s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=0.29%)
    -0.7789  = Validation score   (-log_loss)
    59.55s   = Training   runtime
    25.56s   = Validation runtime
Fitting model: NeuralNetTorch_r22_BAG_L1 ... Training model for up to 1022.29s of the 2222.81s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (1 workers, per: cpus=8, gpus=0, memory=0.20%)
    -0.8058  = Validation score   (-log_loss)
    349.2s   = Training   runtime
    0.3s     = Validation runtime
Fitting model: XGBoost_r33_BAG_L1 ... Training model for up to 670.00s of the 1870.52s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=2.37%)
    -0.7541  = Validation score   (-log_loss)
    53.77s   = Training   runtime
    5.68s    = Validation runtime
Fitting model: ExtraTrees_r42_BAG_L1 ... Training model for up to 607.29s of the 1807.81s of remaining time.
    -0.7793  = Validation score   (-log_loss)
    2.61s    = Training   runtime
    0.46s    = Validation runtime
Fitting model: CatBoost_r137_BAG_L1 ... Training model for up to 603.09s of the 1803.61s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.31%)
    -0.7803  = Validation score   (-log_loss)
    238.16s  = Training   runtime
    0.38s    = Validation runtime
Fitting model: NeuralNetFastAI_r102_BAG_L1 ... Training model for up to 361.91s of the 1562.43s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.40%)
    -0.7958  = Validation score   (-log_loss)
    33.49s   = Training   runtime
    0.29s    = Validation runtime
Fitting model: CatBoost_r13_BAG_L1 ... Training model for up to 325.24s of the 1525.76s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=1.51%)
    -0.7724  = Validation score   (-log_loss)
    253.21s  = Training   runtime
    0.32s    = Validation runtime
Fitting model: RandomForest_r195_BAG_L1 ... Training model for up to 68.68s of the 1269.20s of remaining time.
    -0.7592  = Validation score   (-log_loss)
    5.03s    = Training   runtime
    0.25s    = Validation runtime
Fitting model: LightGBM_r188_BAG_L1 ... Training model for up to 62.45s of the 1262.97s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=0.72%)
    -0.7681  = Validation score   (-log_loss)
    9.7s     = Training   runtime
    1.63s    = Validation runtime
Fitting model: NeuralNetFastAI_r145_BAG_L1 ... Training model for up to 46.45s of the 1246.97s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=0.37%)
    -0.8079  = Validation score   (-log_loss)
    53.69s   = Training   runtime
    1.32s    = Validation runtime
Fitting model: WeightedEnsemble_L2 ... Training model for up to 360.00s of the 1189.04s of remaining time.
    Ensemble Weights: {'RandomForestEntr_BAG_L1': 0.545, 'XGBoost_r33_BAG_L1': 0.182, 'LightGBM_r131_BAG_L1': 0.136, 'RandomForestGini_BAG_L1': 0.091, 'NeuralNetTorch_r22_BAG_L1': 0.045}
    -0.7294  = Validation score   (-log_loss)
    1.07s    = Training   runtime
    0.0s     = Validation runtime
Fitting 108 L2 models, fit_strategy="sequential" ...
Fitting model: NeuralNetFastAI_BAG_L2 ... Training model for up to 1187.95s of the 1187.62s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=1.64%)
    -0.725   = Validation score   (-log_loss)
    64.84s   = Training   runtime
    0.94s    = Validation runtime
Fitting model: LightGBMXT_BAG_L2 ... Training model for up to 1119.59s of the 1119.25s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=1.45%)
    -0.7236  = Validation score   (-log_loss)
    15.0s    = Training   runtime
    0.63s    = Validation runtime
Fitting model: LightGBM_BAG_L2 ... Training model for up to 1099.98s of the 1099.65s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=1.46%)
    -0.7241  = Validation score   (-log_loss)
    19.31s   = Training   runtime
    0.36s    = Validation runtime
Fitting model: RandomForestGini_BAG_L2 ... Training model for up to 1076.25s of the 1075.92s of remaining time.
    -0.7461  = Validation score   (-log_loss)
    9.01s    = Training   runtime
    0.22s    = Validation runtime
Fitting model: RandomForestEntr_BAG_L2 ... Training model for up to 1065.35s of the 1065.01s of remaining time.
    -0.7314  = Validation score   (-log_loss)
    11.5s    = Training   runtime
    0.22s    = Validation runtime
Fitting model: CatBoost_BAG_L2 ... Training model for up to 1052.02s of the 1051.68s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=1.95%)
    -0.7243  = Validation score   (-log_loss)
    103.33s  = Training   runtime
    0.1s     = Validation runtime
Fitting model: ExtraTreesGini_BAG_L2 ... Training model for up to 945.95s of the 945.62s of remaining time.
    -0.7325  = Validation score   (-log_loss)
    1.95s    = Training   runtime
    0.32s    = Validation runtime
Fitting model: ExtraTreesEntr_BAG_L2 ... Training model for up to 941.86s of the 941.53s of remaining time.
    -0.7323  = Validation score   (-log_loss)
    2.0s     = Training   runtime
    0.28s    = Validation runtime
Fitting model: XGBoost_BAG_L2 ... Training model for up to 937.88s of the 937.54s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=2.38%)
    -0.7239  = Validation score   (-log_loss)
    39.8s    = Training   runtime
    0.65s    = Validation runtime
Fitting model: NeuralNetTorch_BAG_L2 ... Training model for up to 894.90s of the 894.56s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (1 workers, per: cpus=8, gpus=0, memory=0.99%)
    -0.7266  = Validation score   (-log_loss)
    123.35s  = Training   runtime
    1.24s    = Validation runtime
Fitting model: LightGBMLarge_BAG_L2 ... Training model for up to 767.75s of the 767.41s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=2.81%)
    -0.7285  = Validation score   (-log_loss)
    62.95s   = Training   runtime
    0.41s    = Validation runtime
Fitting model: CatBoost_r177_BAG_L2 ... Training model for up to 700.47s of the 700.14s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=1.99%)
    -0.7241  = Validation score   (-log_loss)
    84.97s   = Training   runtime
    0.09s    = Validation runtime
Fitting model: NeuralNetTorch_r79_BAG_L2 ... Training model for up to 612.85s of the 612.52s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (1 workers, per: cpus=8, gpus=0, memory=1.00%)
    -0.7241  = Validation score   (-log_loss)
    159.99s  = Training   runtime
    1.38s    = Validation runtime
Fitting model: LightGBM_r131_BAG_L2 ... Training model for up to 448.89s of the 448.55s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=1.81%)
    -0.7243  = Validation score   (-log_loss)
    42.78s   = Training   runtime
    1.19s    = Validation runtime
Fitting model: NeuralNetFastAI_r191_BAG_L2 ... Training model for up to 400.51s of the 400.17s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=1.65%)
    -0.7288  = Validation score   (-log_loss)
    106.63s  = Training   runtime
    1.11s    = Validation runtime
Fitting model: CatBoost_r9_BAG_L2 ... Training model for up to 290.24s of the 289.91s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=4.81%)
    -0.7243  = Validation score   (-log_loss)
    239.08s  = Training   runtime
    0.23s    = Validation runtime
Fitting model: LightGBM_r96_BAG_L2 ... Training model for up to 48.37s of the 48.04s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (8 workers, per: cpus=1, gpus=0, memory=1.37%)
    -0.7234  = Validation score   (-log_loss)
    17.5s    = Training   runtime
    1.25s    = Validation runtime
Fitting model: NeuralNetTorch_r22_BAG_L2 ... Training model for up to 25.29s of the 24.96s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (1 workers, per: cpus=8, gpus=0, memory=0.94%)
    Time limit exceeded... Skipping NeuralNetTorch_r22_BAG_L2.
Fitting model: XGBoost_r33_BAG_L2 ... Training model for up to 19.01s of the 18.68s of remaining time.
    Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (2.0 workers, per: cpus=4, gpus=0, memory=9.66%)
    -0.9506  = Validation score   (-log_loss)
    23.08s   = Training   runtime
    0.41s    = Validation runtime
Fitting model: WeightedEnsemble_L3 ... Training model for up to 360.00s of the -6.81s of remaining time.
    Ensemble Weights: {'XGBoost_BAG_L2': 0.348, 'NeuralNetFastAI_BAG_L2': 0.261, 'NeuralNetTorch_r79_BAG_L2': 0.261, 'RandomForestEntr_BAG_L2': 0.087, 'LightGBM_r96_BAG_L2': 0.043}
    -0.7216  = Validation score   (-log_loss)
    1.13s    = Training   runtime
    0.0s     = Validation runtime
AutoGluon training complete, total runtime = 3607.99s ... Best model: WeightedEnsemble_L3 | Estimated inference throughput: 223.0 rows/s (7938 batch size)
TabularPredictor saved. To load, use: predictor = TabularPredictor.load("e:\0_Backup\14.Python\metacode_202412_study_creditmodeling\autogluon_2secondmodel")</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;autogluon.tabular.predictor.predictor.TabularPredictor at 0x2548a58e870&gt;</code></pre>
</div>
</div>
<ul>
<li>리더보드</li>
</ul>
<div id="c946e287" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>predictor.leaderboard(pre_x_validate, extra_metrics<span class="op">=</span>[<span class="st">'balanced_accuracy'</span>, <span class="st">'f1_weighted'</span>, <span class="st">'roc_auc_ovr_weighted'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">score_test</th>
<th data-quarto-table-cell-role="th">score_val</th>
<th data-quarto-table-cell-role="th">eval_metric</th>
<th data-quarto-table-cell-role="th">pred_time_test</th>
<th data-quarto-table-cell-role="th">pred_time_val</th>
<th data-quarto-table-cell-role="th">fit_time</th>
<th data-quarto-table-cell-role="th">pred_time_test_marginal</th>
<th data-quarto-table-cell-role="th">pred_time_val_marginal</th>
<th data-quarto-table-cell-role="th">fit_time_marginal</th>
<th data-quarto-table-cell-role="th">stack_level</th>
<th data-quarto-table-cell-role="th">can_infer</th>
<th data-quarto-table-cell-role="th">fit_order</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>WeightedEnsemble_L3</td>
<td>-0.721621</td>
<td>-0.721621</td>
<td>log_loss</td>
<td>66.038581</td>
<td>35.591943</td>
<td>2484.289781</td>
<td>0.013003</td>
<td>0.001998</td>
<td>1.126650</td>
<td>3</td>
<td>True</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>LightGBM_r96_BAG_L2</td>
<td>-0.723399</td>
<td>-0.723399</td>
<td>log_loss</td>
<td>60.437314</td>
<td>32.402319</td>
<td>2207.033812</td>
<td>1.693396</td>
<td>1.249881</td>
<td>17.496655</td>
<td>2</td>
<td>True</td>
<td>46</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>LightGBMXT_BAG_L2</td>
<td>-0.723595</td>
<td>-0.723595</td>
<td>log_loss</td>
<td>59.718009</td>
<td>31.786725</td>
<td>2204.540157</td>
<td>0.974091</td>
<td>0.634287</td>
<td>15.003000</td>
<td>2</td>
<td>True</td>
<td>31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>XGBoost_BAG_L2</td>
<td>-0.723949</td>
<td>-0.723949</td>
<td>log_loss</td>
<td>59.537626</td>
<td>31.807227</td>
<td>2229.341661</td>
<td>0.793707</td>
<td>0.654789</td>
<td>39.804505</td>
<td>2</td>
<td>True</td>
<td>38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>CatBoost_r177_BAG_L2</td>
<td>-0.724051</td>
<td>-0.724051</td>
<td>log_loss</td>
<td>59.057112</td>
<td>31.241331</td>
<td>2274.504236</td>
<td>0.313194</td>
<td>0.088893</td>
<td>84.967080</td>
<td>2</td>
<td>True</td>
<td>41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>LightGBM_BAG_L2</td>
<td>-0.724066</td>
<td>-0.724066</td>
<td>log_loss</td>
<td>59.263655</td>
<td>31.515064</td>
<td>2208.849041</td>
<td>0.519737</td>
<td>0.362626</td>
<td>19.311885</td>
<td>2</td>
<td>True</td>
<td>32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>NeuralNetTorch_r79_BAG_L2</td>
<td>-0.724087</td>
<td>-0.724087</td>
<td>log_loss</td>
<td>60.398604</td>
<td>32.529583</td>
<td>2349.523849</td>
<td>1.654686</td>
<td>1.377145</td>
<td>159.986692</td>
<td>2</td>
<td>True</td>
<td>42</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>CatBoost_BAG_L2</td>
<td>-0.724257</td>
<td>-0.724257</td>
<td>log_loss</td>
<td>59.122199</td>
<td>31.250390</td>
<td>2292.868759</td>
<td>0.378280</td>
<td>0.097952</td>
<td>103.331603</td>
<td>2</td>
<td>True</td>
<td>35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>LightGBM_r131_BAG_L2</td>
<td>-0.724293</td>
<td>-0.724293</td>
<td>log_loss</td>
<td>60.727484</td>
<td>32.341873</td>
<td>2232.318439</td>
<td>1.983566</td>
<td>1.189435</td>
<td>42.781282</td>
<td>2</td>
<td>True</td>
<td>43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>CatBoost_r9_BAG_L2</td>
<td>-0.724313</td>
<td>-0.724313</td>
<td>log_loss</td>
<td>59.698261</td>
<td>31.379199</td>
<td>2428.618669</td>
<td>0.954343</td>
<td>0.226760</td>
<td>239.081513</td>
<td>2</td>
<td>True</td>
<td>45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>NeuralNetFastAI_BAG_L2</td>
<td>-0.724968</td>
<td>-0.724968</td>
<td>log_loss</td>
<td>60.431796</td>
<td>32.088797</td>
<td>2254.376706</td>
<td>1.687878</td>
<td>0.936359</td>
<td>64.839550</td>
<td>2</td>
<td>True</td>
<td>30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>NeuralNetTorch_BAG_L2</td>
<td>-0.726645</td>
<td>-0.726645</td>
<td>log_loss</td>
<td>60.429449</td>
<td>32.390139</td>
<td>2312.890353</td>
<td>1.685530</td>
<td>1.237701</td>
<td>123.353197</td>
<td>2</td>
<td>True</td>
<td>39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>LightGBMLarge_BAG_L2</td>
<td>-0.728510</td>
<td>-0.728510</td>
<td>log_loss</td>
<td>59.943033</td>
<td>31.565219</td>
<td>2252.492023</td>
<td>1.199115</td>
<td>0.412781</td>
<td>62.954867</td>
<td>2</td>
<td>True</td>
<td>40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>NeuralNetFastAI_r191_BAG_L2</td>
<td>-0.728848</td>
<td>-0.728848</td>
<td>log_loss</td>
<td>60.845650</td>
<td>32.260897</td>
<td>2296.170694</td>
<td>2.101732</td>
<td>1.108459</td>
<td>106.633538</td>
<td>2</td>
<td>True</td>
<td>44</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>WeightedEnsemble_L2</td>
<td>-0.729363</td>
<td>-0.729363</td>
<td>log_loss</td>
<td>21.676457</td>
<td>16.020015</td>
<td>431.424106</td>
<td>0.025999</td>
<td>0.001998</td>
<td>1.068229</td>
<td>2</td>
<td>True</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>RandomForestEntr_BAG_L2</td>
<td>-0.731364</td>
<td>-0.731364</td>
<td>log_loss</td>
<td>60.195911</td>
<td>31.371770</td>
<td>2201.035728</td>
<td>1.451993</td>
<td>0.219332</td>
<td>11.498572</td>
<td>2</td>
<td>True</td>
<td>34</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>ExtraTreesEntr_BAG_L2</td>
<td>-0.732284</td>
<td>-0.732284</td>
<td>log_loss</td>
<td>61.272550</td>
<td>31.437372</td>
<td>2191.534572</td>
<td>2.528632</td>
<td>0.284934</td>
<td>1.997415</td>
<td>2</td>
<td>True</td>
<td>37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>ExtraTreesGini_BAG_L2</td>
<td>-0.732482</td>
<td>-0.732482</td>
<td>log_loss</td>
<td>61.319811</td>
<td>31.474750</td>
<td>2191.488311</td>
<td>2.575893</td>
<td>0.322311</td>
<td>1.951155</td>
<td>2</td>
<td>True</td>
<td>36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>RandomForestEntr_BAG_L1</td>
<td>-0.739567</td>
<td>-0.739567</td>
<td>log_loss</td>
<td>3.211556</td>
<td>3.338512</td>
<td>2.307917</td>
<td>3.211556</td>
<td>3.338512</td>
<td>2.307917</td>
<td>1</td>
<td>True</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>RandomForestGini_BAG_L1</td>
<td>-0.743406</td>
<td>-0.743406</td>
<td>log_loss</td>
<td>3.129520</td>
<td>0.386959</td>
<td>2.070676</td>
<td>3.129520</td>
<td>0.386959</td>
<td>2.070676</td>
<td>1</td>
<td>True</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>RandomForestGini_BAG_L2</td>
<td>-0.746055</td>
<td>-0.746055</td>
<td>log_loss</td>
<td>60.456664</td>
<td>31.374071</td>
<td>2198.547097</td>
<td>1.712746</td>
<td>0.221633</td>
<td>9.009941</td>
<td>2</td>
<td>True</td>
<td>33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>XGBoost_r33_BAG_L1</td>
<td>-0.754110</td>
<td>-0.754110</td>
<td>log_loss</td>
<td>7.492479</td>
<td>5.680814</td>
<td>53.769325</td>
<td>7.492479</td>
<td>5.680814</td>
<td>53.769325</td>
<td>1</td>
<td>True</td>
<td>21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>LightGBMLarge_BAG_L1</td>
<td>-0.754213</td>
<td>-0.754213</td>
<td>log_loss</td>
<td>2.008240</td>
<td>1.389452</td>
<td>9.230089</td>
<td>2.008240</td>
<td>1.389452</td>
<td>9.230089</td>
<td>1</td>
<td>True</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>LightGBM_r131_BAG_L1</td>
<td>-0.756506</td>
<td>-0.756506</td>
<td>log_loss</td>
<td>7.308746</td>
<td>6.312452</td>
<td>23.005960</td>
<td>7.308746</td>
<td>6.312452</td>
<td>23.005960</td>
<td>1</td>
<td>True</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>RandomForest_r195_BAG_L1</td>
<td>-0.759182</td>
<td>-0.759182</td>
<td>log_loss</td>
<td>2.094807</td>
<td>0.254650</td>
<td>5.030918</td>
<td>2.094807</td>
<td>0.254650</td>
<td>5.030918</td>
<td>1</td>
<td>True</td>
<td>26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>CatBoost_r9_BAG_L1</td>
<td>-0.761596</td>
<td>-0.761596</td>
<td>log_loss</td>
<td>1.885603</td>
<td>0.509276</td>
<td>164.842572</td>
<td>1.885603</td>
<td>0.509276</td>
<td>164.842572</td>
<td>1</td>
<td>True</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>LightGBM_BAG_L1</td>
<td>-0.765499</td>
<td>-0.765499</td>
<td>log_loss</td>
<td>1.329988</td>
<td>1.015724</td>
<td>7.321401</td>
<td>1.329988</td>
<td>1.015724</td>
<td>7.321401</td>
<td>1</td>
<td>True</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>XGBoost_BAG_L1</td>
<td>-0.766790</td>
<td>-0.766790</td>
<td>log_loss</td>
<td>1.154552</td>
<td>1.108733</td>
<td>21.912512</td>
<td>1.154552</td>
<td>1.108733</td>
<td>21.912512</td>
<td>1</td>
<td>True</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>LightGBM_r188_BAG_L1</td>
<td>-0.768142</td>
<td>-0.768142</td>
<td>log_loss</td>
<td>2.751938</td>
<td>1.632201</td>
<td>9.696105</td>
<td>2.751938</td>
<td>1.632201</td>
<td>9.696105</td>
<td>1</td>
<td>True</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>CatBoost_r13_BAG_L1</td>
<td>-0.772391</td>
<td>-0.772391</td>
<td>log_loss</td>
<td>2.387702</td>
<td>0.321269</td>
<td>253.209605</td>
<td>2.387702</td>
<td>0.321269</td>
<td>253.209605</td>
<td>1</td>
<td>True</td>
<td>25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>LightGBMXT_BAG_L1</td>
<td>-0.772460</td>
<td>-0.772460</td>
<td>log_loss</td>
<td>2.659072</td>
<td>2.172474</td>
<td>10.480810</td>
<td>2.659072</td>
<td>2.172474</td>
<td>10.480810</td>
<td>1</td>
<td>True</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>CatBoost_r177_BAG_L1</td>
<td>-0.774637</td>
<td>-0.774637</td>
<td>log_loss</td>
<td>0.575816</td>
<td>0.149715</td>
<td>63.282011</td>
<td>0.575816</td>
<td>0.149715</td>
<td>63.282011</td>
<td>1</td>
<td>True</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>CatBoost_BAG_L1</td>
<td>-0.775142</td>
<td>-0.775142</td>
<td>log_loss</td>
<td>0.737181</td>
<td>0.202798</td>
<td>97.279686</td>
<td>0.737181</td>
<td>0.202798</td>
<td>97.279686</td>
<td>1</td>
<td>True</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>LightGBM_r96_BAG_L1</td>
<td>-0.778905</td>
<td>-0.778905</td>
<td>log_loss</td>
<td>27.299296</td>
<td>25.557928</td>
<td>59.550207</td>
<td>27.299296</td>
<td>25.557928</td>
<td>59.550207</td>
<td>1</td>
<td>True</td>
<td>19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>ExtraTrees_r42_BAG_L1</td>
<td>-0.779346</td>
<td>-0.779346</td>
<td>log_loss</td>
<td>2.905398</td>
<td>0.455039</td>
<td>2.608203</td>
<td>2.905398</td>
<td>0.455039</td>
<td>2.608203</td>
<td>1</td>
<td>True</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>ExtraTreesGini_BAG_L1</td>
<td>-0.780239</td>
<td>-0.780239</td>
<td>log_loss</td>
<td>4.402335</td>
<td>0.555433</td>
<td>1.539585</td>
<td>4.402335</td>
<td>0.555433</td>
<td>1.539585</td>
<td>1</td>
<td>True</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>CatBoost_r137_BAG_L1</td>
<td>-0.780273</td>
<td>-0.780273</td>
<td>log_loss</td>
<td>1.036823</td>
<td>0.376350</td>
<td>238.156574</td>
<td>1.036823</td>
<td>0.376350</td>
<td>238.156574</td>
<td>1</td>
<td>True</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>ExtraTreesEntr_BAG_L1</td>
<td>-0.782794</td>
<td>-0.782794</td>
<td>log_loss</td>
<td>4.142951</td>
<td>0.514300</td>
<td>1.421637</td>
<td>4.142951</td>
<td>0.514300</td>
<td>1.421637</td>
<td>1</td>
<td>True</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>NeuralNetTorch_r79_BAG_L1</td>
<td>-0.795339</td>
<td>-0.795339</td>
<td>log_loss</td>
<td>0.421243</td>
<td>0.315833</td>
<td>293.931864</td>
<td>0.421243</td>
<td>0.315833</td>
<td>293.931864</td>
<td>1</td>
<td>True</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>NeuralNetFastAI_r102_BAG_L1</td>
<td>-0.795822</td>
<td>-0.795822</td>
<td>log_loss</td>
<td>0.691814</td>
<td>0.294400</td>
<td>33.487108</td>
<td>0.691814</td>
<td>0.294400</td>
<td>33.487108</td>
<td>1</td>
<td>True</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>NeuralNetFastAI_r191_BAG_L1</td>
<td>-0.797977</td>
<td>-0.797977</td>
<td>log_loss</td>
<td>2.015678</td>
<td>1.061679</td>
<td>153.761470</td>
<td>2.015678</td>
<td>1.061679</td>
<td>153.761470</td>
<td>1</td>
<td>True</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>NeuralNetFastAI_BAG_L1</td>
<td>-0.801051</td>
<td>-0.801051</td>
<td>log_loss</td>
<td>1.336139</td>
<td>1.015028</td>
<td>86.418419</td>
<td>1.336139</td>
<td>1.015028</td>
<td>86.418419</td>
<td>1</td>
<td>True</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>NeuralNetTorch_r22_BAG_L1</td>
<td>-0.805793</td>
<td>-0.805793</td>
<td>log_loss</td>
<td>0.508158</td>
<td>0.299280</td>
<td>349.202000</td>
<td>0.508158</td>
<td>0.299280</td>
<td>349.202000</td>
<td>1</td>
<td>True</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>NeuralNetFastAI_r145_BAG_L1</td>
<td>-0.807897</td>
<td>-0.807897</td>
<td>log_loss</td>
<td>1.738020</td>
<td>1.318004</td>
<td>53.690834</td>
<td>1.738020</td>
<td>1.318004</td>
<td>53.690834</td>
<td>1</td>
<td>True</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>NeuralNetTorch_BAG_L1</td>
<td>-0.811305</td>
<td>-0.811305</td>
<td>log_loss</td>
<td>0.536539</td>
<td>0.309353</td>
<td>251.715736</td>
<td>0.536539</td>
<td>0.309353</td>
<td>251.715736</td>
<td>1</td>
<td>True</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>XGBoost_r33_BAG_L2</td>
<td>-0.950595</td>
<td>-0.950595</td>
<td>log_loss</td>
<td>59.534849</td>
<td>31.566392</td>
<td>2212.616866</td>
<td>0.790931</td>
<td>0.413954</td>
<td>23.079710</td>
<td>2</td>
<td>True</td>
<td>47</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>KNeighborsUnif_BAG_L1</td>
<td>-2.426187</td>
<td>-2.426187</td>
<td>log_loss</td>
<td>0.120591</td>
<td>0.082648</td>
<td>0.120874</td>
<td>0.120591</td>
<td>0.082648</td>
<td>0.120874</td>
<td>1</td>
<td>True</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>KNeighborsDist_BAG_L1</td>
<td>-2.443102</td>
<td>-2.443102</td>
<td>log_loss</td>
<td>0.161030</td>
<td>0.080063</td>
<td>0.043268</td>
<td>0.161030</td>
<td>0.080063</td>
<td>0.043268</td>
<td>1</td>
<td>True</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="제출용-csv파일-생성-및-제출하기" class="level2">
<h2 class="anchored" data-anchor-id="제출용-csv파일-생성-및-제출하기">제출용 CSV파일 생성 및 제출하기</h2>
<ul>
<li>제출결과
<ul>
<li>Public점수 : 0.7384256792</li>
<li>Private점수 : 0.7185042016</li>
</ul></li>
</ul>
<div id="770926b7" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 필요한 데이터 불러오기</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>pre_df_test <span class="op">=</span> db_controller.search_db_show_df(<span class="st">"SELECT * FROM test_pre"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df_sample_submission <span class="op">=</span> db_controller.search_db_show_df(<span class="st">'SELECT * FROM sample_submission'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 예측 및 제출 데이터 생성</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> predictor.predict_proba(pre_df_test)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>df_sample_submission.iloc[:,<span class="dv">1</span>:]<span class="op">=</span>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bcb0080e" class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 저장 및 값 확인</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>df_sample_submission.to_csv(<span class="st">'submission_pkb.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>df_sample_submission.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>26457</td>
<td>0.047518</td>
<td>0.103970</td>
<td>0.848513</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>26458</td>
<td>0.126270</td>
<td>0.316703</td>
<td>0.557027</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>26459</td>
<td>0.084927</td>
<td>0.117985</td>
<td>0.797088</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>26460</td>
<td>0.091055</td>
<td>0.101548</td>
<td>0.807397</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>26461</td>
<td>0.083222</td>
<td>0.160538</td>
<td>0.756240</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="향후-추가해보기" class="level1">
<h1>향후 추가해보기</h1>
<ul>
<li>cuml을 활용한 SHAP Kernel Explainer 활용
<ul>
<li>cuml 설치(Docker활용)
<ul>
<li>https://docs.rapids.ai/install/#selector ```shell docker run –gpus all –pull always –rm -it<br>
–shm-size=1g –ulimit memlock=-1 –ulimit stack=67108864<br>
nvcr.io/nvidia/rapidsai/base:24.12-cuda12.0-py3.12</li>
</ul></li>
</ul></li>
<li>파생변수 생성</li>
</ul>


</section>

<p><br><strong>Copyright © 2024 Kibok Park All rights reserved.</strong><br></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kr9268\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="kr9268/giscus_for_blog" data-repo-id="R_kgDOL0Sthw" data-category="General" data-category-id="DIC_kwDOL0Sth84Ce_5h" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<script>
    const baseFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
    const watermark = new XWatermark.XWatermark();
    watermark.init("Kibok Park", {
      parentSelector: "body",
      prevent: true,
      observer: true,
      mode: "normal",
      font: "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', 'Noto Sans', 'Liberation Sans', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'",
      fontsize: baseFontSize * 1.000000,
      angle: -15.000000,
      color: "#000000",
      alpha: 0.100000,
      cols: 10,
      rows: 50,
      xSpace: baseFontSize * 4.000000,
      ySpace: baseFontSize * 4.000000,
      zIndex: -1
    });
    </script>




</body></html>